{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Plan",
  "description": "Schema for plan artifacts generated by Planner agent",
  "required": ["plan_id", "name", "objectives", "steps", "status", "created_at"],
  "properties": {
    "plan_id": {
      "type": "string",
      "description": "Unique identifier for the plan (e.g., plan-<timestamp>)",
      "pattern": "^plan-[a-zA-Z0-9_-]+$"
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the plan"
    },
    "objectives": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Clear, measurable objectives that this plan aims to achieve",
      "minItems": 1
    },
    "context": {
      "type": "object",
      "description": "Background information and context for the plan",
      "properties": {
        "background": {
          "type": "string",
          "description": "Background information that led to this plan"
        },
        "requirements": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of requirements addressed by this plan"
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Constraints that must be considered"
        },
        "assumptions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Assumptions made during planning"
        }
      }
    },
    "steps": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["step_number", "name", "agent", "tasks", "success_criteria"],
        "properties": {
          "step_number": {
            "type": ["integer", "string"],
            "description": "Step number or identifier"
          },
          "name": {
            "type": "string",
            "description": "Human-readable name of the step"
          },
          "agent": {
            "type": "string",
            "description": "Agent assigned to execute this step"
          },
          "dependencies": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of step identifiers this step depends on (e.g., ['step-0', 'step-1'])"
          },
          "tasks": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Specific tasks to be completed in this step",
            "minItems": 1
          },
          "success_criteria": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Measurable criteria indicating step completion",
            "minItems": 1
          },
          "risks": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Potential risks for this step"
          },
          "mitigation": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Risk mitigation strategies"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "blocked"],
            "description": "Current execution status of the step"
          }
        }
      },
      "description": "Array of plan steps with dependencies, tasks, and success criteria",
      "minItems": 1
    },
    "dependencies": {
      "type": "object",
      "description": "Graph of step dependencies",
      "additionalProperties": {
        "type": "array",
        "items": {
          "type": "string"
        }
      }
    },
    "risks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["risk", "mitigation"],
        "properties": {
          "risk": {
            "type": "string",
            "description": "Description of the risk"
          },
          "mitigation": {
            "type": "string",
            "description": "Mitigation strategy for this risk"
          },
          "severity": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Severity level of the risk"
          }
        }
      },
      "description": "Plan-level risks and mitigation strategies"
    },
    "success_criteria": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["criterion"],
        "properties": {
          "criterion": {
            "type": "string",
            "description": "Description of the success criterion"
          },
          "measurement": {
            "type": "string",
            "description": "How to measure success for this criterion"
          }
        }
      },
      "description": "Plan-level success criteria"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the plan was created"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the plan was last updated"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "validated", "in_execution", "completed", "cancelled"],
      "description": "Current status of the plan"
    },
    "owner": {
      "type": "string",
      "description": "Agent or user responsible for the plan"
    },
    "workflow": {
      "type": "string",
      "description": "Associated workflow name"
    }
  }
}

