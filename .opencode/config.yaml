# OpenCode Agent Configuration
# Defines agent routing, model assignments, and workflow selection
# Adapted from BMAD-Spec Orchestrator for OpenCode compatibility

# Global Tool Registry (Active MCPs)
mcp_registry:
  active_tools:
    - name: "shadcn"
      description: "Component library management and lookup"
    - name: "SequentialThinking"
      description: "Deep reasoning and step-by-step logic chains"
    - name: "Git"
      description: "Version control, diffs, commits, and history"
    - name: "GitHub Official"
      description: "PRs, Issues, and Repository management"
    - name: "Memory"
      description: "Long-term context retention across sessions"
    - name: "Filesystem"
      description: "File manipulation"
    - name: "Docker"
      description: "Container management"
    - name: "SQLite"
      description: "Database interaction"
    - name: "Markitdown"
      description: "Documentation generation and formatting"
    - name: "Paper Search"
      description: "Academic and technical paper research"
    - name: "Curl"
      description: "Network requests and API testing"

# Agent Routing Configuration
agent_routing:
  analyst:
    trigger_words:
      - "market research"
      - "competitive analysis"
      - "project brief"
      - "requirements gathering"
      - "feasibility"
      - "stakeholder analysis"
      - "brainstorming"
      - "discovery"
      - "brownfield"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.7

  pm:
    trigger_words:
      - "prd"
      - "product requirements"
      - "user stories"
      - "epic"
      - "backlog"
      - "roadmap"
      - "prioritization"
      - "feature specification"
      - "sprint planning"
      - "story refinement"
      - "product owner"
      - "scrum"
      - "agile"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.7

  architect:
    trigger_words:
      - "architecture"
      - "system design"
      - "technology stack"
      - "api design"
      - "infrastructure"
      - "scalability"
      - "security architecture"
      - "integration"
    complexity: high
    model: claude-opus-4
    temperature: 0.5
    extended_thinking: true

  database-architect:
    trigger_words:
      - "database"
      - "schema"
      - "data modeling"
      - "query optimization"
      - "migration"
      - "SQL"
      - "NoSQL"
      - "PostgreSQL"
      - "MongoDB"
      - "Redis"
      - "indexing"
      - "sharding"
      - "replication"
      - "high availability"
      - "backup"
      - "data architecture"
    complexity: high
    model: claude-opus-4
    temperature: 0.5
    extended_thinking: true

  developer:
    trigger_words:
      - "implement"
      - "code"
      - "development"
      - "debug"
      - "refactor"
      - "feature"
      - "bug fix"
      - "write tests"
      - "shadcn"
      - "component"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.3

  qa:
    trigger_words:
      - "test"
      - "quality"
      - "testing"
      - "test plan"
      - "qa"
      - "quality gate"
      - "test coverage"
      - "regression"
      - "smoke test"
    complexity: high
    model: claude-opus-4
    temperature: 0.4
    extended_thinking: true

  ux-expert:
    trigger_words:
      - "ux"
      - "ui"
      - "design"
      - "wireframe"
      - "prototype"
      - "user experience"
      - "interface"
      - "accessibility"
      - "shadcn"
      - "tailwind"
      - "css"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.7

  orchestrator:
    trigger_words:
      - "orchestrate"
      - "coordinate"
      - "multi-agent"
      - "complex workflow"
      - "end-to-end"
      - "workflow"
      - "project planning"
    complexity: high
    model: claude-opus-4
    temperature: 0.6
    extended_thinking: true

  model-orchestrator:
    trigger_words:
      - "call gemini"
      - "call opus"
      - "call cursor"
      - "use gemini"
      - "use cursor"
      - "multi-model"
      - "model routing"
      - "research with gemini"
      - "plan with opus"
      - "implement with cursor"
      - "get second opinion"
      - "synthesize models"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.4
    tools:
      - Read
      - Bash
      - Grep
      - Glob
      - Sequential Thinking

  security-architect:
    trigger_words:
      - "security"
      - "authentication"
      - "authorization"
      - "compliance"
      - "threat"
      - "vulnerability"
      - "encryption"
      - "zero-trust"
    complexity: high
    model: claude-opus-4
    temperature: 0.4
    extended_thinking: true

  devops:
    trigger_words:
      - "infrastructure"
      - "deployment"
      - "ci/cd"
      - "kubernetes"
      - "docker"
      - "terraform"
      - "monitoring"
      - "observability"
      - "slo"
      - "sli"
      - "sla"
      - "reliability"
      - "incident"
      - "release"
      - "versioning"
      - "rollout"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.4

  technical-writer:
    trigger_words:
      - "documentation"
      - "api docs"
      - "user manual"
      - "onboarding"
      - "guide"
      - "tutorial"
      - "changelog"
      - "release notes"
      - "technical writing"
      - "markdown"
    complexity: low
    model: claude-3-5-haiku
    temperature: 0.7

  # High-Impact Agents

  llm-architect:
    trigger_words:
      - "ai system"
      - "llm"
      - "prompt engineering"
      - "rag"
      - "embeddings"
      - "vector database"
      - "model selection"
      - "fine-tuning"
      - "ai architecture"
      - "chatbot"
      - "conversational ai"
      - "prompt template"
    complexity: high
    model: claude-opus-4
    temperature: 0.6
    extended_thinking: true

  code-reviewer:
    trigger_words:
      - "code review"
      - "review this"
      - "review the code"
      - "pr review"
      - "pull request review"
      - "check this code"
      - "audit code"
      - "git diff"
    complexity: high
    model: claude-opus-4
    temperature: 0.3
    extended_thinking: true

  performance-engineer:
    trigger_words:
      - "performance"
      - "optimize"
      - "profiling"
      - "benchmark"
      - "load testing"
      - "latency"
      - "throughput"
      - "core web vitals"
      - "slow"
      - "memory leak"
      - "bottleneck"
    complexity: high
    model: claude-opus-4
    temperature: 0.4
    extended_thinking: true

  api-designer:
    trigger_words:
      - "api design"
      - "rest api"
      - "graphql"
      - "grpc"
      - "openapi"
      - "swagger"
      - "api contract"
      - "endpoint design"
      - "api versioning"
    complexity: high
    model: claude-opus-4
    temperature: 0.5
    extended_thinking: true

  legacy-modernizer:
    trigger_words:
      - "legacy"
      - "modernize"
      - "migration"
      - "strangler fig"
      - "technical debt"
      - "old codebase"
      - "upgrade"
      - "rewrite"
      - "obsolete"
    complexity: high
    model: claude-opus-4
    temperature: 0.5
    extended_thinking: true

  accessibility-expert:
    trigger_words:
      - "accessibility"
      - "wcag"
      - "a11y"
      - "screen reader"
      - "aria"
      - "inclusive design"
      - "keyboard navigation"
      - "color contrast"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.4

  compliance-auditor:
    trigger_words:
      - "gdpr"
      - "hipaa"
      - "soc2"
      - "pci"
      - "regulatory"
      - "compliance audit"
      - "data protection"
      - "privacy"
      - "ccpa"
      - "audit"
    complexity: high
    model: claude-opus-4
    temperature: 0.3
    extended_thinking: true

  incident-responder:
    trigger_words:
      - "incident"
      - "outage"
      - "down"
      - "production issue"
      - "emergency"
      - "post-mortem"
      - "postmortem"
      - "root cause"
      - "crisis"
      - "runbook"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.2

  refactoring-specialist:
    trigger_words:
      - "refactor"
      - "code smell"
      - "clean code"
      - "extract method"
      - "technical debt"
      - "complexity"
      - "maintainability"
      - "solid principles"
      - "design patterns"
    complexity: high
    model: claude-opus-4
    temperature: 0.4
    extended_thinking: true

  mobile-developer:
    trigger_words:
      - "mobile"
      - "ios"
      - "android"
      - "react native"
      - "flutter"
      - "swift"
      - "kotlin"
      - "app store"
      - "mobile app"
    complexity: medium
    model: claude-sonnet-4
    temperature: 0.5

# Workflow Selection Configuration
workflow_selection:
  quick_flow:
    priority: 1
    keywords:
      - "bug fix"
      - "hotfix"
      - "quick fix"
      - "small feature"
      - "documentation"
      - "refactor"
      - "minor change"
    complexity: low
    workflow_file: .opencode/workflow/quick-flow.yaml
    agents_sequence:
      - developer
      - qa

  fullstack:
    priority: 2
    keywords:
      - "new project"
      - "greenfield"
      - "from scratch"
      - "full stack"
      - "fullstack"
      - "enterprise"
      - "production"
    complexity: medium
    workflow_file: .opencode/workflow/greenfield-fullstack.yaml
    agents_sequence:
      - analyst
      - pm
      - ux-expert
      - architect
      - qa
      - developer
      - qa

  code_quality:
    priority: 3
    keywords:
      - "code quality"
      - "code review"
      - "refactor"
      - "tech debt"
      - "code smell"
      - "clean up"
    complexity: medium
    workflow_file: .opencode/workflow/code-quality-flow.yaml
    agents_sequence:
      - code-reviewer
      - refactoring-specialist
      - compliance-auditor
      - qa

  performance:
    priority: 3
    keywords:
      - "performance"
      - "optimize"
      - "profiling"
      - "benchmark"
      - "load test"
      - "slow"
      - "latency"
    complexity: medium
    workflow_file: .opencode/workflow/performance-flow.yaml
    agents_sequence:
      - performance-engineer
      - architect
      - developer
      - qa

  ai_system:
    priority: 3
    keywords:
      - "ai system"
      - "llm"
      - "rag"
      - "embeddings"
      - "chatbot"
      - "ai feature"
      - "machine learning"
      - "vector database"
    complexity: high
    workflow_file: .opencode/workflow/ai-system-flow.yaml
    agents_sequence:
      - model-orchestrator
      - llm-architect
      - api-designer
      - developer
      - qa

  mobile:
    priority: 3
    keywords:
      - "mobile app"
      - "ios"
      - "android"
      - "react native"
      - "flutter"
      - "native app"
      - "app store"
    complexity: medium
    workflow_file: .opencode/workflow/mobile-flow.yaml
    agents_sequence:
      - mobile-developer
      - ux-expert
      - developer
      - qa

  incident:
    priority: 0  # Highest priority for critical incidents
    keywords:
      - "incident"
      - "outage"
      - "production issue"
      - "post-mortem"
      - "crisis"
      - "downtime"
      - "emergency"
    complexity: high
    workflow_file: .opencode/workflow/incident-flow.yaml
    agents_sequence:
      - incident-responder
      - devops
      - security-architect
      - qa

# Intelligent Routing Configuration
intelligent_routing:
  enabled: true
  orchestrator_agent: orchestrator
  auto_select_workflow: true
  default_workflow: fullstack

# Model Configuration by Complexity
model_config:
  high_complexity:
    model: claude-opus-4
    temperature: 0.4
    max_tokens: 8192
    use_extended_thinking: true

  medium_complexity:
    model: claude-sonnet-4
    temperature: 0.7
    max_tokens: 8192
    use_extended_thinking: false

  low_complexity:
    model: claude-3-5-haiku
    temperature: 0.5
    max_tokens: 4096
    use_extended_thinking: false

# Tool Restrictions by Agent
tool_restrictions:
  orchestrator:
    allowed_tools:
      - Sequential Thinking
      - Memory
      - Read
      - Search
      - Grep

  analyst:
    allowed_tools:
      - Read
      - Search
      - Paper Search
      - Fetch
      - Sequential Thinking
      - Grep
      - Glob
    restricted_tools:
      - Edit
      - Bash

  architect:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Glob
      - Edit
      - GitHub Official
      - Paper Search
    restricted_tools:
      - Bash
      - Docker

  developer:
    allowed_tools:
      - shadcn
      - Git
      - GitHub Official
      - Markitdown
      - Read
      - Edit
      - Bash
      - Grep
      - Glob
      - Filesystem
      - SQLite
    restricted_tools:
      - Bash (dangerous: rm -rf, sudo, etc.)

  code-reviewer:
    allowed_tools:
      - Git
      - GitHub Official
      - Sequential Thinking
      - Read
      - Grep
    restricted_tools:
      - Edit (Direct editing discouraged)

  qa:
    allowed_tools:
      - Curl
      - Docker
      - SQLite
      - Read
      - Search
      - Bash
      - Grep
      - Glob
    restricted_tools:
      - Edit (code)

  devops:
    allowed_tools:
      - Docker
      - Curl
      - Git
      - GitHub Official
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
    restricted_tools:
      - Bash (dangerous commands)

  ux-expert:
    allowed_tools:
      - shadcn
      - Markitdown
      - Read
      - Search
      - Edit (CSS/Tailwind only)
    restricted_tools:
      - Bash
      - Docker

  technical-writer:
    allowed_tools:
      - Markitdown
      - Git
      - GitHub Official
      - Read
      - Search
      - Edit
      - Grep
      - Glob
    restricted_tools:
      - Bash
      - Docker

# Session Management
session:
  context_file: .opencode/context/session.json
  artifacts_dir: .opencode/context/artifacts
  reasoning_dir: .opencode/context/history/reasoning
  gates_dir: .opencode/context/history/gates
  auto_save: true
  max_context_length: 100000

# Quality Gates Configuration
quality_gates:
  enabled: true
  validation_schemas_dir: .opencode/schema
  gate_script: node .opencode/tool/gates/gate.mjs

# Template Configuration
templates:
  base_dir: .opencode/template
  project_brief: project-brief.md
  prd: prd.md
  architecture: architecture.md
  implementation_plan: implementation-plan.md
  test_plan: test-plan.md
  ui_spec: ui-spec.md
