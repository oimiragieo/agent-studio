name: Enterprise Development Track
description: Comprehensive workflow for enterprise projects requiring security, compliance, and documentation
type: enterprise
project_type: fullstack

# NOTE: This workflow is selected via keywords defined in .opencode/config.yaml workflow_selection section.
# The routing system matches user prompts against keywords in config.yaml, not this file.
# See .opencode/config.yaml for the authoritative keyword list used by the routing system.

# This workflow is designed for enterprise environments:
# - Mandatory security review and compliance validation
# - Comprehensive documentation requirements
# - Multi-stakeholder approval gates
# - Audit trail for all decisions

steps:
  - step: 0
    name: "Planning Phase"
    agent: planner
    inputs:
      - user_requirements
      - business_objectives
      - compliance_requirements
      - stakeholder_matrix
    outputs:
      - plan-{{workflow_id}}.md
      - plan-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/00-planner.json
    validation:
      schema: .opencode/schema/plan.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/00-planner.json
    description: |
      Plan enterprise development workflow:
      - Analyze requirements and compliance needs
      - Coordinate with enterprise specialists
      - Create structured development plan

  - step: 1
    name: "Project Discovery & Stakeholder Analysis"
    agent: analyst
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - user_requirements
      - business_objectives
      - compliance_requirements
      - stakeholder_matrix
    outputs:
      - project-brief-{{workflow_id}}.json
      - stakeholder-analysis-{{workflow_id}}.json
      - feasibility-report-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/01-analyst.json
    validation:
      schema: .opencode/schema/project-brief.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/01-analyst.json

  - step: 2
    name: "Product Requirements & Compliance Mapping"
    agent: pm
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - project-brief-{{workflow_id}}.json (from step 1)
      - compliance_requirements
    outputs:
      - prd-{{workflow_id}}.json
      - compliance-mapping-{{workflow_id}}.json
      - approval-requirements-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/02-pm.json
    validation:
      schema: .opencode/schema/prd.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/02-pm.json

  - step: 3
    name: "Security Architecture Review"
    agent: security-architect
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - prd-{{workflow_id}}.json (from step 2)
      - compliance-mapping-{{workflow_id}}.json (from step 2)
    outputs:
      - security-architecture-{{workflow_id}}.json
      - threat-model-{{workflow_id}}.json
      - compliance-validation-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/03-security-architect.json
    validation:
      gate: .opencode/context/history/gates/{{workflow_id}}/03-security.json
    notes: |
      Mandatory security review for enterprise projects.
      Must validate SOC2, HIPAA, GDPR requirements as applicable.

  - step: 4
    name: "System Architecture"
    agent: architect
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - prd-{{workflow_id}}.json (from step 2)
      - security-architecture-{{workflow_id}}.json (from step 3)
      - threat-model-{{workflow_id}}.json (from step 3)
    outputs:
      - system-architecture-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/04-architect.json
    validation:
      schema: .opencode/schema/architecture.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/04-architect.json
    notes: |
      Architecture must incorporate security controls
      from the security architecture review.

  - step: 5
    name: "Database Architecture & Data Governance"
    agent: database-architect
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - system-architecture-{{workflow_id}}.json (from step 4)
      - prd-{{workflow_id}}.json (from step 2)
      - compliance-mapping-{{workflow_id}}.json (from step 2)
    outputs:
      - database-architecture-{{workflow_id}}.json
      - data-governance-plan-{{workflow_id}}.json
      - encryption-strategy-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/05-database-architect.json
    validation:
      schema: .opencode/schema/architecture.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/05-database-architect.json
    notes: |
      Must address data retention, encryption at rest,
      audit logging, and PII handling requirements.

  - step: 6
    name: "Infrastructure & DevOps Planning"
    agent: devops
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - system-architecture-{{workflow_id}}.json (from step 4)
      - database-architecture-{{workflow_id}}.json (from step 5)
      - security-architecture-{{workflow_id}}.json (from step 3)
    outputs:
      - infrastructure-plan-{{workflow_id}}.json
      - deployment-strategy-{{workflow_id}}.json
      - monitoring-plan-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/06-devops.json
    validation:
      gate: .opencode/context/history/gates/{{workflow_id}}/06-devops.json
    notes: |
      Plan must include disaster recovery, backup procedures,
      and multi-environment deployment strategy.

  - step: 7
    name: "Test Planning & Security Testing"
    agent: qa
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - system-architecture-{{workflow_id}}.json (from step 4)
      - database-architecture-{{workflow_id}}.json (from step 5)
      - security-architecture-{{workflow_id}}.json (from step 3)
      - prd-{{workflow_id}}.json (from step 2)
    outputs:
      - test-plan-{{workflow_id}}.json
      - security-test-plan-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/07-qa.json
    validation:
      schema: .opencode/schema/test-plan.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/07-qa.json
    notes: |
      Must include security testing, penetration testing plan,
      and compliance validation tests.

  - step: 8
    name: "Implementation"
    agent: developer
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - system-architecture-{{workflow_id}}.json (from step 4)
      - database-architecture-{{workflow_id}}.json (from step 5)
      - security-architecture-{{workflow_id}}.json (from step 3)
      - infrastructure-plan-{{workflow_id}}.json (from step 6)
      - test-plan-{{workflow_id}}.json (from step 7)
    outputs:
      - dev-manifest-{{workflow_id}}.json
      - code-artifacts
      - security-controls-implementation-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/08-developer.json
    validation:
      schema: .opencode/schema/artifact_manifest.schema.json
      gate: .opencode/context/history/gates/{{workflow_id}}/08-developer.json

  - step: 9
    name: "Enterprise Documentation"
    agent: technical-writer
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - dev-manifest-{{workflow_id}}.json (from step 8)
      - system-architecture-{{workflow_id}}.json (from step 4)
      - database-architecture-{{workflow_id}}.json (from step 5)
      - security-architecture-{{workflow_id}}.json (from step 3)
      - compliance-mapping-{{workflow_id}}.json (from step 2)
    outputs:
      - documentation-{{workflow_id}}.json
      - operations-runbook-{{workflow_id}}.json
      - compliance-documentation-{{workflow_id}}.json
      - api-documentation-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/09-technical-writer.json
    validation:
      gate: .opencode/context/history/gates/{{workflow_id}}/09-technical-writer.json
    notes: |
      Enterprise documentation must include operations runbooks,
      compliance attestations, and audit trail documentation.

  - step: 10
    name: "Quality Assurance & Security Validation"
    agent: qa
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - dev-manifest-{{workflow_id}}.json (from step 8)
      - test-plan-{{workflow_id}}.json (from step 7)
      - security-test-plan-{{workflow_id}}.json (from step 7)
    outputs:
      - quality-report-{{workflow_id}}.json
      - test-results-{{workflow_id}}.json
      - security-validation-{{workflow_id}}.json
      - compliance-attestation-{{workflow_id}}.json
      - reasoning: .opencode/context/history/reasoning/{{workflow_id}}/10-qa-final.json
    validation:
      gate: .opencode/context/history/gates/{{workflow_id}}/10-qa-final.json

completion_criteria:
  - All artifacts validated against schemas
  - Quality gates passed with documented approvals
  - Security review completed and signed off
  - Compliance requirements mapped and validated
  - Test coverage meets enterprise threshold (80%+)
  - Documentation complete for audit requirements
  - Operations runbook reviewed
  - Disaster recovery plan validated

approval_gates:
  - Security architecture sign-off required before implementation
  - Compliance mapping must be validated by compliance team
  - Architecture review required before developer step
  - Final QA must include security validation

audit_requirements:
  - All decisions must be documented in reasoning.json files
  - Gate validations stored in gates directory
  - Compliance mapping maintained throughout workflow
  - Change log generated for all artifact modifications
