#!/bin/bash
# Cross-platform ripgrep wrapper for LLM-RULES
# Automatically uses the correct binary and configuration

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CONFIG_PATH="$SCRIPT_DIR/.ripgreprc"

# Detect platform
case "$(uname -s)" in
    Linux*)
        if [[ "$(uname -m)" == "aarch64" ]]; then
            RG_BIN="$SCRIPT_DIR/linux-arm64/rg"
        else
            RG_BIN="$SCRIPT_DIR/linux-x64/rg"
        fi
        ;;
    Darwin*)
        if [[ "$(uname -m)" == "arm64" ]]; then
            RG_BIN="$SCRIPT_DIR/darwin-arm64/rg"
        else
            RG_BIN="$SCRIPT_DIR/darwin-x64/rg"
        fi
        ;;
    MINGW*|MSYS*|CYGWIN*)
        RG_BIN="$SCRIPT_DIR/win32-x64/rg.exe"
        ;;
    *)
        echo "Unsupported platform: $(uname -s)" >&2
        exit 1
        ;;
esac

# Export config path and run ripgrep
export RIPGREP_CONFIG_PATH="$CONFIG_PATH"
exec "$RG_BIN" "$@"
