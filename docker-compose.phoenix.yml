# ==============================================================================
# Arize Phoenix - OpenTelemetry Observability Platform
# ==============================================================================
# Version: 1.0.0
# Last Updated: 2026-01-29
# Task: P1-6.6 - Deploy Arize Phoenix (Docker) and performance benchmark
#
# Purpose:
#   Deploy Arize Phoenix for OpenTelemetry trace collection and visualization
#
# Usage:
#   Start:  docker-compose -f docker-compose.phoenix.yml up -d
#   Stop:   docker-compose -f docker-compose.phoenix.yml down
#   Logs:   docker-compose -f docker-compose.phoenix.yml logs -f phoenix
#   Status: docker-compose -f docker-compose.phoenix.yml ps
#
# Access:
#   Phoenix UI: http://localhost:6006
#   OTLP gRPC:  http://localhost:4317 (telemetry ingestion)
#   OTLP HTTP:  http://localhost:4318 (alternative ingestion)
#
# Environment Integration:
#   Set in .env file:
#     OTEL_ENABLED=true
#     OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
#
# Documentation:
#   - Arize Phoenix: https://docs.arize.com/phoenix
#   - OpenTelemetry: https://opentelemetry.io/docs/
#   - Integration: .claude/docs/PHOENIX_SETUP.md
# ==============================================================================

services:
  phoenix:
    # Arize Phoenix - OpenTelemetry collector and UI
    image: arizephoenix/phoenix:latest
    container_name: agent-studio-phoenix
    restart: unless-stopped

    ports:
      # Phoenix UI (web interface for trace visualization)
      - "6006:6006"

      # OTLP gRPC endpoint (primary telemetry ingestion)
      - "4317:4317"

      # OTLP HTTP endpoint (alternative telemetry ingestion)
      - "4318:4318"

    environment:
      # Phoenix server configuration
      PHOENIX_PORT: "6006"

      # Enable OTLP receivers
      PHOENIX_ENABLE_OTLP: "true"

      # Data persistence path inside container
      PHOENIX_WORKING_DIR: /data

      # Log level (debug|info|warn|error)
      PHOENIX_LOG_LEVEL: info

      # Allow cross-origin requests for development
      PHOENIX_ENABLE_CORS: "true"

    volumes:
      # Persist Phoenix data (traces, spans, metrics)
      - phoenix_data:/data

    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:6006/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    networks:
      - observability

volumes:
  phoenix_data:
    driver: local
    name: agent-studio-phoenix-data

networks:
  observability:
    name: agent-studio-observability
    driver: bridge
