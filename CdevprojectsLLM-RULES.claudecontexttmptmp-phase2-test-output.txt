TAP version 13
# [MemoryDB] Running initial migration...
# [MemoryDB] Initial migration complete
# [MemoryDB] Running migration 4...
# [MemoryDB] Migration 4 complete
# [MemoryDB] Initialized in 32ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 35ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 2ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 3ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 2ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 3ms
# [HierarchicalMemory] Store memory failed: Invalid tier: invalid-tier
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 2ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 3ms
# [HierarchicalMemory] Promoted message 3 to agent tier (0ms)
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 2ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 3ms
# Subtest: Hierarchical Memory - Tier Assignment
    # Subtest: should store memory in conversation tier by default
    ok 1 - should store memory in conversation tier by default
      ---
      duration_ms: 43.039
      type: 'test'
      ...
    # Subtest: should allow explicit tier assignment
    ok 2 - should allow explicit tier assignment
      ---
      duration_ms: 11.5294
      type: 'test'
      ...
    # Subtest: should reject invalid tier values
    ok 3 - should reject invalid tier values
      ---
      duration_ms: 11.4877
      type: 'test'
      ...
    1..3
ok 1 - Hierarchical Memory - Tier Assignment
  ---
  duration_ms: 67.3116
  type: 'suite'
  ...
# Subtest: Hierarchical Memory - Reference Tracking
    # Subtest: should increment reference count
    ok 1 - should increment reference count
      ---
      duration_ms: 12.6522
      type: 'test'
      ...
# [MemoryDB] Initialized in 9ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 9ms
# [HierarchicalMemory] Promoted message 5 to agent tier (0ms)
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 9ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 9ms
# [HierarchicalMemory] Promoted message 6 to agent tier (0ms)
# [HierarchicalMemory] Promoted message 6 to project tier (0ms)
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 9ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 9ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 6ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 6ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 5ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 5ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 5ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 5ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 6ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 6ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 7ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 7ms
# [MemoryDB] Initialized in 8ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 8ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 7ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 7ms
    # Subtest: should update last_referenced_at timestamp
    not ok 2 - should update last_referenced_at timestamp
      ---
      duration_ms: 109.1261
      type: 'test'
      location: 'C:\\dev\\projects\\LLM-RULES\\.claude\\tools\\memory\\hierarchical-memory.test.mjs:188:3'
      failureType: 'testCodeFailure'
      error: |-
        Expected "actual" to be strictly unequal to:
        
        '2026-01-13 18:14:22'
      code: 'ERR_ASSERTION'
      name: 'AssertionError'
      expected: '2026-01-13 18:14:22'
      actual: '2026-01-13 18:14:22'
      operator: 'notStrictEqual'
      stack: |-
        TestContext.<anonymous> (file:///C:/dev/projects/LLM-RULES/.claude/tools/memory/hierarchical-memory.test.mjs:211:12)
        async Test.run (node:internal/test_runner/test:1054:7)
        async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)
      ...
    1..2
not ok 2 - Hierarchical Memory - Reference Tracking
  ---
  duration_ms: 122.6431
  type: 'suite'
  location: 'C:\\dev\\projects\\LLM-RULES\\.claude\\tools\\memory\\hierarchical-memory.test.mjs:162:1'
  failureType: 'subtestsFailed'
  error: '1 subtest failed'
  code: 'ERR_TEST_FAILURE'
  ...
# Subtest: Hierarchical Memory - Automatic Promotion
    # Subtest: should promote from conversation to agent tier after 3 references
    ok 1 - should promote from conversation to agent tier after 3 references
      ---
      duration_ms: 11.8257
      type: 'test'
      ...
    # Subtest: should promote from agent to project tier after 5 references
    ok 2 - should promote from agent to project tier after 5 references
      ---
      duration_ms: 12.3235
      type: 'test'
      ...
    # Subtest: should not promote if threshold not met
    ok 3 - should not promote if threshold not met
      ---
      duration_ms: 10.9305
      type: 'test'
      ...
    1..3
ok 3 - Hierarchical Memory - Automatic Promotion
  ---
  duration_ms: 35.6871
  type: 'suite'
  ...
# Subtest: Hierarchical Memory - Cross-Tier Search
    # Subtest: should search across all tiers by default
    ok 1 - should search across all tiers by default
      ---
      duration_ms: 9.0096
      type: 'test'
      ...
    # Subtest: should filter by specific tiers
    ok 2 - should filter by specific tiers
      ---
      duration_ms: 7.9825
      type: 'test'
      ...
    # Subtest: should filter by agent ID
    ok 3 - should filter by agent ID
      ---
      duration_ms: 7.7994
      type: 'test'
      ...
    # Subtest: should respect importance threshold
    ok 4 - should respect importance threshold
      ---
      duration_ms: 7.8289
      type: 'test'
      ...
    1..4
ok 4 - Hierarchical Memory - Cross-Tier Search
  ---
  duration_ms: 32.8869
  type: 'suite'
  ...
# Subtest: Hierarchical Memory - Tier Retrieval
    # Subtest: should retrieve memories by tier
    not ok 1 - should retrieve memories by tier
      ---
      duration_ms: 9.9014
      type: 'test'
      location: 'C:\\dev\\projects\\LLM-RULES\\.claude\\tools\\memory\\hierarchical-memory.test.mjs:455:3'
      failureType: 'testCodeFailure'
      error: |-
        Expected values to be strictly equal:
        
        7 !== 3
        
      code: 'ERR_ASSERTION'
      name: 'AssertionError'
      expected: 3
      actual: 7
      operator: 'strictEqual'
      stack: |-
        TestContext.<anonymous> (file:///C:/dev/projects/LLM-RULES/.claude/tools/memory/hierarchical-memory.test.mjs:480:12)
        async Test.run (node:internal/test_runner/test:1054:7)
        async Promise.all (index 0)
        async Suite.run (node:internal/test_runner/test:1442:7)
        async Test.processPendingSubtests (node:internal/test_runner/test:744:7)
      ...
    # Subtest: should filter agent-tier memories by agent ID
    ok 2 - should filter agent-tier memories by agent ID
      ---
      duration_ms: 9.9088
      type: 'test'
      ...
    1..2
not ok 5 - Hierarchical Memory - Tier Retrieval
  ---
  duration_ms: 19.9818
  type: 'suite'
  location: 'C:\\dev\\projects\\LLM-RULES\\.claude\\tools\\memory\\hierarchical-memory.test.mjs:454:1'
  failureType: 'subtestsFailed'
  error: '1 subtest failed'
  code: 'ERR_TEST_FAILURE'
  ...
# [HierarchicalMemory] Expired 10 memories (10 conversation, 0 agent) in 1ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 3ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 3ms
# Subtest: Hierarchical Memory - Expiration
    # Subtest: should expire conversation-tier memories after TTL
    ok 1 - should expire conversation-tier memories after TTL
      ---
      duration_ms: 433.4888
      type: 'test'
      ...
# [HierarchicalMemory] Expired 7 memories (0 conversation, 7 agent) in 0ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 2ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 2ms
# [MemoryDB] Initialized in 8ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 8ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 7ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 7ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 7ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 7ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Initialized in 6ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 6ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
# [MemoryDB] Running migration 4...
# [MemoryDB] Migration 4 complete
# [MemoryDB] Initialized in 11ms
# [HierarchicalMemory] Migration complete - tier columns added
# [HierarchicalMemory] Initialized in 11ms
# [MemoryDB] Connection closed
# [HierarchicalMemory] Closed
    # Subtest: should not expire project-tier memories (no TTL)
    ok 2 - should not expire project-tier memories (no TTL)
      ---
      duration_ms: 418.2486
      type: 'test'
      ...
    1..2
ok 6 - Hierarchical Memory - Expiration
  ---
  duration_ms: 852.0046
  type: 'suite'
  ...
# Subtest: Hierarchical Memory - Statistics
    # Subtest: should return tier statistics
    not ok 1 - should return tier statistics
      ---
      duration_ms: 8.2167
      type: 'test'
      location: 'C:\\dev\\projects\\LLM-RULES\\.claude\\tools\\memory\\hierarchical-memory.test.mjs:579:3'
      failureType: 'testCodeFailure'
      error: |-
        Expected values to be strictly equal:
        
        9 !== 1
        
      code: 'ERR_ASSERTION'
      name: 'AssertionError'
      expected: 1
      actual: 9
      operator: 'strictEqual'
      stack: |-
        TestContext.<anonymous> (file:///C:/dev/projects/LLM-RULES/.claude/tools/memory/hierarchical-memory.test.mjs:616:12)
        async Test.run (node:internal/test_runner/test:1054:7)
        async Promise.all (index 0)
        async Suite.run (node:internal/test_runner/test:1442:7)
        async Test.processPendingSubtests (node:internal/test_runner/test:744:7)
      ...
    # Subtest: should identify promotion candidates
    ok 2 - should identify promotion candidates
      ---
      duration_ms: 10.773
      type: 'test'
      ...
    1..2
not ok 7 - Hierarchical Memory - Statistics
  ---
  duration_ms: 19.1392
  type: 'suite'
  location: 'C:\\dev\\projects\\LLM-RULES\\.claude\\tools\\memory\\hierarchical-memory.test.mjs:578:1'
  failureType: 'subtestsFailed'
  error: '1 subtest failed'
  code: 'ERR_TEST_FAILURE'
  ...
# Subtest: Hierarchical Memory - Performance
    # Subtest: should assign tier in <5ms
    ok 1 - should assign tier in <5ms
      ---
      duration_ms: 9.2845
      type: 'test'
      ...
    # Subtest: should check promotion in <50ms
    ok 2 - should check promotion in <50ms
      ---
      duration_ms: 8.6208
      type: 'test'
      ...
    # Subtest: should search across tiers in <200ms
    ok 3 - should search across tiers in <200ms
      ---
      duration_ms: 26.9236
      type: 'test'
      ...
    1..3
ok 8 - Hierarchical Memory - Performance
  ---
  duration_ms: 45.0182
  type: 'suite'
  ...
# Subtest: Hierarchical Memory - Factory Function
    # Subtest: should create manager via factory function
    ok 1 - should create manager via factory function
      ---
      duration_ms: 17.7796
      type: 'test'
      ...
    1..1
ok 9 - Hierarchical Memory - Factory Function
  ---
  duration_ms: 17.9278
  type: 'suite'
  ...
1..9
# tests 22
# suites 9
# pass 19
# fail 3
# cancelled 0
# skipped 0
# todo 0
# duration_ms 1455.2724
