# ============================================================================
# Agent-Studio Environment Variables
# ============================================================================
# Copy this file to .env and customize for your local environment
# NOTE: .env is gitignored and will NOT be committed
#
# Version: 2.2.1
# Last Updated: 2026-01-29
# ============================================================================

# ----------------------------------------------------------------------------
# 1. ENVIRONMENT SELECTION (CRITICAL)
# ----------------------------------------------------------------------------
# Controls which configuration file is loaded and which paths are used
# Values: development | staging | production
# Default: development
#
AGENT_STUDIO_ENV=development

# Fallback environment selector (used if AGENT_STUDIO_ENV not set)
# Values: development | production
# Default: development
#
# NODE_ENV=development

# ----------------------------------------------------------------------------
# 2. FEATURE FLAGS (Override config.yaml)
# ----------------------------------------------------------------------------
# Party Mode: Multi-agent collaboration framework
# Default: false (must be explicitly enabled)
#
# PARTY_MODE_ENABLED=false

# Advanced Elicitation: Multi-method requirements gathering
# Default: false (must be explicitly enabled)
#
# ELICITATION_ENABLED=false

# ----------------------------------------------------------------------------
# 3. REFLECTION HOOKS (Quality & Learning)
# ----------------------------------------------------------------------------
# Enable/disable all reflection hooks
# Default: true (enabled)
#
# REFLECTION_ENABLED=true

# Reflection hook enforcement mode
# Values: block | warn | off
# Default: block
#
# REFLECTION_HOOK_MODE=block

# ----------------------------------------------------------------------------
# 4. SAFETY HOOKS (Loop Prevention, Anomaly Detection)
# ----------------------------------------------------------------------------
# Loop prevention enforcement mode
# Values: block | warn | off
# Default: block
#
# LOOP_PREVENTION_MODE=block

# Max evolution suggestions before loop detected
# Default: 3
#
# LOOP_EVOLUTION_BUDGET=3

# Cooldown period after loop detection (milliseconds)
# Default: 60000 (1 minute)
#
# LOOP_COOLDOWN_MS=60000

# Max recursion depth before loop flagged
# Default: 5
#
# LOOP_DEPTH_LIMIT=5

# Pattern repetitions before flagged as loop
# Default: 3
#
# LOOP_PATTERN_THRESHOLD=3

# Allow operations if loop prevention hook fails
# Default: false (fail-secure)
#
# LOOP_PREVENTION_FAIL_OPEN=false

# ----------------------------------------------------------------------------
# 5. ANOMALY DETECTION
# ----------------------------------------------------------------------------
# Enable/disable anomaly detection
# Default: true
#
# ANOMALY_DETECTION_ENABLED=true

# Token usage anomaly threshold (multiplier of baseline)
# Default: 2
#
# ANOMALY_TOKEN_MULTIPLIER=2

# Duration anomaly threshold (multiplier of baseline)
# Default: 3
#
# ANOMALY_DURATION_MULTIPLIER=3

# Consecutive failures before alert
# Default: 3
#
# ANOMALY_FAILURE_COUNT=3

# Pattern repetitions before flagged
# Default: 2
#
# ANOMALY_PATTERN_REPS=2

# ----------------------------------------------------------------------------
# 6. ROUTING & ORCHESTRATION
# ----------------------------------------------------------------------------
# Auto-rerouter behavior
# Values: suggest | block | off
# Default: suggest
#
# REROUTER_MODE=suggest

# Plan evolution guard mode
# Values: block | warn | off
# Default: block
#
# PLAN_EVOLUTION_GUARD=block

# ----------------------------------------------------------------------------
# 7. SESSION & DEBUGGING
# ----------------------------------------------------------------------------
# Override session ID (useful for testing)
# Default: auto-generated
#
# CLAUDE_SESSION_ID=

# Enable verbose hook debugging logs
# Default: false
#
# DEBUG_HOOKS=false

# ----------------------------------------------------------------------------
# 8. EXTERNAL INTEGRATIONS (Optional)
# ----------------------------------------------------------------------------
# Webhook authentication secret (if using webhooks)
# Default: null (webhooks disabled)
#
# WEBHOOK_SECRET=

# External API endpoint (if using external services)
# Default: http://localhost:3000
#
# API_URL=http://localhost:3000

# ----------------------------------------------------------------------------
# 9. MEMORY SYSTEM (ChromaDB Configuration)
# ----------------------------------------------------------------------------
# ChromaDB host for vector storage
# Default: localhost
#
# CHROMADB_HOST=localhost

# ChromaDB port
# Default: 8000 (or in-process mode if not specified)
#
# CHROMADB_PORT=8000

# ChromaDB persist directory (for in-process mode)
# Default: .claude/data/chromadb
#
# CHROMADB_PERSIST_DIR=.claude/data/chromadb

# ChromaDB collection name
# Default: agent-studio-memory
#
# CHROMADB_COLLECTION=agent-studio-memory

# Background sync worker interval (milliseconds)
# Default: 60000 (60 seconds)
# Periodic sync for memory files to SQLite and ChromaDB
#
# MEMORY_SYNC_INTERVAL_MS=60000

# Memory System Phased Rollout
# Enable/disable hybrid memory system (SQLite + ChromaDB)
# Default: false (must be explicitly enabled)
#
# MEMORY_SYSTEM_ENABLED=false

# Gradual rollout percentage for memory system (0-100)
# Default: 0 (disabled for all sessions)
# Recommended phases: 10 → 50 → 100
#
# MEMORY_ROLLOUT_PERCENTAGE=0

# ----------------------------------------------------------------------------
# 10. OBSERVABILITY (OpenTelemetry Configuration)
# ----------------------------------------------------------------------------
# Enable/disable OpenTelemetry SDK
# Default: false (must be explicitly enabled)
#
# OTEL_ENABLED=false

# OTLP endpoint for trace export (Arize Phoenix)
# Default: http://localhost:4317 (gRPC) or http://localhost:4318 (HTTP)
# Use gRPC for better performance (recommended)
#
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# BatchSpanProcessor configuration
# Max spans per batch (default: 512)
#
# OTEL_BATCH_SIZE=512

# Batch interval in milliseconds (default: 5000)
#
# OTEL_BATCH_TIMEOUT=5000

# ----------------------------------------------------------------------------
# 11. ARIZE PHOENIX (Observability Platform)
# ----------------------------------------------------------------------------
# Phoenix UI is accessible at http://localhost:6006 when container is running
#
# Start Phoenix:
#   docker-compose -f docker-compose.phoenix.yml up -d
#
# Stop Phoenix:
#   docker-compose -f docker-compose.phoenix.yml down
#
# Enable OpenTelemetry export to Phoenix:
#   OTEL_ENABLED=true
#   OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# ----------------------------------------------------------------------------
# 12. EVENT SYSTEM (Event-Driven Orchestration)
# ----------------------------------------------------------------------------
# Enable/disable EventBus (event-driven agent coordination)
# Default: true (enabled)
# When disabled, hooks/agents will not emit events
#
# EVENT_BUS_ENABLED=true

# Enable/disable priority-based event handling
# Default: true (enabled)
# When enabled, HIGH priority events processed before NORMAL/LOW
#
# EVENT_PRIORITY_ENABLED=true

# Event retention period (milliseconds)
# Default: 3600000 (1 hour)
# Events older than this are cleaned up to prevent memory leaks
#
# EVENT_RETENTION_MS=3600000

# Max event listeners per event type
# Default: 100
# Prevents memory leaks from unlimited listener registration
#
# EVENT_MAX_LISTENERS=100

# ----------------------------------------------------------------------------
# 13. AGENT EXECUTION LIMITS (Safety & Cost Control)
# ----------------------------------------------------------------------------
# Default max turns for agent execution
# Default: 50 (can be overridden per-agent in spawn params)
# Prevents infinite loops and runaway agents
#
# DEFAULT_MAX_TURNS=50

# Default max duration in milliseconds
# Default: 1800000 (30 minutes)
# Prevents long-running agents from blocking resources
#
# DEFAULT_MAX_DURATION_MS=1800000

# Default max cost in USD
# Default: 5.00
# Prevents unexpected API cost overruns
#
# DEFAULT_MAX_COST_USD=5.00

# Warning threshold (0.0-1.0)
# Default: 0.8 (80%)
# Emits AGENT_LIMIT_WARNING event when this threshold is reached
#
# EXECUTION_LIMIT_WARNING_THRESHOLD=0.8

# Timeout action when limits exceeded
# Values: warn | terminate | pause
# Default: terminate
# - warn: Log warning and continue
# - terminate: Stop agent execution immediately
# - pause: Pause and wait for manual intervention
#
# EXECUTION_TIMEOUT_ACTION=terminate

# Enable execution limit monitoring
# Default: true (enabled)
# When disabled, limits are not enforced (use for debugging only)
#
# EXECUTION_LIMITS_ENABLED=true

# ============================================================================
# STAGING ENVIRONMENT NOTES (Sections 1-13)
# ============================================================================
# When AGENT_STUDIO_ENV=staging:
# - Uses .claude/config.staging.yaml instead of config.yaml
# - Data paths: .claude/staging/* (isolated from development)
# - All features enabled by default for testing
# - Relaxed monitoring thresholds (2x production)
# - Verbose logging enabled
#
# Configuration Sections:
# 1. Environment Selection (CRITICAL)
# 2. Feature Flags (Party Mode, Elicitation)
# 3. Reflection Hooks (Quality & Learning)
# 4. Safety Hooks (Loop Prevention, Anomaly Detection)
# 5. Anomaly Detection
# 6. Routing & Orchestration
# 7. Session & Debugging
# 8. External Integrations (Optional)
# 9. Memory System (ChromaDB Configuration)
# 10. Observability (OpenTelemetry Configuration)
# 11. Arize Phoenix (Observability Platform)
# 12. Event System (Event-Driven Orchestration)
# 13. Agent Execution Limits (Safety & Cost Control)
#
# Setup staging:
#   1. Set AGENT_STUDIO_ENV=staging
#   2. Run: node .claude/tools/cli/init-staging.cjs
#   3. Verify: node --test tests/staging-smoke.test.mjs
#
# See: .claude/docs/STAGING_ENVIRONMENT.md
# ============================================================================
