{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Refactoring Plan",
  "description": "Schema for refactoring plan artifacts generated by refactoring-specialist agent",
  "required": ["plan_id", "created_date", "status", "objective", "technical_debt_assessment", "refactoring_approach"],
  "properties": {
    "plan_id": {
      "type": "string",
      "description": "Unique identifier for the refactoring plan"
    },
    "created_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the plan was created"
    },
    "author": {
      "type": "string",
      "description": "Agent or user who created the plan"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "review", "approved", "in_progress", "completed"],
      "description": "Current status of the refactoring plan"
    },
    "objective": {
      "type": "object",
      "required": ["why_now", "success_criteria"],
      "properties": {
        "why_now": {
          "type": "string",
          "description": "Rationale for performing refactoring now"
        },
        "success_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Measurable success criteria"
        },
        "expected_benefits": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Expected benefits from refactoring"
        },
        "business_justification": {
          "type": "string",
          "description": "Business case for refactoring"
        }
      }
    },
    "technical_debt_assessment": {
      "type": "object",
      "required": ["pain_points", "code_quality_metrics"],
      "properties": {
        "pain_points": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["pain_point", "impact", "priority"],
            "properties": {
              "pain_point": {
                "type": "string"
              },
              "impact": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              },
              "frequency": {
                "type": "string"
              },
              "priority": {
                "type": "string",
                "enum": ["P0", "P1", "P2", "P3"]
              },
              "quantification": {
                "type": "string"
              }
            }
          }
        },
        "debt_hotspots": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Areas with highest technical debt"
        },
        "instability_issues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "performance_issues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "code_quality_metrics": {
          "type": "object",
          "properties": {
            "cyclomatic_complexity": {
              "type": "number"
            },
            "code_duplication_percent": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "technical_debt_ratio": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "scope_definition": {
      "type": "object",
      "required": ["in_scope", "out_of_scope"],
      "properties": {
        "in_scope": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "out_of_scope": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "risks": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "refactoring_approach": {
      "type": "object",
      "required": ["strategy", "phases"],
      "properties": {
        "strategy": {
          "type": "string",
          "description": "Overall refactoring strategy"
        },
        "phases": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["phase_name", "steps"],
            "properties": {
              "phase_name": {
                "type": "string"
              },
              "steps": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "duration": {
                "type": "string"
              },
              "checkpoints": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "deliverables": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "sequencing_rationale": {
          "type": "string"
        }
      }
    },
    "safety_measures": {
      "type": "object",
      "properties": {
        "tests_to_add": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "tests_to_keep": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "migration_strategy": {
          "type": "string"
        },
        "rollout_plan": {
          "type": "string"
        }
      }
    },
    "impact_analysis": {
      "type": "object",
      "properties": {
        "teams_affected": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "systems_affected": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "communication_plan": {
          "type": "string"
        },
        "timeline_impact": {
          "type": "string"
        }
      }
    },
    "exit_criteria": {
      "type": "object",
      "properties": {
        "validation_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "acceptance_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "rollback_triggers": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "success_metrics": {
      "type": "object",
      "properties": {
        "code_quality_improvement": {
          "type": "string"
        },
        "performance_improvement": {
          "type": "string"
        },
        "maintainability_improvement": {
          "type": "string"
        },
        "developer_velocity": {
          "type": "string"
        },
        "bug_reduction": {
          "type": "string"
        }
      }
    }
  }
}

