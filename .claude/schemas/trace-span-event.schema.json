{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Trace Span Event (OTel/W3C compatible, file-based)",
  "type": "object",
  "required": ["ts", "trace_id", "span_id", "event_type", "span_kind"],
  "properties": {
    "ts": { "type": "string", "format": "date-time" },

    "trace_id": { "type": "string", "pattern": "^[0-9a-f]{32}$" },
    "span_id": { "type": "string", "pattern": "^[0-9a-f]{16}$" },
    "parent_span_id": {
      "anyOf": [{ "type": "null" }, { "type": "string", "pattern": "^[0-9a-f]{16}$" }]
    },

    "traceparent": { "type": ["string", "null"] },
    "tracestate": { "type": ["string", "null"] },

    "baggage": { "type": ["object", "null"], "additionalProperties": true },

    "span_kind": {
      "type": "string",
      "enum": ["agent", "tool", "llm", "chain", "router", "guard", "artifact"]
    },
    "event_type": {
      "type": "string",
      "enum": [
        "SpanStart",
        "SpanEnd",
        "AgentStart",
        "AgentStop",
        "ToolCallStart",
        "ToolCallStop",
        "ModelCallStart",
        "ModelCallStop",
        "RoutingDecision",
        "Handoff",
        "GuardDecision",
        "ArtifactWrite",
        "ArtifactRead",
        "Retry",
        "Timeout"
      ]
    },
    "span_state": { "type": ["string", "null"], "enum": ["start", "end", null] },
    "span_name": { "type": ["string", "null"] },

    "phase": { "type": ["string", "null"] },
    "run_id": { "type": ["string", "null"] },
    "session_key": { "type": ["string", "null"] },
    "agent": { "type": ["string", "null"] },
    "tool": { "type": ["string", "null"] },
    "activity": { "type": ["string", "null"] },
    "ok": { "type": ["boolean", "null"] },
    "duration_ms": { "type": ["number", "null"] },
    "error": { "type": ["string", "null"] },
    "delegated_agent": { "type": ["string", "null"] },

    "payload": { "type": ["object", "null"], "additionalProperties": true },
    "metrics": { "type": ["object", "null"], "additionalProperties": true },
    "policy": { "type": ["object", "null"], "additionalProperties": true },
    "quality": { "type": ["object", "null"], "additionalProperties": true }
  },
  "additionalProperties": true
}
