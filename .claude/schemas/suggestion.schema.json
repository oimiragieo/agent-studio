{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.com/schemas/suggestion.schema.json",
  "title": "Suggestion",
  "version": "1.0.0",
  "description": "Schema for interactive suggestions generated by suggestion-generator skill for Conductor workflows",
  "type": "object",
  "required": ["suggestion_id", "type", "title", "description", "priority", "status", "created_at"],
  "properties": {
    "suggestion_id": {
      "type": "string",
      "pattern": "^sug-[a-z0-9-]+$",
      "description": "Unique identifier for this suggestion"
    },
    "type": {
      "type": "string",
      "enum": [
        "next-step",
        "quick-win",
        "critical-fix",
        "optimization",
        "refactor",
        "documentation",
        "testing",
        "security",
        "performance",
        "accessibility",
        "dependency-update",
        "architecture",
        "cleanup",
        "feature",
        "learning"
      ],
      "description": "Category of the suggestion"
    },
    "title": {
      "type": "string",
      "minLength": 5,
      "maxLength": 100,
      "description": "Short, actionable title for the suggestion"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1000,
      "description": "Detailed explanation of what the suggestion entails"
    },
    "priority": {
      "type": "string",
      "enum": ["P0", "P1", "P2", "P3"],
      "description": "Priority level (P0=critical, P3=low priority)"
    },
    "status": {
      "type": "string",
      "enum": [
        "pending",
        "accepted",
        "rejected",
        "deferred",
        "in-progress",
        "completed",
        "expired"
      ],
      "description": "Current status of the suggestion"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when suggestion was created"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when suggestion was last updated"
    },
    "expires_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when suggestion expires (if applicable)"
    },
    "context": {
      "type": "object",
      "description": "Context information for the suggestion",
      "properties": {
        "trigger": {
          "type": "string",
          "enum": [
            "analysis",
            "user-action",
            "time-based",
            "dependency-change",
            "error-detected",
            "pattern-match",
            "workflow-step",
            "track-completion",
            "manual"
          ],
          "description": "What triggered this suggestion"
        },
        "source_analysis_id": {
          "type": "string",
          "description": "Reference to project analysis that generated this suggestion"
        },
        "source_track_id": {
          "type": "string",
          "description": "Reference to track that generated this suggestion"
        },
        "related_files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Files related to this suggestion"
        },
        "related_suggestions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of related suggestions"
        },
        "prerequisites": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Suggestion IDs that must be completed first"
        }
      }
    },
    "action": {
      "type": "object",
      "required": ["type"],
      "description": "Recommended action to take",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "run-command",
            "edit-file",
            "create-file",
            "delete-file",
            "spawn-agent",
            "run-workflow",
            "ask-question",
            "review",
            "manual",
            "approve",
            "defer"
          ],
          "description": "Type of action to perform"
        },
        "command": {
          "type": "string",
          "description": "Shell command to run (if type=run-command)"
        },
        "file_path": {
          "type": "string",
          "description": "Target file path (if type=edit-file/create-file/delete-file)"
        },
        "agent": {
          "type": "string",
          "description": "Agent to spawn (if type=spawn-agent)"
        },
        "workflow": {
          "type": "string",
          "description": "Workflow to run (if type=run-workflow)"
        },
        "task_template": {
          "type": "object",
          "description": "Pre-filled task template for agent delegation"
        },
        "auto_executable": {
          "type": "boolean",
          "default": false,
          "description": "Whether this action can be executed automatically without user confirmation"
        },
        "reversible": {
          "type": "boolean",
          "default": true,
          "description": "Whether this action can be undone"
        },
        "estimated_duration_minutes": {
          "type": "integer",
          "minimum": 1,
          "description": "Estimated time to complete this action"
        }
      }
    },
    "impact": {
      "type": "object",
      "description": "Expected impact of implementing this suggestion",
      "properties": {
        "areas_affected": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "code-quality",
              "performance",
              "security",
              "maintainability",
              "testing",
              "documentation",
              "developer-experience",
              "user-experience",
              "architecture",
              "dependencies"
            ]
          },
          "description": "Areas of the project affected"
        },
        "files_affected": {
          "type": "integer",
          "minimum": 0,
          "description": "Estimated number of files that will be modified"
        },
        "breaking_change": {
          "type": "boolean",
          "default": false,
          "description": "Whether this introduces breaking changes"
        },
        "risk_level": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "Risk level of implementing this suggestion"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence that this suggestion is beneficial (0-1)"
        },
        "value_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Calculated value score based on impact vs effort"
        }
      }
    },
    "effort": {
      "type": "object",
      "description": "Estimated effort to implement",
      "properties": {
        "complexity": {
          "type": "string",
          "enum": ["trivial", "simple", "moderate", "complex", "very-complex"],
          "description": "Implementation complexity"
        },
        "time_estimate": {
          "type": "string",
          "enum": ["minutes", "hours", "day", "days", "week", "weeks"],
          "description": "Estimated time to implement"
        },
        "skills_required": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Skills or knowledge required"
        },
        "agents_recommended": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Recommended agents for this task"
        }
      }
    },
    "rationale": {
      "type": "object",
      "description": "Reasoning behind this suggestion",
      "properties": {
        "why": {
          "type": "string",
          "description": "Why this suggestion is being made"
        },
        "benefits": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Expected benefits"
        },
        "risks_of_inaction": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Risks of not implementing this suggestion"
        },
        "alternatives": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["description"],
            "properties": {
              "description": { "type": "string" },
              "pros": { "type": "array", "items": { "type": "string" } },
              "cons": { "type": "array", "items": { "type": "string" } }
            }
          },
          "description": "Alternative approaches considered"
        },
        "evidence": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Evidence supporting this suggestion"
        }
      }
    },
    "user_response": {
      "type": "object",
      "description": "User's response to this suggestion",
      "properties": {
        "action_taken": {
          "type": "string",
          "enum": ["accepted", "rejected", "deferred", "modified"],
          "description": "Action taken by user"
        },
        "responded_at": {
          "type": "string",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "User notes about their decision"
        },
        "defer_until": {
          "type": "string",
          "format": "date-time",
          "description": "If deferred, when to resurface"
        },
        "modified_action": {
          "type": "object",
          "description": "If modified, the new action definition"
        }
      }
    },
    "execution": {
      "type": "object",
      "description": "Execution tracking",
      "properties": {
        "started_at": {
          "type": "string",
          "format": "date-time"
        },
        "completed_at": {
          "type": "string",
          "format": "date-time"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0
        },
        "result": {
          "type": "string",
          "enum": ["success", "partial", "failed", "cancelled"]
        },
        "output": {
          "type": "string",
          "description": "Output from execution"
        },
        "artifacts_created": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Artifacts created during execution"
        },
        "error": {
          "type": "string",
          "description": "Error message if failed"
        }
      }
    },
    "display": {
      "type": "object",
      "description": "Display formatting hints",
      "properties": {
        "icon": {
          "type": "string",
          "description": "Icon identifier for UI"
        },
        "color": {
          "type": "string",
          "description": "Color coding (hex or named)"
        },
        "category_label": {
          "type": "string",
          "description": "Human-readable category label"
        },
        "action_button_text": {
          "type": "string",
          "description": "Text for the action button"
        },
        "show_in_dashboard": {
          "type": "boolean",
          "default": true,
          "description": "Whether to show in main dashboard"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "generator_version": { "type": "string" },
        "project_id": { "type": "string" },
        "session_id": { "type": "string" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "batch_id": {
          "type": "string",
          "description": "ID of the suggestion batch this belongs to"
        },
        "position_in_batch": {
          "type": "integer",
          "minimum": 1,
          "description": "Position within suggestion batch"
        }
      }
    }
  }
}
