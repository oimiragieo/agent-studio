{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Run State",
  "description": "Compressed state for multi-agent orchestration runs",
  "type": "object",
  "required": ["run_id", "workflow", "current_step", "goal"],
  "properties": {
    "run_id": {
      "type": "string",
      "pattern": "^run-[a-z0-9-]+$",
      "description": "Unique run identifier"
    },
    "workflow": {
      "type": "string",
      "description": "Active workflow name"
    },
    "current_step": {
      "type": "integer",
      "minimum": 0,
      "description": "Current workflow step number"
    },
    "goal": {
      "type": "string",
      "maxLength": 500,
      "description": "Current goal (truncated to 500 chars)"
    },
    "decisions": {
      "type": "array",
      "items": {
        "type": "string",
        "maxLength": 100
      },
      "maxItems": 10,
      "description": "Key decisions made (last 10)"
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "path"],
        "properties": {
          "name": { "type": "string" },
          "path": { "type": "string" },
          "added_at": { "type": "string", "format": "date-time" }
        }
      },
      "description": "Artifact references (paths only, not content)"
    },
    "active_agents": {
      "type": "array",
      "items": { "type": "string" },
      "maxItems": 3,
      "description": "Currently active agents (last 3)"
    },
    "compressed_history": {
      "type": "string",
      "maxLength": 2000,
      "description": "Rolling compressed history"
    },
    "handoff_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Total handoffs in this run"
    },
    "metrics": {
      "type": "object",
      "properties": {
        "total_handoffs": { "type": "integer" },
        "compression_count": { "type": "integer" },
        "bytes_saved": { "type": "integer" },
        "created_at": { "type": "string", "format": "date-time" }
      }
    },
    "updated_at": {
      "type": "string",
      "format": "date-time"
    },
    "_compressed": {
      "type": "boolean",
      "description": "True if state was compressed for agent delivery"
    },
    "_budget": {
      "type": "integer",
      "description": "Context budget used for compression"
    },
    "_actual_size": {
      "type": "integer",
      "description": "Actual size after compression"
    }
  }
}
