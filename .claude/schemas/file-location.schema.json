{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.dev/schemas/file-location.schema.json",
  "title": "File Location Validation Schema",
  "description": "Schema for validating file locations to prevent SLOP (files in wrong locations)",
  "type": "object",
  "required": ["file_path", "file_type"],
  "properties": {
    "file_path": {
      "type": "string",
      "description": "The file path to validate",
      "minLength": 1
    },
    "file_type": {
      "type": "string",
      "enum": [
        "report",
        "task",
        "artifact",
        "plan",
        "reasoning",
        "gate",
        "documentation",
        "agent",
        "skill",
        "schema",
        "template",
        "workflow",
        "guardrail",
        "permission",
        "temporary",
        "log",
        "run_state",
        "root_allowed",
        "source_code"
      ],
      "description": "The type of file being created"
    },
    "validation_result": {
      "type": "object",
      "properties": {
        "valid": {
          "type": "boolean",
          "description": "Whether the file location is valid"
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of validation errors"
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of validation warnings"
        },
        "suggested_path": {
          "type": "string",
          "description": "Suggested correct path if current path is invalid"
        }
      },
      "required": ["valid"]
    }
  },
  "definitions": {
    "file_location_rules": {
      "type": "object",
      "description": "Mapping of file types to required locations",
      "properties": {
        "report": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/context/reports/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*-report.md", "*-report.json"]
            }
          }
        },
        "task": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/context/tasks/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*-task.md", "*-task.json"]
            }
          }
        },
        "artifact": {
          "type": "object",
          "properties": {
            "required_paths": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                ".claude/context/artifacts/",
                ".claude/context/runtime/runs/{run_id}/artifacts/"
              ]
            }
          }
        },
        "plan": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/context/artifacts/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["plan-*.md", "plan-*.json"]
            }
          }
        },
        "reasoning": {
          "type": "object",
          "properties": {
            "required_path_pattern": {
              "const": ".claude/context/history/reasoning/{workflow}/"
            }
          }
        },
        "gate": {
          "type": "object",
          "properties": {
            "required_path_pattern": {
              "const": ".claude/context/history/gates/{workflow}/"
            }
          }
        },
        "documentation": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/docs/"
            }
          }
        },
        "agent": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/agents/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*.md"]
            }
          }
        },
        "skill": {
          "type": "object",
          "properties": {
            "required_path_pattern": {
              "const": ".claude/skills/{skill_name}/"
            },
            "required_file": {
              "const": "SKILL.md"
            }
          }
        },
        "schema": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/schemas/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*.schema.json"]
            }
          }
        },
        "template": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/templates/"
            }
          }
        },
        "workflow": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/workflows/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*.yaml"]
            }
          }
        },
        "guardrail": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/system/guardrails/"
            }
          }
        },
        "permission": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/system/permissions/"
            }
          }
        },
        "temporary": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/context/tmp/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["tmp-*"]
            },
            "cleanup_required": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "log": {
          "type": "object",
          "properties": {
            "required_path": {
              "const": ".claude/context/logs/"
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*.log", "*.txt"]
            }
          }
        },
        "run_state": {
          "type": "object",
          "properties": {
            "required_path_pattern": {
              "const": ".claude/context/runtime/runs/{run_id}/"
            }
          }
        }
      }
    },
    "root_allowlist": {
      "type": "array",
      "description": "Files allowed in project root directory",
      "items": {
        "type": "string"
      },
      "default": [
        "package.json",
        "package-lock.json",
        "pnpm-lock.yaml",
        "yarn.lock",
        "README.md",
        "GETTING_STARTED.md",
        "LICENSE",
        ".gitignore",
        ".npmrc",
        ".nvmrc",
        ".editorconfig",
        "tsconfig.json",
        "eslint.config.js",
        ".eslintrc.json",
        "prettier.config.js",
        ".prettierrc",
        "CHANGELOG.md",
        "CONTRIBUTING.md",
        "CODE_OF_CONDUCT.md",
        "SECURITY.md"
      ]
    },
    "prohibited_locations": {
      "type": "array",
      "description": "Directories where files must never be created",
      "items": {
        "type": "string"
      },
      "default": [
        "node_modules/",
        ".git/",
        "dist/",
        "build/",
        "out/",
        ".next/",
        ".nuxt/",
        "coverage/"
      ]
    },
    "malformed_path_patterns": {
      "type": "array",
      "description": "Regex patterns that indicate malformed Windows paths",
      "items": {
        "type": "object",
        "properties": {
          "pattern": {
            "type": "string",
            "description": "Regex pattern"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of the issue"
          }
        }
      },
      "default": [
        {
          "pattern": "^[A-Z]:(?![/\\\\])",
          "description": "Windows path missing separator after drive letter (negative lookahead)"
        },
        {
          "pattern": "^[A-Z]:[A-Z]:",
          "description": "Duplicate drive letters"
        },
        {
          "pattern": "^[A-Z]:[a-zA-Z]+[A-Z][a-zA-Z]+",
          "description": "Windows path with concatenated segments after drive letter"
        },
        {
          "pattern": "[a-z]{4,}[A-Z][a-z].*[a-z]{4,}[A-Z]",
          "description": "Path segments concatenated without separators (camelCase-like)"
        },
        {
          "pattern": "\\\\\\\\",
          "description": "Double backslashes (escaped incorrectly)"
        },
        {
          "pattern": "^[^/\\\\]+[a-z]{3,}\\.claude",
          "description": "Path to .claude without separator"
        }
      ]
    },
    "windows_reserved_names": {
      "type": "array",
      "description": "Windows reserved device names that cannot be used as filenames",
      "items": {
        "type": "string"
      },
      "default": [
        "CON",
        "PRN",
        "AUX",
        "NUL",
        "COM1",
        "COM2",
        "COM3",
        "COM4",
        "COM5",
        "COM6",
        "COM7",
        "COM8",
        "COM9",
        "LPT1",
        "LPT2",
        "LPT3",
        "LPT4",
        "LPT5",
        "LPT6",
        "LPT7",
        "LPT8",
        "LPT9"
      ]
    }
  },
  "examples": [
    {
      "file_path": ".claude/context/reports/security-audit-report.md",
      "file_type": "report",
      "validation_result": {
        "valid": true,
        "errors": [],
        "warnings": []
      }
    },
    {
      "file_path": "security-audit-report.md",
      "file_type": "report",
      "validation_result": {
        "valid": false,
        "errors": ["Report files must be in .claude/context/reports/, not project root"],
        "warnings": [],
        "suggested_path": ".claude/context/reports/security-audit-report.md"
      }
    },
    {
      "file_path": "CdevprojectsLLM-RULES.claudecontextreport.md",
      "file_type": "report",
      "validation_result": {
        "valid": false,
        "errors": [
          "Malformed Windows path: missing separators",
          "Path segments appear concatenated without separators"
        ],
        "warnings": [],
        "suggested_path": ".claude/context/reports/report.md"
      }
    }
  ]
}
