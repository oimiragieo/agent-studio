{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Studio Event Schema",
  "description": "JSON Schema for validating Agent Studio event payloads (32+ event types across 6 categories)",
  "definitions": {
    "baseEvent": {
      "type": "object",
      "required": ["type", "timestamp"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Event type (e.g., 'AGENT_STARTED')"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp"
        },
        "metadata": {
          "type": "object",
          "description": "Optional extensibility field for custom data"
        }
      }
    },
    "agentEvent": {
      "allOf": [
        { "$ref": "#/definitions/baseEvent" },
        {
          "properties": {
            "type": {
              "enum": [
                "AGENT_STARTED",
                "AGENT_COMPLETED",
                "AGENT_FAILED",
                "AGENT_PAUSED",
                "AGENT_RESUMED",
                "AGENT_SPAWNED"
              ]
            },
            "agentId": { "type": "string" },
            "agentType": { "type": "string" },
            "taskId": { "type": "string" }
          },
          "required": ["agentId", "agentType", "taskId"]
        }
      ]
    },
    "agentCompleted": {
      "allOf": [
        { "$ref": "#/definitions/agentEvent" },
        {
          "properties": {
            "type": { "const": "AGENT_COMPLETED" },
            "duration": { "type": "number", "minimum": 0 },
            "result": {}
          },
          "required": ["duration", "result"]
        }
      ]
    },
    "agentFailed": {
      "allOf": [
        { "$ref": "#/definitions/agentEvent" },
        {
          "properties": {
            "type": { "const": "AGENT_FAILED" },
            "error": {
              "type": "object",
              "properties": {
                "message": { "type": "string" },
                "stack": { "type": "string" },
                "code": { "type": "string" }
              }
            }
          },
          "required": ["error"]
        }
      ]
    },
    "taskEvent": {
      "allOf": [
        { "$ref": "#/definitions/baseEvent" },
        {
          "properties": {
            "type": {
              "enum": [
                "TASK_CREATED",
                "TASK_UPDATED",
                "TASK_COMPLETED",
                "TASK_FAILED",
                "TASK_BLOCKED",
                "TASK_UNBLOCKED",
                "TASK_DELETED"
              ]
            },
            "taskId": { "type": "string" }
          },
          "required": ["taskId"]
        }
      ]
    },
    "taskCreated": {
      "allOf": [
        { "$ref": "#/definitions/taskEvent" },
        {
          "properties": {
            "type": { "const": "TASK_CREATED" },
            "subject": { "type": "string" },
            "description": { "type": "string" }
          },
          "required": ["subject", "description"]
        }
      ]
    },
    "taskUpdated": {
      "allOf": [
        { "$ref": "#/definitions/taskEvent" },
        {
          "properties": {
            "type": { "const": "TASK_UPDATED" },
            "status": {
              "enum": ["pending", "in_progress", "completed", "blocked"]
            }
          },
          "required": ["status"]
        }
      ]
    },
    "taskCompleted": {
      "allOf": [
        { "$ref": "#/definitions/taskEvent" },
        {
          "properties": {
            "type": { "const": "TASK_COMPLETED" },
            "result": {},
            "duration": { "type": "number", "minimum": 0 }
          },
          "required": ["result", "duration"]
        }
      ]
    },
    "toolEvent": {
      "allOf": [
        { "$ref": "#/definitions/baseEvent" },
        {
          "properties": {
            "type": {
              "enum": [
                "TOOL_INVOKED",
                "TOOL_COMPLETED",
                "TOOL_FAILED",
                "TOOL_BLOCKED",
                "TOOL_RETRIED"
              ]
            },
            "toolName": { "type": "string" }
          },
          "required": ["toolName"]
        }
      ]
    },
    "toolInvoked": {
      "allOf": [
        { "$ref": "#/definitions/toolEvent" },
        {
          "properties": {
            "type": { "const": "TOOL_INVOKED" },
            "input": {},
            "agentId": { "type": "string" },
            "taskId": { "type": "string" }
          },
          "required": ["input", "agentId", "taskId"]
        }
      ]
    },
    "toolCompleted": {
      "allOf": [
        { "$ref": "#/definitions/toolEvent" },
        {
          "properties": {
            "type": { "const": "TOOL_COMPLETED" },
            "output": {},
            "duration": { "type": "number", "minimum": 0 }
          },
          "required": ["output", "duration"]
        }
      ]
    },
    "toolFailed": {
      "allOf": [
        { "$ref": "#/definitions/toolEvent" },
        {
          "properties": {
            "type": { "const": "TOOL_FAILED" },
            "error": {
              "type": "object",
              "properties": {
                "message": { "type": "string" }
              }
            }
          },
          "required": ["error"]
        }
      ]
    },
    "memoryEvent": {
      "allOf": [
        { "$ref": "#/definitions/baseEvent" },
        {
          "properties": {
            "type": {
              "enum": [
                "MEMORY_SAVED",
                "MEMORY_QUERIED",
                "MEMORY_UPDATED",
                "MEMORY_DELETED",
                "MEMORY_INDEXED"
              ]
            }
          }
        }
      ]
    },
    "memorySaved": {
      "allOf": [
        { "$ref": "#/definitions/memoryEvent" },
        {
          "properties": {
            "type": { "const": "MEMORY_SAVED" },
            "key": { "type": "string" },
            "value": {},
            "source": { "type": "string" }
          },
          "required": ["key", "value", "source"]
        }
      ]
    },
    "memoryQueried": {
      "allOf": [
        { "$ref": "#/definitions/memoryEvent" },
        {
          "properties": {
            "type": { "const": "MEMORY_QUERIED" },
            "query": { "type": "string" },
            "results": { "type": "number", "minimum": 0 },
            "latency": { "type": "number", "minimum": 0 }
          },
          "required": ["query", "results", "latency"]
        }
      ]
    },
    "llmEvent": {
      "allOf": [
        { "$ref": "#/definitions/baseEvent" },
        {
          "properties": {
            "type": {
              "enum": ["LLM_CALLED", "LLM_COMPLETED", "LLM_FAILED", "LLM_CACHED"]
            },
            "model": {
              "enum": ["haiku", "sonnet", "opus"]
            }
          },
          "required": ["model"]
        }
      ]
    },
    "llmCalled": {
      "allOf": [
        { "$ref": "#/definitions/llmEvent" },
        {
          "properties": {
            "type": { "const": "LLM_CALLED" },
            "promptTokens": { "type": "number", "minimum": 0 }
          },
          "required": ["promptTokens"]
        }
      ]
    },
    "llmCompleted": {
      "allOf": [
        { "$ref": "#/definitions/llmEvent" },
        {
          "properties": {
            "type": { "const": "LLM_COMPLETED" },
            "completionTokens": { "type": "number", "minimum": 0 },
            "totalTokens": { "type": "number", "minimum": 0 },
            "latency": { "type": "number", "minimum": 0 },
            "cost": { "type": "number", "minimum": 0 }
          },
          "required": ["completionTokens", "totalTokens", "latency", "cost"]
        }
      ]
    },
    "mcpEvent": {
      "allOf": [
        { "$ref": "#/definitions/baseEvent" },
        {
          "properties": {
            "type": {
              "enum": [
                "MCP_TOOL_DISCOVERED",
                "MCP_TOOL_INVOKED",
                "MCP_TOOL_COMPLETED",
                "MCP_TOOL_FAILED",
                "MCP_SERVER_CONNECTED"
              ]
            },
            "server": { "type": "string" }
          },
          "required": ["server"]
        }
      ]
    },
    "mcpToolDiscovered": {
      "allOf": [
        { "$ref": "#/definitions/mcpEvent" },
        {
          "properties": {
            "type": { "const": "MCP_TOOL_DISCOVERED" },
            "toolName": { "type": "string" }
          },
          "required": ["toolName"]
        }
      ]
    },
    "mcpToolInvoked": {
      "allOf": [
        { "$ref": "#/definitions/mcpEvent" },
        {
          "properties": {
            "type": { "const": "MCP_TOOL_INVOKED" },
            "toolName": { "type": "string" },
            "input": {},
            "agentId": { "type": "string" }
          },
          "required": ["toolName", "input", "agentId"]
        }
      ]
    }
  },
  "anyOf": [
    { "$ref": "#/definitions/agentEvent" },
    { "$ref": "#/definitions/agentCompleted" },
    { "$ref": "#/definitions/agentFailed" },
    { "$ref": "#/definitions/taskEvent" },
    { "$ref": "#/definitions/taskCreated" },
    { "$ref": "#/definitions/taskUpdated" },
    { "$ref": "#/definitions/taskCompleted" },
    { "$ref": "#/definitions/toolEvent" },
    { "$ref": "#/definitions/toolInvoked" },
    { "$ref": "#/definitions/toolCompleted" },
    { "$ref": "#/definitions/toolFailed" },
    { "$ref": "#/definitions/memoryEvent" },
    { "$ref": "#/definitions/memorySaved" },
    { "$ref": "#/definitions/memoryQueried" },
    { "$ref": "#/definitions/llmEvent" },
    { "$ref": "#/definitions/llmCalled" },
    { "$ref": "#/definitions/llmCompleted" },
    { "$ref": "#/definitions/mcpEvent" },
    { "$ref": "#/definitions/mcpToolDiscovered" },
    { "$ref": "#/definitions/mcpToolInvoked" }
  ]
}
