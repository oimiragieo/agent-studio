{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Publishing Audit Log",
  "description": "Audit log structure for tracking artifact publishing actions and permissions",
  "required": ["timestamp", "agent", "artifact_name", "action", "target"],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when action occurred"
    },
    "agent": {
      "type": "string",
      "description": "Agent that performed the action"
    },
    "artifact_name": {
      "type": "string",
      "description": "Name of the artifact being published"
    },
    "action": {
      "type": "string",
      "enum": [
        "publish",
        "publish_attempt",
        "publish_failure",
        "permission_denied",
        "validation_failed"
      ],
      "description": "Type of action performed"
    },
    "target": {
      "type": "string",
      "enum": ["project_feed", "cursor"],
      "description": "Target platform for publishing"
    },
    "permission_check": {
      "type": "object",
      "description": "Permission validation result",
      "properties": {
        "allowed": {
          "type": "boolean",
          "description": "Whether permission was granted"
        },
        "reason": {
          "type": ["string", "null"],
          "description": "Reason for permission denial (if denied)"
        },
        "agent_permissions": {
          "type": "array",
          "description": "Allowed targets from agent frontmatter",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["allowed"]
    },
    "validation_status": {
      "type": ["string", "null"],
      "enum": ["pass", "fail", "pending", null],
      "description": "Validation status at time of publishing"
    },
    "result": {
      "type": "string",
      "enum": ["success", "failed", "denied"],
      "description": "Result of the publishing action"
    },
    "error": {
      "type": ["string", "null"],
      "description": "Error message if action failed"
    },
    "run_id": {
      "type": ["string", "null"],
      "description": "Workflow run identifier"
    },
    "workflow_id": {
      "type": ["string", "null"],
      "description": "Workflow identifier"
    }
  }
}
