{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Breaking Changes Research",
  "description": "Schema for breaking changes research artifacts generated during dependency analysis",
  "required": ["research_id", "research_date", "researcher_agent", "packages_researched"],
  "properties": {
    "research_id": {
      "type": "string",
      "description": "Unique identifier for the research artifact"
    },
    "research_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the research was conducted"
    },
    "researcher_agent": {
      "type": "string",
      "description": "Agent that conducted the research (e.g., developer)"
    },
    "packages_researched": {
      "type": "array",
      "description": "List of packages researched for breaking changes",
      "items": {
        "type": "object",
        "required": ["package_name", "current_version", "latest_version"],
        "properties": {
          "package_name": {
            "type": "string",
            "description": "Name of the package"
          },
          "current_version": {
            "type": "string",
            "description": "Currently installed version"
          },
          "latest_version": {
            "type": "string",
            "description": "Latest available version"
          },
          "update_type": {
            "type": "string",
            "enum": ["major", "minor", "patch"],
            "description": "Type of update (should be 'major' for breaking changes research)"
          },
          "breaking_changes": {
            "type": "array",
            "description": "List of breaking changes identified",
            "items": {
              "type": "object",
              "required": ["description"],
              "properties": {
                "description": {
                  "type": "string",
                  "description": "Description of the breaking change"
                },
                "category": {
                  "type": "string",
                  "enum": ["api_change", "configuration_change", "dependency_change", "removed_feature", "behavior_change", "other"],
                  "description": "Category of the breaking change"
                },
                "impact": {
                  "type": "string",
                  "enum": ["low", "medium", "high", "critical"],
                  "description": "Impact level of the breaking change"
                },
                "affected_apis": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "List of APIs or features affected"
                },
                "migration_complexity": {
                  "type": "string",
                  "enum": ["simple", "moderate", "complex", "very_complex"],
                  "description": "Complexity of migrating from this breaking change"
                }
              }
            }
          },
          "migration_guides": {
            "type": "array",
            "description": "Migration guides and documentation found",
            "items": {
              "type": "object",
              "required": ["title", "url"],
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Title of the migration guide"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL to the migration guide"
                },
                "source": {
                  "type": "string",
                  "enum": ["official_docs", "github", "blog_post", "community", "other"],
                  "description": "Source of the migration guide"
                },
                "summary": {
                  "type": "string",
                  "description": "Summary of key migration steps from the guide"
                },
                "relevance_score": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "Relevance score of the migration guide (0-1)"
                }
              }
            }
          },
          "changelog_entries": {
            "type": "array",
            "description": "Relevant changelog entries",
            "items": {
              "type": "object",
              "properties": {
                "version": {
                  "type": "string",
                  "description": "Version number"
                },
                "entry": {
                  "type": "string",
                  "description": "Changelog entry text"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL to the changelog entry"
                }
              }
            }
          },
          "github_issues": {
            "type": "array",
            "description": "Relevant GitHub issues or PRs found",
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Issue or PR title"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL to the issue or PR"
                },
                "number": {
                  "type": "integer",
                  "description": "Issue or PR number"
                },
                "state": {
                  "type": "string",
                  "enum": ["open", "closed", "merged"],
                  "description": "State of the issue or PR"
                },
                "relevance": {
                  "type": "string",
                  "enum": ["high", "medium", "low"],
                  "description": "Relevance to the breaking changes"
                }
              }
            }
          },
          "research_sources": {
            "type": "array",
            "description": "URLs and sources used for research",
            "items": {
              "type": "object",
              "required": ["url", "source_type"],
              "properties": {
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL of the source"
                },
                "source_type": {
                  "type": "string",
                  "enum": ["web_search", "official_docs", "github", "npm_registry", "blog", "forum", "other"],
                  "description": "Type of source"
                },
                "search_query": {
                  "type": "string",
                  "description": "Search query used to find this source (if applicable)"
                },
                "tool_used": {
                  "type": "string",
                  "enum": ["exa", "webfetch", "ref", "manual"],
                  "description": "Tool used to find this source"
                },
                "relevance": {
                  "type": "string",
                  "enum": ["high", "medium", "low"],
                  "description": "Relevance of this source"
                }
              }
            }
          },
          "risk_assessment": {
            "type": "object",
            "required": ["risk_level", "impact_analysis"],
            "properties": {
              "risk_level": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"],
                "description": "Overall risk level of the update"
              },
              "impact_analysis": {
                "type": "string",
                "description": "Analysis of the impact on the codebase"
              },
              "affected_files": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "List of files that would be affected by the update"
              },
              "affected_features": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "List of features that would be affected"
              },
              "compatibility_concerns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Compatibility concerns identified"
              },
              "testing_requirements": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Testing requirements before and after update"
              }
            }
          },
          "estimated_effort": {
            "type": "object",
            "properties": {
              "time_estimate": {
                "type": "string",
                "description": "Estimated time to complete migration (e.g., '2-4 hours', '1 day')"
              },
              "complexity": {
                "type": "string",
                "enum": ["simple", "moderate", "complex", "very_complex"],
                "description": "Overall complexity of the migration"
              },
              "steps_required": {
                "type": "integer",
                "minimum": 0,
                "description": "Estimated number of steps required"
              },
              "dependencies": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Other packages or updates that should be done first"
              }
            }
          },
          "recommendation": {
            "type": "object",
            "properties": {
              "should_update": {
                "type": "boolean",
                "description": "Whether the package should be updated"
              },
              "priority": {
                "type": "string",
                "enum": ["P0", "P1", "P2", "P3"],
                "description": "Priority of the update (P0 = critical, P3 = low)"
              },
              "rationale": {
                "type": "string",
                "description": "Reasoning for the recommendation"
              },
              "suggested_phase": {
                "type": "integer",
                "minimum": 1,
                "description": "Suggested phase number in update strategy"
              },
              "blockers": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Blockers that prevent immediate update"
              }
            }
          }
        }
      }
    },
    "research_summary": {
      "type": "object",
      "properties": {
        "total_packages_researched": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of packages researched"
        },
        "packages_with_breaking_changes": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages with identified breaking changes"
        },
        "migration_guides_found": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of migration guides found"
        },
        "high_risk_updates": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages with high or critical risk"
        },
        "research_tools_used": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of research tools used (e.g., Exa, WebFetch, Ref)"
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "dependency_analysis_source": {
          "type": "string",
          "description": "Source artifact that triggered this research (e.g., dependency-analysis-{id}.json)"
        },
        "research_method": {
          "type": "string",
          "enum": ["web_search", "documentation_review", "changelog_analysis", "community_research", "combined"],
          "description": "Primary research method used"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about the research process"
        }
      }
    }
  }
}

