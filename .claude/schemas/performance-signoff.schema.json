{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.com/schemas/performance-signoff.schema.json",
  "title": "Performance Signoff",
  "description": "Performance signoff artifact for SLA compliance, load testing, and optimization",
  "type": "object",
  "required": [
    "workflow_id",
    "signoff_agent",
    "timestamp",
    "verdict",
    "sla_compliance",
    "load_test_passed",
    "performance_metrics"
  ],
  "properties": {
    "workflow_id": {
      "type": "string",
      "description": "Unique identifier for the workflow",
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "signoff_agent": {
      "type": "string",
      "description": "Agent providing the signoff",
      "enum": ["performance-engineer"]
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of signoff",
      "format": "date-time"
    },
    "verdict": {
      "type": "string",
      "description": "Final performance verdict",
      "enum": ["approved", "approved_with_conditions", "rejected"]
    },
    "sla_compliance": {
      "type": "boolean",
      "description": "Whether SLA requirements are met"
    },
    "load_test_passed": {
      "type": "boolean",
      "description": "Whether load testing passed"
    },
    "performance_metrics": {
      "type": "object",
      "description": "Performance metrics",
      "required": ["response_time", "throughput", "error_rate"],
      "properties": {
        "response_time": {
          "type": "object",
          "required": ["p50", "p95", "p99"],
          "properties": {
            "p50": {
              "type": "number",
              "description": "50th percentile response time (ms)"
            },
            "p95": {
              "type": "number",
              "description": "95th percentile response time (ms)"
            },
            "p99": {
              "type": "number",
              "description": "99th percentile response time (ms)"
            },
            "max": {
              "type": "number",
              "description": "Maximum response time (ms)"
            },
            "average": {
              "type": "number",
              "description": "Average response time (ms)"
            }
          }
        },
        "throughput": {
          "type": "object",
          "required": ["requests_per_second"],
          "properties": {
            "requests_per_second": {
              "type": "number",
              "minimum": 0
            },
            "peak_rps": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "error_rate": {
          "type": "object",
          "required": ["percentage"],
          "properties": {
            "percentage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "total_errors": {
              "type": "integer",
              "minimum": 0
            },
            "error_types": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string"
                  },
                  "count": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "resource_utilization": {
          "type": "object",
          "properties": {
            "cpu_average": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "cpu_peak": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "memory_average": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "memory_peak": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "disk_io": {
              "type": "number"
            },
            "network_io": {
              "type": "number"
            }
          }
        }
      }
    },
    "sla_targets": {
      "type": "object",
      "description": "SLA targets and compliance",
      "properties": {
        "availability": {
          "type": "object",
          "properties": {
            "target": {
              "type": "number",
              "description": "Target availability percentage"
            },
            "actual": {
              "type": "number",
              "description": "Actual availability percentage"
            },
            "compliant": {
              "type": "boolean"
            }
          }
        },
        "response_time": {
          "type": "object",
          "properties": {
            "target_p95": {
              "type": "number",
              "description": "Target P95 response time (ms)"
            },
            "actual_p95": {
              "type": "number",
              "description": "Actual P95 response time (ms)"
            },
            "compliant": {
              "type": "boolean"
            }
          }
        },
        "throughput": {
          "type": "object",
          "properties": {
            "target_rps": {
              "type": "number",
              "description": "Target requests per second"
            },
            "actual_rps": {
              "type": "number",
              "description": "Actual requests per second"
            },
            "compliant": {
              "type": "boolean"
            }
          }
        },
        "error_rate": {
          "type": "object",
          "properties": {
            "target_percentage": {
              "type": "number",
              "description": "Target error rate percentage"
            },
            "actual_percentage": {
              "type": "number",
              "description": "Actual error rate percentage"
            },
            "compliant": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "load_testing": {
      "type": "object",
      "description": "Load testing results",
      "properties": {
        "test_scenarios": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "scenario_name": {
                "type": "string"
              },
              "virtual_users": {
                "type": "integer"
              },
              "duration": {
                "type": "string"
              },
              "passed": {
                "type": "boolean"
              },
              "results": {
                "type": "object",
                "properties": {
                  "avg_response_time": {
                    "type": "number"
                  },
                  "error_rate": {
                    "type": "number"
                  },
                  "throughput": {
                    "type": "number"
                  }
                }
              }
            }
          }
        },
        "stress_testing": {
          "type": "object",
          "properties": {
            "performed": {
              "type": "boolean"
            },
            "breaking_point": {
              "type": "string",
              "description": "System breaking point (e.g., '5000 concurrent users')"
            },
            "passed": {
              "type": "boolean"
            }
          }
        },
        "spike_testing": {
          "type": "object",
          "properties": {
            "performed": {
              "type": "boolean"
            },
            "passed": {
              "type": "boolean"
            },
            "recovery_time": {
              "type": "string"
            }
          }
        },
        "endurance_testing": {
          "type": "object",
          "properties": {
            "performed": {
              "type": "boolean"
            },
            "duration": {
              "type": "string"
            },
            "passed": {
              "type": "boolean"
            },
            "memory_leaks_detected": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "database_performance": {
      "type": "object",
      "description": "Database performance assessment",
      "properties": {
        "query_performance": {
          "type": "object",
          "properties": {
            "slow_queries": {
              "type": "integer",
              "minimum": 0
            },
            "optimized": {
              "type": "boolean"
            },
            "issues": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "index_usage": {
          "type": "object",
          "properties": {
            "optimal": {
              "type": "boolean"
            },
            "missing_indexes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "connection_pooling": {
          "type": "object",
          "properties": {
            "configured": {
              "type": "boolean"
            },
            "optimal": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "frontend_performance": {
      "type": "object",
      "description": "Frontend performance assessment",
      "properties": {
        "core_web_vitals": {
          "type": "object",
          "properties": {
            "lcp": {
              "type": "number",
              "description": "Largest Contentful Paint (ms)"
            },
            "fid": {
              "type": "number",
              "description": "First Input Delay (ms)"
            },
            "cls": {
              "type": "number",
              "description": "Cumulative Layout Shift"
            },
            "fcp": {
              "type": "number",
              "description": "First Contentful Paint (ms)"
            },
            "tti": {
              "type": "number",
              "description": "Time to Interactive (ms)"
            }
          }
        },
        "bundle_size": {
          "type": "object",
          "properties": {
            "total_size": {
              "type": "number",
              "description": "Total bundle size (KB)"
            },
            "acceptable": {
              "type": "boolean"
            }
          }
        },
        "lazy_loading": {
          "type": "object",
          "properties": {
            "implemented": {
              "type": "boolean"
            },
            "effective": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "caching_assessment": {
      "type": "object",
      "description": "Caching strategy assessment",
      "properties": {
        "caching_implemented": {
          "type": "boolean"
        },
        "cache_hit_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "effective": {
          "type": "boolean"
        },
        "issues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "bottlenecks": {
      "type": "array",
      "description": "Performance bottlenecks identified",
      "items": {
        "type": "object",
        "properties": {
          "component": {
            "type": "string"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          },
          "description": {
            "type": "string"
          },
          "impact": {
            "type": "string"
          },
          "remediation": {
            "type": "string"
          }
        }
      }
    },
    "approval_conditions": {
      "type": "array",
      "description": "Conditions for approval (if verdict is approved_with_conditions)",
      "items": {
        "type": "string",
        "minLength": 10
      }
    },
    "rejection_reasons": {
      "type": "array",
      "description": "Reasons for rejection (if verdict is rejected)",
      "items": {
        "type": "string",
        "minLength": 10
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Performance recommendations",
      "items": {
        "type": "string",
        "minLength": 10
      }
    },
    "signoff_notes": {
      "type": "string",
      "description": "Additional notes from performance engineer"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "verdict": {
            "const": "approved_with_conditions"
          }
        }
      },
      "then": {
        "required": ["approval_conditions"]
      }
    },
    {
      "if": {
        "properties": {
          "verdict": {
            "const": "rejected"
          }
        }
      },
      "then": {
        "required": ["rejection_reasons"]
      }
    }
  ]
}
