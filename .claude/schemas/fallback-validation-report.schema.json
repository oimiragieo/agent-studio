{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Fallback Validation Report",
  "description": "Schema for final fallback routing test validation report",
  "required": ["report_id", "timestamp", "test_scenario", "overall_status", "test_summary"],
  "properties": {
    "report_id": {
      "type": "string",
      "description": "Unique identifier for this validation report",
      "pattern": "^fallback-validation-[a-zA-Z0-9_-]+$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when validation was completed"
    },
    "test_scenario": {
      "type": "string",
      "enum": [
        "explicit_fallback",
        "capability_matrix",
        "context_preservation",
        "fallback_chain",
        "invalid_output",
        "all"
      ],
      "description": "Test scenario that was validated"
    },
    "overall_status": {
      "type": "string",
      "enum": ["passed", "failed", "partial", "error"],
      "description": "Overall validation status"
    },
    "test_summary": {
      "type": "object",
      "required": ["total_test_cases", "passed", "failed"],
      "properties": {
        "total_test_cases": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of test cases executed"
        },
        "passed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of test cases passed"
        },
        "failed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of test cases failed"
        },
        "skipped": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of test cases skipped"
        },
        "success_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of test cases passed"
        }
      }
    },
    "test_cases": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["test_case_id", "description", "status"],
        "properties": {
          "test_case_id": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "test_type": {
            "type": "string",
            "enum": [
              "routing_accuracy",
              "context_preservation",
              "capability_verification",
              "recovery_time",
              "artifact_validation",
              "error_handling"
            ]
          },
          "status": {
            "type": "string",
            "enum": ["passed", "failed", "skipped", "error"]
          },
          "expected_result": {
            "type": "string"
          },
          "actual_result": {
            "type": "string"
          },
          "error_message": {
            "type": "string"
          },
          "execution_time_ms": {
            "type": "number",
            "minimum": 0
          }
        }
      },
      "description": "Detailed results for each test case"
    },
    "routing_accuracy": {
      "type": "object",
      "description": "Validation of fallback routing accuracy",
      "properties": {
        "correct_fallback_selections": {
          "type": "integer",
          "minimum": 0
        },
        "incorrect_fallback_selections": {
          "type": "integer",
          "minimum": 0
        },
        "accuracy_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "routing_decisions_validated": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "primary_agent": {
                "type": "string"
              },
              "expected_fallback": {
                "type": "string"
              },
              "actual_fallback": {
                "type": "string"
              },
              "correct": {
                "type": "boolean"
              },
              "routing_method": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "context_preservation": {
      "type": "object",
      "description": "Validation of context preservation during fallback",
      "properties": {
        "artifacts_preserved": {
          "type": "boolean"
        },
        "artifacts_verified": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "artifact_path": {
                "type": "string"
              },
              "preserved": {
                "type": "boolean"
              },
              "validation_status": {
                "type": "string",
                "enum": ["valid", "invalid", "missing"]
              }
            }
          }
        },
        "error_context_included": {
          "type": "boolean"
        },
        "task_requirements_clear": {
          "type": "boolean"
        },
        "context_completeness_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "capability_verification": {
      "type": "object",
      "description": "Validation that fallback agents have required capabilities",
      "properties": {
        "all_capabilities_verified": {
          "type": "boolean"
        },
        "capability_checks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "fallback_agent": {
                "type": "string"
              },
              "required_capabilities": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "available_capabilities": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "missing_capabilities": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "verified": {
                "type": "boolean"
              }
            }
          }
        }
      }
    },
    "recovery_time": {
      "type": "object",
      "description": "Measurement of recovery time for fallback routing",
      "properties": {
        "average_recovery_time_ms": {
          "type": "number",
          "minimum": 0
        },
        "min_recovery_time_ms": {
          "type": "number",
          "minimum": 0
        },
        "max_recovery_time_ms": {
          "type": "number",
          "minimum": 0
        },
        "p95_recovery_time_ms": {
          "type": "number",
          "minimum": 0
        },
        "recovery_time_target_ms": {
          "type": "number",
          "minimum": 0
        },
        "target_met": {
          "type": "boolean"
        },
        "measurements": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "test_case": {
                "type": "string"
              },
              "detection_time_ms": {
                "type": "number",
                "minimum": 0
              },
              "routing_decision_time_ms": {
                "type": "number",
                "minimum": 0
              },
              "context_packaging_time_ms": {
                "type": "number",
                "minimum": 0
              },
              "fallback_execution_time_ms": {
                "type": "number",
                "minimum": 0
              },
              "total_recovery_time_ms": {
                "type": "number",
                "minimum": 0
              }
            }
          }
        }
      }
    },
    "output_quality": {
      "type": "object",
      "description": "Validation of fallback agent output quality",
      "properties": {
        "outputs_validated": {
          "type": "integer",
          "minimum": 0
        },
        "valid_outputs": {
          "type": "integer",
          "minimum": 0
        },
        "invalid_outputs": {
          "type": "integer",
          "minimum": 0
        },
        "quality_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "quality_checks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "artifact": {
                "type": "string"
              },
              "schema_validation": {
                "type": "boolean"
              },
              "completeness": {
                "type": "boolean"
              },
              "meets_requirements": {
                "type": "boolean"
              },
              "quality_rating": {
                "type": "string",
                "enum": ["excellent", "good", "acceptable", "poor"]
              }
            }
          }
        }
      }
    },
    "fallback_chain_validation": {
      "type": "object",
      "description": "Validation for multi-level fallback chains",
      "properties": {
        "chain_tested": {
          "type": "boolean"
        },
        "chain_levels": {
          "type": "integer",
          "minimum": 0
        },
        "all_levels_executed": {
          "type": "boolean"
        },
        "chain_execution": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "level": {
                "type": "integer"
              },
              "agent": {
                "type": "string"
              },
              "status": {
                "type": "string",
                "enum": ["success", "failed", "skipped"]
              },
              "execution_time_ms": {
                "type": "number",
                "minimum": 0
              }
            }
          }
        }
      }
    },
    "issues_found": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "issue_id": {
            "type": "string"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          },
          "category": {
            "type": "string",
            "enum": ["routing", "context", "capability", "performance", "quality", "error_handling"]
          },
          "description": {
            "type": "string"
          },
          "affected_test_cases": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "recommendation": {
            "type": "string"
          }
        }
      },
      "description": "Issues discovered during validation"
    },
    "recommendations": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Recommendations for improving fallback routing"
    },
    "workflow_id": {
      "type": "string",
      "description": "Associated workflow ID"
    },
    "run_id": {
      "type": "string",
      "description": "Associated run ID"
    },
    "validator": {
      "type": "string",
      "description": "QA agent that performed validation"
    }
  }
}
