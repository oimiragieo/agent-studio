{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Simplification Report",
  "description": "Schema for code simplification reports generated by code-simplifier agent",
  "required": ["report_id", "report_date", "complexity_score", "verdict", "files_analyzed"],
  "properties": {
    "report_id": {
      "type": "string",
      "description": "Unique identifier for the simplification report"
    },
    "report_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the report was generated"
    },
    "reviewer": {
      "type": "string",
      "description": "Agent or user who performed the simplification review",
      "default": "code-simplifier"
    },
    "complexity_score": {
      "type": "number",
      "description": "Overall complexity score (1-10, lower is better). Score > 7 blocks merge.",
      "minimum": 1,
      "maximum": 10
    },
    "verdict": {
      "type": "string",
      "enum": ["APPROVE", "SIMPLIFY", "REWRITE"],
      "description": "Review verdict: APPROVE (score 1-5), SIMPLIFY (score 6-7), REWRITE (score 8-10)"
    },
    "files_analyzed": {
      "type": "array",
      "description": "List of files analyzed for simplification",
      "items": {
        "type": "object",
        "required": ["file_path", "complexity_score"],
        "properties": {
          "file_path": {
            "type": "string",
            "description": "Path to the analyzed file"
          },
          "complexity_score": {
            "type": "number",
            "description": "Complexity score for this file (1-10)",
            "minimum": 1,
            "maximum": 10
          },
          "lines_of_code": {
            "type": "integer",
            "description": "Total lines of code in file",
            "minimum": 0
          },
          "max_nesting_depth": {
            "type": "integer",
            "description": "Maximum nesting depth found in file",
            "minimum": 0
          },
          "max_function_length": {
            "type": "integer",
            "description": "Longest function in lines",
            "minimum": 0
          }
        }
      }
    },
    "issues": {
      "type": "array",
      "description": "List of complexity issues found",
      "items": {
        "type": "object",
        "required": ["type", "severity", "file", "description"],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "deep_nesting",
              "long_function",
              "long_parameter_list",
              "magic_number",
              "complex_condition",
              "nested_ternary",
              "abbreviation",
              "over_engineering",
              "premature_abstraction",
              "unclear_naming",
              "code_smell",
              "other"
            ],
            "description": "Type of complexity issue"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "blocking"],
            "description": "Severity of the issue"
          },
          "file": {
            "type": "string",
            "description": "File path where the issue was found"
          },
          "line": {
            "type": ["integer", "null"],
            "description": "Line number where the issue starts"
          },
          "line_end": {
            "type": ["integer", "null"],
            "description": "Line number where the issue ends"
          },
          "description": {
            "type": "string",
            "description": "Description of the complexity issue"
          },
          "current_value": {
            "type": "string",
            "description": "Current problematic code or value"
          },
          "suggested_fix": {
            "type": "string",
            "description": "Suggested simplification"
          }
        }
      }
    },
    "transformations": {
      "type": "array",
      "description": "Detailed before/after code transformation examples",
      "items": {
        "type": "object",
        "required": ["file", "issue_type", "before", "after", "explanation"],
        "properties": {
          "file": {
            "type": "string",
            "description": "File path for the transformation"
          },
          "line_start": {
            "type": "integer",
            "description": "Starting line of the transformation"
          },
          "line_end": {
            "type": "integer",
            "description": "Ending line of the transformation"
          },
          "issue_type": {
            "type": "string",
            "description": "Type of issue being addressed"
          },
          "before": {
            "type": "string",
            "description": "Original complex code"
          },
          "after": {
            "type": "string",
            "description": "Simplified code"
          },
          "explanation": {
            "type": "string",
            "description": "Why this transformation improves the code"
          }
        }
      }
    },
    "metrics": {
      "type": "object",
      "description": "Aggregate complexity metrics",
      "properties": {
        "total_files": {
          "type": "integer",
          "minimum": 0
        },
        "total_issues": {
          "type": "integer",
          "minimum": 0
        },
        "blocking_issues": {
          "type": "integer",
          "description": "Number of issues that must be fixed before merge",
          "minimum": 0
        },
        "average_nesting_depth": {
          "type": "number",
          "minimum": 0
        },
        "average_function_length": {
          "type": "number",
          "minimum": 0
        },
        "average_cyclomatic_complexity": {
          "type": "number",
          "minimum": 0
        },
        "files_exceeding_threshold": {
          "type": "integer",
          "description": "Number of files with complexity score > 7",
          "minimum": 0
        }
      }
    },
    "blocking_issues": {
      "type": "array",
      "description": "Issues that must be fixed before merge can proceed",
      "items": {
        "type": "string"
      }
    },
    "recommended_improvements": {
      "type": "array",
      "description": "Non-blocking improvements that would enhance readability",
      "items": {
        "type": "string"
      }
    },
    "simplicity_tests": {
      "type": "object",
      "description": "Results of the simplicity test criteria",
      "properties": {
        "junior_developer_test": {
          "type": "boolean",
          "description": "Can a developer with 6 months experience understand this?"
        },
        "three_am_test": {
          "type": "boolean",
          "description": "Could you debug this at 3 AM after being woken up?"
        },
        "six_month_test": {
          "type": "boolean",
          "description": "Will this make sense when revisited in 6 months?"
        },
        "one_sentence_test": {
          "type": "boolean",
          "description": "Can you explain what each function does in one sentence?"
        }
      }
    }
  }
}
