{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Performance Metrics",
  "description": "Schema for browser performance metrics including Core Web Vitals and response times",
  "required": ["metrics_id", "metrics_date", "measurer_agent", "target_url", "core_web_vitals"],
  "properties": {
    "metrics_id": {
      "type": "string",
      "description": "Unique identifier for the performance metrics"
    },
    "metrics_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when metrics were measured"
    },
    "measurer_agent": {
      "type": "string",
      "description": "Agent that measured the metrics (e.g., performance-engineer)"
    },
    "target_url": {
      "type": "string",
      "format": "uri",
      "description": "URL of the application measured"
    },
    "core_web_vitals": {
      "type": "object",
      "required": ["lcp", "fid", "cls"],
      "properties": {
        "lcp": {
          "type": "object",
          "required": ["value_ms", "score"],
          "properties": {
            "value_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Largest Contentful Paint value in milliseconds"
            },
            "score": {
              "type": "string",
              "enum": ["good", "needs_improvement", "poor"],
              "description": "LCP score (good: <2.5s, needs improvement: 2.5-4s, poor: >4s)"
            },
            "element": {
              "type": "string",
              "description": "Element that was the LCP"
            }
          }
        },
        "fid": {
          "type": "object",
          "required": ["value_ms", "score"],
          "properties": {
            "value_ms": {
              "type": "number",
              "minimum": 0,
              "description": "First Input Delay value in milliseconds"
            },
            "score": {
              "type": "string",
              "enum": ["good", "needs_improvement", "poor"],
              "description": "FID score (good: <100ms, needs improvement: 100-300ms, poor: >300ms)"
            },
            "event_type": {
              "type": "string",
              "description": "Type of first input (click, keydown, etc.)"
            }
          }
        },
        "cls": {
          "type": "object",
          "required": ["value", "score"],
          "properties": {
            "value": {
              "type": "number",
              "minimum": 0,
              "description": "Cumulative Layout Shift value"
            },
            "score": {
              "type": "string",
              "enum": ["good", "needs_improvement", "poor"],
              "description": "CLS score (good: <0.1, needs improvement: 0.1-0.25, poor: >0.25)"
            }
          }
        },
        "fcp": {
          "type": "object",
          "properties": {
            "value_ms": {
              "type": "number",
              "minimum": 0,
              "description": "First Contentful Paint value in milliseconds"
            },
            "score": {
              "type": "string",
              "enum": ["good", "needs_improvement", "poor"],
              "description": "FCP score (good: <1.8s, needs improvement: 1.8-3s, poor: >3s)"
            }
          }
        },
        "tti": {
          "type": "object",
          "properties": {
            "value_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Time to Interactive value in milliseconds"
            },
            "score": {
              "type": "string",
              "enum": ["good", "needs_improvement", "poor"],
              "description": "TTI score (good: <3.8s, needs improvement: 3.8-7.3s, poor: >7.3s)"
            }
          }
        }
      }
    },
    "response_times": {
      "type": "object",
      "description": "Response time metrics",
      "properties": {
        "page_load": {
          "type": "object",
          "properties": {
            "total_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Total page load time in milliseconds"
            },
            "dom_content_loaded_ms": {
              "type": "number",
              "minimum": 0,
              "description": "DOM content loaded time"
            },
            "window_load_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Window load event time"
            }
          }
        },
        "ttfb": {
          "type": "number",
          "minimum": 0,
          "description": "Time to First Byte in milliseconds"
        },
        "api_average": {
          "type": "number",
          "minimum": 0,
          "description": "Average API response time in milliseconds"
        },
        "api_slowest": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "format": "uri",
              "description": "URL of the slowest API endpoint"
            },
            "duration_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Response time in milliseconds"
            },
            "method": {
              "type": "string",
              "enum": ["GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS"]
            }
          }
        },
        "component_render": {
          "type": "object",
          "properties": {
            "average_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Average component render time in milliseconds"
            },
            "slowest_component": {
              "type": "string",
              "description": "Name of the slowest rendering component"
            },
            "slowest_render_time_ms": {
              "type": "number",
              "minimum": 0,
              "description": "Render time of slowest component"
            }
          }
        },
        "p50_response_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "50th percentile response time"
        },
        "p95_response_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "95th percentile response time"
        },
        "p99_response_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "99th percentile response time"
        }
      }
    },
    "resource_analysis": {
      "type": "object",
      "description": "Resource size and optimization analysis",
      "properties": {
        "bundle_sizes": {
          "type": "object",
          "properties": {
            "total_js_kb": {
              "type": "number",
              "minimum": 0,
              "description": "Total JavaScript bundle size in KB"
            },
            "total_css_kb": {
              "type": "number",
              "minimum": 0,
              "description": "Total CSS bundle size in KB"
            },
            "largest_js_bundle": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Name of the largest JS bundle"
                },
                "size_kb": {
                  "type": "number",
                  "minimum": 0
                }
              }
            },
            "code_splitting_opportunities": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Identified code splitting opportunities"
            }
          }
        },
        "image_sizes": {
          "type": "object",
          "properties": {
            "total_size_mb": {
              "type": "number",
              "minimum": 0,
              "description": "Total image size in MB"
            },
            "image_count": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of images"
            },
            "unoptimized_images": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "format": "uri"
                  },
                  "size_kb": {
                    "type": "number",
                    "minimum": 0
                  },
                  "optimization_potential": {
                    "type": "string",
                    "description": "Potential optimization (e.g., 'Convert to WebP', 'Compress 60%')"
                  }
                }
              }
            },
            "optimization_opportunities": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Image optimization recommendations"
            }
          }
        },
        "unused_css_js": {
          "type": "object",
          "properties": {
            "unused_css_kb": {
              "type": "number",
              "minimum": 0,
              "description": "Unused CSS in KB"
            },
            "unused_js_kb": {
              "type": "number",
              "minimum": 0,
              "description": "Unused JavaScript in KB"
            },
            "removal_potential": {
              "type": "string",
              "description": "Potential size reduction if unused code removed"
            }
          }
        },
        "cache_efficiency": {
          "type": "object",
          "properties": {
            "cache_hit_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Cache hit rate percentage"
            },
            "cacheable_resources": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of cacheable resources"
            },
            "non_cacheable_resources": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of non-cacheable resources"
            },
            "cache_optimization_opportunities": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Cache optimization recommendations"
            }
          }
        }
      }
    },
    "performance_profile": {
      "type": "object",
      "description": "Reference to detailed performance profile data",
      "properties": {
        "profile_id": {
          "type": "string",
          "description": "Identifier for the performance profile"
        },
        "profile_path": {
          "type": "string",
          "description": "Path to performance profile file"
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Duration of profiling in seconds"
        }
      }
    },
    "bottlenecks": {
      "type": "array",
      "description": "Array of identified performance bottlenecks",
      "items": {
        "type": "object",
        "required": ["bottleneck_type", "description", "impact"],
        "properties": {
          "bottleneck_type": {
            "type": "string",
            "enum": ["javascript", "rendering", "network", "memory", "cpu", "other"],
            "description": "Type of bottleneck"
          },
          "description": {
            "type": "string",
            "description": "Description of the bottleneck"
          },
          "impact": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"],
            "description": "Impact of the bottleneck"
          },
          "location": {
            "type": "string",
            "description": "Where the bottleneck occurs (file, component, API endpoint)"
          },
          "optimization_recommendation": {
            "type": "string",
            "description": "Recommended optimization"
          },
          "estimated_improvement": {
            "type": "string",
            "description": "Estimated performance improvement"
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "measurement_tool": {
          "type": "string",
          "description": "Tool used for measurement (e.g., Chrome DevTools MCP, Lighthouse)"
        },
        "measurement_duration_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Duration of measurement in seconds"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about the metrics"
        }
      }
    }
  }
}

