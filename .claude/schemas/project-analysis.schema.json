{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.com/schemas/project-analysis.schema.json",
  "title": "Project Analysis",
  "version": "1.0.0",
  "description": "Schema for brownfield project analysis output generated by project-analyzer skill",
  "type": "object",
  "required": ["analysis_id", "project_type", "analyzed_at", "stats", "frameworks", "structure"],
  "properties": {
    "analysis_id": {
      "type": "string",
      "pattern": "^analysis-[a-z0-9-]+$",
      "description": "Unique identifier for this analysis run"
    },
    "project_type": {
      "type": "string",
      "enum": [
        "frontend",
        "backend",
        "fullstack",
        "library",
        "cli",
        "mobile",
        "monorepo",
        "microservices",
        "serverless",
        "unknown"
      ],
      "description": "Primary project classification"
    },
    "analyzed_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when analysis was performed"
    },
    "project_root": {
      "type": "string",
      "description": "Absolute path to project root directory"
    },
    "stats": {
      "type": "object",
      "required": ["total_files", "total_lines", "languages"],
      "description": "Quantitative project statistics",
      "properties": {
        "total_files": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of source files"
        },
        "total_lines": {
          "type": "integer",
          "minimum": 0,
          "description": "Total lines of code across all files"
        },
        "languages": {
          "type": "object",
          "description": "Lines of code per language",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "file_types": {
          "type": "object",
          "description": "Count of files by extension",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "directories": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of directories"
        },
        "avg_file_size_lines": {
          "type": "number",
          "minimum": 0,
          "description": "Average lines per file"
        },
        "largest_files": {
          "type": "array",
          "maxItems": 10,
          "description": "Top 10 largest files by line count",
          "items": {
            "type": "object",
            "required": ["path", "lines"],
            "properties": {
              "path": {
                "type": "string",
                "description": "Relative file path"
              },
              "lines": {
                "type": "integer",
                "minimum": 0
              }
            }
          }
        }
      }
    },
    "frameworks": {
      "type": "array",
      "description": "Detected frameworks and libraries",
      "items": {
        "type": "object",
        "required": ["name", "category", "confidence"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Framework or library name"
          },
          "version": {
            "type": "string",
            "description": "Detected version (if available)"
          },
          "category": {
            "type": "string",
            "enum": [
              "framework",
              "ui-library",
              "state-management",
              "testing",
              "build-tool",
              "database",
              "orm",
              "api",
              "auth",
              "logging",
              "monitoring",
              "utility",
              "other"
            ],
            "description": "Category of the dependency"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Detection confidence (0-1)"
          },
          "source": {
            "type": "string",
            "enum": [
              "package.json",
              "requirements.txt",
              "go.mod",
              "Cargo.toml",
              "pom.xml",
              "build.gradle",
              "imports",
              "config"
            ],
            "description": "How the framework was detected"
          }
        }
      }
    },
    "structure": {
      "type": "object",
      "required": ["root_directories", "entry_points"],
      "description": "Project structure analysis",
      "properties": {
        "root_directories": {
          "type": "array",
          "description": "Top-level directories",
          "items": {
            "type": "object",
            "required": ["name", "purpose"],
            "properties": {
              "name": {
                "type": "string"
              },
              "purpose": {
                "type": "string",
                "enum": [
                  "source",
                  "tests",
                  "config",
                  "docs",
                  "build",
                  "scripts",
                  "assets",
                  "public",
                  "vendor",
                  "unknown"
                ]
              },
              "file_count": {
                "type": "integer",
                "minimum": 0
              }
            }
          }
        },
        "entry_points": {
          "type": "array",
          "description": "Application entry points",
          "items": {
            "type": "object",
            "required": ["path", "type"],
            "properties": {
              "path": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["main", "index", "app", "server", "handler", "cli", "test", "config"]
              }
            }
          }
        },
        "architecture_pattern": {
          "type": "string",
          "enum": [
            "mvc",
            "mvvm",
            "layered",
            "hexagonal",
            "clean-architecture",
            "microservices",
            "serverless",
            "monolith",
            "modular",
            "flat",
            "unknown"
          ],
          "description": "Detected architectural pattern"
        },
        "module_system": {
          "type": "string",
          "enum": ["esm", "commonjs", "umd", "amd", "mixed", "none"],
          "description": "JavaScript/TypeScript module system"
        }
      }
    },
    "dependencies": {
      "type": "object",
      "description": "Dependency analysis",
      "properties": {
        "production": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of production dependencies"
        },
        "development": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of development dependencies"
        },
        "outdated": {
          "type": "array",
          "description": "Outdated dependencies",
          "items": {
            "type": "object",
            "required": ["name", "current", "latest"],
            "properties": {
              "name": { "type": "string" },
              "current": { "type": "string" },
              "latest": { "type": "string" },
              "breaking": { "type": "boolean" }
            }
          }
        },
        "vulnerabilities": {
          "type": "array",
          "description": "Known security vulnerabilities",
          "items": {
            "type": "object",
            "required": ["package", "severity"],
            "properties": {
              "package": { "type": "string" },
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              },
              "advisory": { "type": "string" }
            }
          }
        }
      }
    },
    "code_quality": {
      "type": "object",
      "description": "Code quality indicators",
      "properties": {
        "linting": {
          "type": "object",
          "properties": {
            "configured": { "type": "boolean" },
            "tool": { "type": "string" },
            "issues_count": { "type": "integer", "minimum": 0 }
          }
        },
        "formatting": {
          "type": "object",
          "properties": {
            "configured": { "type": "boolean" },
            "tool": { "type": "string" }
          }
        },
        "testing": {
          "type": "object",
          "properties": {
            "framework": { "type": "string" },
            "test_files": { "type": "integer", "minimum": 0 },
            "coverage_configured": { "type": "boolean" },
            "coverage_percent": { "type": "number", "minimum": 0, "maximum": 100 }
          }
        },
        "type_safety": {
          "type": "object",
          "properties": {
            "typescript": { "type": "boolean" },
            "strict_mode": { "type": "boolean" },
            "type_coverage": { "type": "number", "minimum": 0, "maximum": 100 }
          }
        }
      }
    },
    "patterns_detected": {
      "type": "array",
      "description": "Common patterns and anti-patterns detected",
      "items": {
        "type": "object",
        "required": ["pattern", "type", "locations"],
        "properties": {
          "pattern": {
            "type": "string",
            "description": "Name of the pattern"
          },
          "type": {
            "type": "string",
            "enum": ["good-practice", "anti-pattern", "neutral"]
          },
          "description": {
            "type": "string"
          },
          "locations": {
            "type": "array",
            "items": { "type": "string" }
          },
          "recommendation": {
            "type": "string"
          }
        }
      }
    },
    "tech_debt": {
      "type": "object",
      "description": "Technical debt indicators",
      "properties": {
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Overall tech debt score (0=no debt, 100=severe)"
        },
        "indicators": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["category", "severity", "description"],
            "properties": {
              "category": {
                "type": "string",
                "enum": [
                  "outdated-deps",
                  "missing-tests",
                  "dead-code",
                  "complexity",
                  "documentation",
                  "security",
                  "performance",
                  "accessibility"
                ]
              },
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              },
              "description": { "type": "string" },
              "remediation_effort": {
                "type": "string",
                "enum": ["trivial", "minor", "moderate", "major", "massive"]
              }
            }
          }
        }
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Prioritized improvement recommendations",
      "items": {
        "type": "object",
        "required": ["priority", "category", "title", "description"],
        "properties": {
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"]
          },
          "category": {
            "type": "string",
            "enum": [
              "security",
              "performance",
              "maintainability",
              "testing",
              "documentation",
              "architecture",
              "dependencies"
            ]
          },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "effort": {
            "type": "string",
            "enum": ["trivial", "minor", "moderate", "major", "massive"]
          },
          "impact": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"]
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Analysis metadata",
      "properties": {
        "analyzer_version": { "type": "string" },
        "analysis_duration_ms": { "type": "integer", "minimum": 0 },
        "files_analyzed": { "type": "integer", "minimum": 0 },
        "files_skipped": { "type": "integer", "minimum": 0 },
        "errors": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
