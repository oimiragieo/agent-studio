{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://claude-code.anthropic.com/schemas/skill-repo-rag-output.schema.json",
  "title": "Repo RAG Skill Output Verification",
  "description": "Verifiable output from the repo-rag skill that proves codebase search and semantic retrieval occurred",
  "type": "object",
  "required": [
    "skill_name",
    "query",
    "results_count",
    "files_searched",
    "semantic_matches",
    "timestamp"
  ],
  "properties": {
    "skill_name": {
      "type": "string",
      "const": "repo-rag",
      "description": "Must be 'repo-rag' to verify correct skill was used"
    },
    "query": {
      "type": "string",
      "minLength": 3,
      "description": "Search query executed (proof of search)"
    },
    "query_type": {
      "type": "string",
      "enum": ["semantic", "keyword", "pattern", "hybrid"],
      "description": "Type of search performed"
    },
    "results_count": {
      "type": "number",
      "minimum": 0,
      "description": "Total number of results returned"
    },
    "files_searched": {
      "type": "array",
      "description": "Files included in search scope (proves actual search)",
      "minItems": 1,
      "items": {
        "type": "string"
      }
    },
    "patterns_found": {
      "type": "array",
      "description": "Code patterns discovered matching query",
      "items": {
        "type": "object",
        "required": ["pattern", "occurrences"],
        "properties": {
          "pattern": {
            "type": "string",
            "description": "Pattern identifier or description"
          },
          "occurrences": {
            "type": "number",
            "minimum": 1,
            "description": "Number of times pattern found"
          },
          "files": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Files containing this pattern"
          }
        },
        "additionalProperties": false
      }
    },
    "semantic_matches": {
      "type": "array",
      "description": "Semantically relevant matches with relevance scores",
      "items": {
        "type": "object",
        "required": ["file", "relevance_score", "snippet"],
        "properties": {
          "file": {
            "type": "string",
            "description": "File path of match"
          },
          "line_start": {
            "type": "number",
            "minimum": 1,
            "description": "Starting line number of match"
          },
          "line_end": {
            "type": "number",
            "minimum": 1,
            "description": "Ending line number of match"
          },
          "relevance_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Relevance score (0-1)"
          },
          "snippet": {
            "type": "string",
            "minLength": 10,
            "description": "Code snippet showing match context"
          },
          "match_type": {
            "type": "string",
            "enum": ["exact", "semantic", "fuzzy", "pattern"],
            "description": "Type of match"
          },
          "context": {
            "type": "string",
            "description": "Surrounding context for match"
          }
        },
        "additionalProperties": false
      }
    },
    "search_metadata": {
      "type": "object",
      "description": "Search execution metadata",
      "properties": {
        "total_files_scanned": {
          "type": "number",
          "minimum": 0,
          "description": "Total files scanned during search"
        },
        "total_lines_analyzed": {
          "type": "number",
          "minimum": 0,
          "description": "Total lines of code analyzed"
        },
        "search_duration_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Search execution time in milliseconds"
        },
        "index_used": {
          "type": "boolean",
          "description": "Whether vector index was used for semantic search"
        },
        "embedding_model": {
          "type": "string",
          "description": "Embedding model used for semantic search"
        }
      },
      "additionalProperties": false
    },
    "filters_applied": {
      "type": "object",
      "description": "Search filters applied",
      "properties": {
        "file_extensions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "File extensions included in search"
        },
        "directories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Directories included in search"
        },
        "exclude_patterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Patterns excluded from search"
        }
      },
      "additionalProperties": false
    },
    "aggregated_insights": {
      "type": "object",
      "description": "High-level insights from search results",
      "properties": {
        "technologies_detected": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Technologies found in results"
        },
        "common_patterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Common code patterns across results"
        },
        "similar_implementations": {
          "type": "number",
          "minimum": 0,
          "description": "Number of similar implementations found"
        }
      },
      "additionalProperties": false
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of search execution"
    }
  },
  "additionalProperties": false
}
