{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://llmrules.com/schemas/plan-rubric.schema.json",
  "title": "Plan Rating Rubric Schema",
  "description": "Schema for defining plan rating rubrics used by response-rater skill to evaluate plan quality",
  "type": "object",
  "required": [
    "version",
    "name",
    "description",
    "minimum_score",
    "dimensions",
    "thresholds",
    "scoring_rules"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the rubric (e.g., '1.0.0')"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable name of the rubric"
    },
    "description": {
      "type": "string",
      "minLength": 1,
      "description": "Purpose and usage of this rubric"
    },
    "minimum_score": {
      "type": "number",
      "minimum": 0,
      "maximum": 10,
      "description": "Default minimum passing score for this rubric"
    },
    "dimensions": {
      "type": "array",
      "minItems": 1,
      "description": "Evaluation dimensions with weights and scoring guides",
      "items": {
        "type": "object",
        "required": ["name", "weight", "description", "scoring"],
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[a-z_]+$",
            "description": "Dimension identifier (lowercase with underscores)"
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Weight of this dimension (must sum to 1.0 across all dimensions)"
          },
          "description": {
            "type": "string",
            "minLength": 1,
            "description": "What this dimension evaluates"
          },
          "scoring": {
            "type": "object",
            "description": "Scoring guide for different score ranges",
            "patternProperties": {
              "^\\d+-\\d+$": {
                "type": "string",
                "description": "Description of what score range means"
              }
            },
            "additionalProperties": false
          }
        },
        "additionalProperties": false
      }
    },
    "thresholds": {
      "type": "object",
      "description": "Minimum score thresholds for different task types",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "object",
          "required": ["minimum_score", "description", "rationale"],
          "properties": {
            "minimum_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "Minimum passing score for this threshold"
            },
            "description": {
              "type": "string",
              "minLength": 1,
              "description": "When to use this threshold"
            },
            "rationale": {
              "type": "string",
              "minLength": 1,
              "description": "Why this threshold is appropriate"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "scoring_rules": {
      "type": "object",
      "required": ["score_range", "aggregation_method"],
      "properties": {
        "score_range": {
          "type": "array",
          "minItems": 2,
          "maxItems": 2,
          "items": {
            "type": "number"
          },
          "description": "Valid score range [min, max]"
        },
        "aggregation_method": {
          "type": "string",
          "enum": ["weighted_average", "minimum", "maximum", "median"],
          "description": "How to aggregate dimension scores into overall score"
        },
        "dimension_weights_must_sum_to": {
          "type": "number",
          "description": "Required sum of all dimension weights"
        },
        "rounding": {
          "type": "string",
          "enum": ["none", "one_decimal_place", "integer"],
          "description": "How to round final scores"
        }
      },
      "additionalProperties": false
    },
    "usage": {
      "type": "object",
      "description": "How to use this rubric",
      "properties": {
        "primary_tool": {
          "type": "string",
          "description": "Tool that uses this rubric"
        },
        "invocation": {
          "type": "string",
          "description": "Command to invoke the tool"
        },
        "providers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "AI providers used for rating"
        },
        "timeout_per_provider_ms": {
          "type": "number",
          "description": "Timeout in milliseconds per provider"
        }
      },
      "additionalProperties": false
    },
    "customization": {
      "type": "object",
      "description": "Customization options for this rubric",
      "properties": {
        "allow_custom_rubrics": {
          "type": "boolean",
          "description": "Whether custom rubrics can override this one"
        },
        "custom_rubric_location": {
          "type": "string",
          "description": "Directory for custom rubric files"
        },
        "override_parameter": {
          "type": "string",
          "description": "Parameter name to specify custom rubric"
        },
        "example": {
          "type": "string",
          "description": "Example command with custom rubric"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about this rubric",
      "properties": {
        "created": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Creation date (YYYY-MM-DD)"
        },
        "author": {
          "type": "string",
          "description": "Author or organization"
        },
        "schema": {
          "type": "string",
          "description": "Path to JSON schema for validation"
        },
        "documentation": {
          "type": "string",
          "description": "Path to documentation file"
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
