{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Spawn Parameters Schema",
  "description": "JSON Schema for validating agent spawn parameters including execution limits for Task() invocations",
  "type": "object",
  "properties": {
    "subagent_type": {
      "type": "string",
      "description": "Type of agent to spawn (e.g., 'developer', 'planner', 'general-purpose')",
      "examples": [
        "developer",
        "planner",
        "qa",
        "architect",
        "security-architect",
        "general-purpose"
      ]
    },
    "model": {
      "type": "string",
      "enum": ["haiku", "sonnet", "opus"],
      "description": "LLM model to use for this agent. haiku=fast/cheap, sonnet=balanced, opus=powerful/expensive"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of what this agent is doing (e.g., 'Developer implementing authentication')",
      "minLength": 10,
      "maxLength": 200
    },
    "allowed_tools": {
      "type": "array",
      "description": "List of tools this agent can use",
      "items": {
        "type": "string"
      },
      "examples": [
        ["Read", "Write", "Edit", "Bash", "TaskUpdate", "TaskList", "Skill"]
      ]
    },
    "prompt": {
      "type": "string",
      "description": "Complete agent instructions including task context, identity, and workflow",
      "minLength": 100
    },
    "run_in_background": {
      "type": "boolean",
      "description": "Whether to run this agent in background (non-blocking)",
      "default": false
    },
    "execution_limits": {
      "type": "object",
      "description": "Execution limits to prevent runaway agents and control costs",
      "properties": {
        "max_turns": {
          "type": "integer",
          "description": "Maximum number of tool call iterations before agent stops (equivalent to crewAI's max_iter). Prevents infinite loops.",
          "minimum": 1,
          "maximum": 100,
          "default": 25,
          "examples": [10, 25, 50]
        },
        "max_duration_ms": {
          "type": "integer",
          "description": "Maximum execution time in milliseconds before agent is terminated (equivalent to crewAI's max_execution_time). Prevents hung agents.",
          "minimum": 1000,
          "maximum": 3600000,
          "default": 600000,
          "examples": [60000, 300000, 600000]
        },
        "max_cost_usd": {
          "type": "number",
          "description": "Maximum cost in USD before agent stops making LLM calls. Prevents runaway costs.",
          "minimum": 0.01,
          "maximum": 100.0,
          "default": 1.0,
          "examples": [0.1, 1.0, 5.0]
        },
        "timeout_action": {
          "type": "string",
          "enum": ["terminate", "pause", "warn"],
          "description": "Action to take when execution limit is reached. terminate=stop immediately, pause=wait for resume, warn=log warning but continue",
          "default": "terminate"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["subagent_type", "prompt"],
  "additionalProperties": true,
  "examples": [
    {
      "subagent_type": "developer",
      "model": "sonnet",
      "description": "Developer implementing Task #51 execution limits",
      "allowed_tools": ["Read", "Write", "Edit", "Bash", "TaskUpdate", "TaskList", "Skill"],
      "execution_limits": {
        "max_turns": 25,
        "max_duration_ms": 600000,
        "max_cost_usd": 1.0,
        "timeout_action": "terminate"
      },
      "prompt": "You are DEVELOPER. Your Task ID: #51..."
    },
    {
      "subagent_type": "planner",
      "model": "opus",
      "description": "Planner designing authentication feature",
      "allowed_tools": ["Read", "Write", "TaskCreate", "TaskUpdate", "Skill"],
      "execution_limits": {
        "max_turns": 15,
        "max_duration_ms": 300000,
        "max_cost_usd": 2.0,
        "timeout_action": "warn"
      },
      "prompt": "You are PLANNER. Design authentication feature..."
    },
    {
      "subagent_type": "qa",
      "model": "haiku",
      "description": "QA running test suite",
      "allowed_tools": ["Read", "Bash", "TaskUpdate"],
      "execution_limits": {
        "max_turns": 10,
        "max_duration_ms": 120000,
        "max_cost_usd": 0.5,
        "timeout_action": "terminate"
      },
      "prompt": "You are QA. Run full test suite..."
    }
  ]
}
