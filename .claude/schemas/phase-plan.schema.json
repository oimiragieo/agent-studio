{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "properties": {
        "phaseId": {"type": "string"},
        "phaseName": {"type": "string"},
        "masterPlanId": {"type": "string"},
        "createdAt": {"type": "string", "format": "date-time"},
        "lastUpdated": {"type": "string", "format": "date-time"}
      },
      "required": ["phaseId", "phaseName", "masterPlanId"]
    },
    "tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "taskId": {"type": "string"},
          "description": {"type": "string"},
          "priority": {"enum": ["P0", "P1", "P2", "P3"]},
          "category": {"type": "string"},
          "status": {"enum": ["pending", "in_progress", "completed", "failed", "blocked"]},
          "assignedAgent": {
            "enum": [
              "planner",
              "orchestrator",
              "analyst",
              "pm",
              "architect",
              "llm-architect",
              "database-architect",
              "api-designer",
              "developer",
              "mobile-developer",
              "qa",
              "code-reviewer",
              "security-architect",
              "compliance-auditor",
              "performance-engineer",
              "ux-expert",
              "accessibility-expert",
              "devops",
              "incident-responder",
              "refactoring-specialist",
              "legacy-modernizer",
              "technical-writer",
              "model-orchestrator",
              "gcp-cloud-agent",
              "ai-council"
            ]
          },
          "files": {"type": "array", "items": {"type": "string"}},
          "lineNumbers": {"type": "array", "items": {"type": "number"}},
          "dependencies": {"type": "array", "items": {"type": "string"}},
          "testRequirements": {
            "type": "object",
            "properties": {
              "testPattern": {"type": "string"},
              "testCommand": {"type": "string"},
              "expectedResults": {"type": "string"}
            }
          },
          "startedAt": {"type": "string", "format": "date-time"},
          "completedAt": {"type": "string", "format": "date-time"},
          "result": {"type": "object"},
          "artifacts": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "path": {"type": "string"},
                "description": {"type": "string"},
                "type": {"enum": ["file", "directory", "test_result", "log", "documentation"]}
              },
              "required": ["path", "description"]
            }
          }
        },
        "required": ["taskId", "description", "priority", "status", "assignedAgent"]
      }
    },
    "agentAssignments": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": {"type": "string"}
      }
    },
    "testResults": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "taskId": {"type": "string"},
          "testCommand": {"type": "string"},
          "result": {"enum": ["pass", "fail", "pending"]},
          "details": {"type": "object"},
          "timestamp": {"type": "string", "format": "date-time"}
        }
      }
    },
    "statusTracking": {
      "type": "object",
      "properties": {
        "overallStatus": {"enum": ["planning", "in_progress", "completed", "failed", "paused"]},
        "completedTasks": {"type": "number"},
        "inProgressTasks": {"type": "number"},
        "pendingTasks": {"type": "number"},
        "failedTasks": {"type": "number"},
        "lastTaskCompleted": {"type": "string"},
        "nextTask": {"type": "string"}
      }
    },
    "recoveryMetadata": {
      "type": "object",
      "properties": {
        "canResume": {"type": "boolean"},
        "resumePoint": {"type": "string"},
        "contextSummary": {"type": "string"},
        "completedWork": {"type": "string"},
        "pendingWork": {"type": "string"},
        "scratchpad": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "taskId": {"type": "string"},
              "attempts": {"type": "number"},
              "failureReason": {"type": "string"},
              "timestamp": {"type": "string", "format": "date-time"},
              "avoidApproach": {"type": "string"}
            }
          },
          "description": "Records of failed approaches to avoid retrying"
        }
      }
    },
    "councilDecisions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "decisionId": {"type": "string"},
          "issue": {"type": "string"},
          "participants": {"type": "array", "items": {"type": "string"}},
          "consensus": {"type": "string"},
          "recommendation": {"type": "string"},
          "arguments": {"type": "array"},
          "timestamp": {"type": "string", "format": "date-time"}
        }
      }
    }
  },
  "required": ["metadata", "tasks", "statusTracking"]
}
