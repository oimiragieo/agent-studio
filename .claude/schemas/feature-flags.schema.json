{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.dev/schemas/feature-flags.schema.json",
  "title": "Feature Flags Configuration Schema",
  "description": "Schema for feature flags configuration used in A2A protocol integration",
  "type": "object",
  "required": ["version", "last_updated", "flags"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Configuration version (semantic versioning)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "last_updated": {
      "type": "string",
      "description": "Timestamp of last configuration update (ISO 8601)",
      "format": "date-time",
      "examples": ["2025-01-13T00:00:00Z"]
    },
    "flags": {
      "type": "object",
      "description": "Feature flag definitions",
      "additionalProperties": {
        "$ref": "#/definitions/flag"
      }
    },
    "environment_defaults": {
      "type": "object",
      "description": "Default settings per environment",
      "additionalProperties": {
        "$ref": "#/definitions/environment_config"
      }
    },
    "audit": {
      "type": "object",
      "description": "Audit logging configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether audit logging is enabled"
        },
        "log_path": {
          "type": "string",
          "description": "Path to audit log file"
        },
        "retention_days": {
          "type": "integer",
          "description": "Number of days to retain audit logs",
          "minimum": 1
        },
        "include_metadata": {
          "type": "boolean",
          "description": "Whether to include metadata in audit logs"
        }
      }
    },
    "validation_rules": {
      "type": "object",
      "description": "Validation rules for flag operations",
      "properties": {
        "dependency_check": {
          "type": "boolean",
          "description": "Whether to enforce dependency validation"
        },
        "environment_validation": {
          "type": "boolean",
          "description": "Whether to validate environment configurations"
        },
        "rollout_order_enforcement": {
          "type": "boolean",
          "description": "Whether to enforce rollout order constraints"
        },
        "risk_level_gates": {
          "type": "object",
          "description": "Required approvers by risk level",
          "properties": {
            "high": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Approvers required for high-risk flags"
            },
            "medium": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Approvers required for medium-risk flags"
            },
            "low": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Approvers required for low-risk flags"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "flag": {
      "type": "object",
      "description": "Individual feature flag configuration",
      "required": ["enabled", "description", "phase", "rollout_order", "dependencies"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Global enabled state (default for all environments)"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the feature",
          "minLength": 10
        },
        "phase": {
          "type": "string",
          "description": "Rollout phase",
          "enum": ["POC", "Memory", "Lifecycle", "External"]
        },
        "rollout_order": {
          "type": "integer",
          "description": "Order in which flags should be rolled out",
          "minimum": 1
        },
        "dependencies": {
          "type": "array",
          "description": "List of flags that must be enabled before this flag",
          "items": {
            "type": "string"
          }
        },
        "environments": {
          "type": "object",
          "description": "Environment-specific overrides",
          "properties": {
            "dev": {
              "type": "boolean",
              "description": "Enabled state in development environment"
            },
            "staging": {
              "type": "boolean",
              "description": "Enabled state in staging environment"
            },
            "prod": {
              "type": "boolean",
              "description": "Enabled state in production environment"
            }
          }
        },
        "metadata": {
          "type": "object",
          "description": "Additional metadata about the flag",
          "properties": {
            "owner": {
              "type": "string",
              "description": "Agent or team responsible for this flag"
            },
            "risk_level": {
              "type": "string",
              "description": "Risk level associated with enabling this flag",
              "enum": ["low", "medium", "high"]
            },
            "added_date": {
              "type": "string",
              "description": "Date when flag was added (YYYY-MM-DD)",
              "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
            },
            "documentation": {
              "type": "string",
              "description": "Path or URL to documentation for this flag"
            }
          }
        }
      }
    },
    "environment_config": {
      "type": "object",
      "description": "Environment-specific configuration",
      "properties": {
        "description": {
          "type": "string",
          "description": "Human-readable description of the environment"
        },
        "safe_rollback": {
          "type": "boolean",
          "description": "Whether rollback is safe in this environment"
        },
        "auto_enable_dependencies": {
          "type": "boolean",
          "description": "Whether to automatically enable dependencies"
        },
        "require_approval": {
          "type": "boolean",
          "description": "Whether flag changes require approval"
        }
      }
    }
  }
}
