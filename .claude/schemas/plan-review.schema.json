{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.com/schemas/plan-review.schema.json",
  "title": "Plan Review",
  "description": "Comprehensive plan review artifact aggregating reviews from multiple domain experts",
  "type": "object",
  "required": [
    "plan_id",
    "workflow_id",
    "timestamp",
    "reviews",
    "overall_verdict",
    "overall_score"
  ],
  "properties": {
    "plan_id": {
      "type": "string",
      "description": "Identifier for the plan being reviewed",
      "pattern": "^plan-[a-zA-Z0-9_-]+$"
    },
    "workflow_id": {
      "type": "string",
      "description": "Unique identifier for the workflow",
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "workflow_type": {
      "type": "string",
      "description": "Type of workflow",
      "enum": [
        "fullstack",
        "ai-system",
        "mobile",
        "code-quality",
        "performance",
        "refactoring",
        "incident",
        "api-design",
        "database-design",
        "legacy-modernization",
        "compliance"
      ]
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of review completion",
      "format": "date-time"
    },
    "reviews": {
      "type": "array",
      "description": "Individual domain reviews",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "review_domain",
          "reviewer_agent",
          "score",
          "verdict",
          "review_complete"
        ],
        "properties": {
          "review_domain": {
            "type": "string",
            "description": "Domain being reviewed",
            "enum": [
              "technical_feasibility",
              "security_implications",
              "product_alignment",
              "testability",
              "ux_accessibility",
              "performance_impact",
              "database_design",
              "api_contract",
              "compliance_requirements"
            ]
          },
          "reviewer_agent": {
            "type": "string",
            "description": "Agent who performed the review",
            "enum": [
              "architect",
              "security-architect",
              "pm",
              "qa",
              "ux-expert",
              "performance-engineer",
              "database-architect",
              "api-designer",
              "compliance-auditor"
            ]
          },
          "score": {
            "type": "number",
            "description": "Review score (0-10)",
            "minimum": 0,
            "maximum": 10
          },
          "verdict": {
            "type": "string",
            "description": "Review verdict",
            "enum": ["approved", "needs_revision", "rejected"]
          },
          "review_complete": {
            "type": "boolean",
            "description": "Whether review was completed"
          },
          "timestamp": {
            "type": "string",
            "description": "ISO 8601 timestamp of individual review",
            "format": "date-time"
          },
          "strengths": {
            "type": "array",
            "description": "Plan strengths identified",
            "items": {
              "type": "string",
              "minLength": 10
            }
          },
          "concerns": {
            "type": "array",
            "description": "Concerns identified",
            "items": {
              "type": "object",
              "required": ["severity", "description"],
              "properties": {
                "severity": {
                  "type": "string",
                  "enum": ["critical", "high", "medium", "low"]
                },
                "description": {
                  "type": "string",
                  "minLength": 20
                },
                "remediation": {
                  "type": "string",
                  "description": "Suggested remediation"
                }
              }
            }
          },
          "recommendations": {
            "type": "array",
            "description": "Recommendations for improvement",
            "items": {
              "type": "string",
              "minLength": 10
            }
          },
          "blocking_issues": {
            "type": "array",
            "description": "Blocking issues that must be addressed",
            "items": {
              "type": "string",
              "minLength": 20
            }
          },
          "review_notes": {
            "type": "string",
            "description": "Additional review notes"
          }
        }
      }
    },
    "overall_verdict": {
      "type": "string",
      "description": "Overall verdict across all reviews",
      "enum": ["approved", "approved_with_conditions", "needs_revision", "rejected"]
    },
    "overall_score": {
      "type": "number",
      "description": "Weighted average score across all reviews",
      "minimum": 0,
      "maximum": 10
    },
    "blocking_reviews": {
      "type": "array",
      "description": "Reviews with blocking scores",
      "items": {
        "type": "string",
        "enum": [
          "technical_feasibility",
          "security_implications",
          "product_alignment",
          "testability",
          "ux_accessibility",
          "performance_impact",
          "database_design",
          "api_contract",
          "compliance_requirements"
        ]
      }
    },
    "requires_revision": {
      "type": "boolean",
      "description": "Whether plan requires revision before proceeding"
    },
    "revision_priority": {
      "type": "array",
      "description": "Prioritized list of areas requiring revision",
      "items": {
        "type": "object",
        "required": ["domain", "priority"],
        "properties": {
          "domain": {
            "type": "string"
          },
          "priority": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          },
          "issues": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "approval_conditions": {
      "type": "array",
      "description": "Conditions that must be met for approval",
      "items": {
        "type": "string",
        "minLength": 10
      }
    },
    "summary": {
      "type": "object",
      "description": "Review summary statistics",
      "properties": {
        "total_reviews": {
          "type": "integer",
          "minimum": 0
        },
        "approved_reviews": {
          "type": "integer",
          "minimum": 0
        },
        "needs_revision_reviews": {
          "type": "integer",
          "minimum": 0
        },
        "rejected_reviews": {
          "type": "integer",
          "minimum": 0
        },
        "average_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 10
        },
        "lowest_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 10
        },
        "highest_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 10
        },
        "critical_concerns": {
          "type": "integer",
          "minimum": 0
        },
        "high_concerns": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "next_steps": {
      "type": "array",
      "description": "Recommended next steps based on review",
      "items": {
        "type": "string",
        "minLength": 10
      }
    },
    "escalation_required": {
      "type": "boolean",
      "description": "Whether escalation to Master Orchestrator is required"
    },
    "escalation_reason": {
      "type": "string",
      "description": "Reason for escalation (if escalation_required is true)"
    },
    "review_metadata": {
      "type": "object",
      "description": "Review metadata",
      "properties": {
        "review_start_time": {
          "type": "string",
          "format": "date-time"
        },
        "review_end_time": {
          "type": "string",
          "format": "date-time"
        },
        "review_duration": {
          "type": "string",
          "description": "Duration of review process"
        },
        "parallel_reviews": {
          "type": "boolean",
          "description": "Whether reviews were conducted in parallel"
        }
      }
    },
    "review_notes": {
      "type": "string",
      "description": "Overall review notes"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "overall_verdict": {
            "const": "approved_with_conditions"
          }
        }
      },
      "then": {
        "required": ["approval_conditions"]
      }
    },
    {
      "if": {
        "properties": {
          "escalation_required": {
            "const": true
          }
        }
      },
      "then": {
        "required": ["escalation_reason"]
      }
    }
  ]
}
