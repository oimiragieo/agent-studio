{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Dependency Health Report",
  "description": "Schema for dependency health report artifacts generated by dependency analysis workflows",
  "required": ["report_id", "report_date", "analyzer_agent", "summary"],
  "properties": {
    "report_id": {
      "type": "string",
      "description": "Unique identifier for the dependency health report"
    },
    "report_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the report was generated"
    },
    "analyzer_agent": {
      "type": "string",
      "description": "Agent or tool that generated the report (e.g., developer, dependency-analyzer)"
    },
    "project_path": {
      "type": "string",
      "description": "Path to the project root where dependencies were analyzed"
    },
    "package_manager": {
      "type": "string",
      "enum": ["npm", "yarn", "pnpm", "pip", "poetry", "go", "cargo", "maven", "gradle", "other"],
      "description": "Package manager used in the project"
    },
    "summary": {
      "type": "object",
      "required": ["total_dependencies", "outdated_count", "up_to_date_count"],
      "properties": {
        "total_dependencies": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of dependencies in the project"
        },
        "outdated_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of outdated dependencies"
        },
        "up_to_date_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of dependencies that are up to date"
        },
        "major_updates_available": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages with major version updates available"
        },
        "minor_updates_available": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages with minor version updates available"
        },
        "patch_updates_available": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages with patch version updates available"
        },
        "security_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of security vulnerabilities found"
        },
        "critical_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of critical security vulnerabilities"
        },
        "legacy_packages": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages identified as legacy/deprecated"
        }
      }
    },
    "outdated_packages": {
      "type": "array",
      "description": "List of outdated packages with version information",
      "items": {
        "type": "object",
        "required": [
          "package_name",
          "current_version",
          "wanted_version",
          "latest_version",
          "update_type"
        ],
        "properties": {
          "package_name": {
            "type": "string",
            "description": "Name of the package"
          },
          "current_version": {
            "type": "string",
            "description": "Currently installed version"
          },
          "wanted_version": {
            "type": "string",
            "description": "Version that satisfies semver range (if applicable)"
          },
          "latest_version": {
            "type": "string",
            "description": "Latest available version"
          },
          "update_type": {
            "type": "string",
            "enum": ["major", "minor", "patch"],
            "description": "Type of update available"
          },
          "location": {
            "type": "string",
            "description": "Location/path where the package is used (e.g., package.json path)"
          },
          "depended_by": {
            "type": "string",
            "description": "Package or project that depends on this package"
          },
          "has_breaking_changes": {
            "type": "boolean",
            "description": "Whether the update includes breaking changes"
          },
          "breaking_changes_researched": {
            "type": "boolean",
            "description": "Whether breaking changes have been researched via web search"
          },
          "risk_level": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"],
            "description": "Risk level of updating this package"
          },
          "estimated_effort": {
            "type": "string",
            "description": "Estimated effort to update (e.g., '2-4 hours', '1 day')"
          }
        }
      }
    },
    "breaking_changes_research": {
      "type": "object",
      "description": "Summary of breaking changes research findings",
      "properties": {
        "packages_researched": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages researched for breaking changes"
        },
        "research_sources": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "URLs and sources used for research"
        },
        "migration_guides_found": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of migration guides found"
        }
      }
    },
    "legacy_code_findings": {
      "type": "array",
      "description": "Legacy code patterns and deprecated usage found",
      "items": {
        "type": "object",
        "required": ["pattern_type", "description", "severity"],
        "properties": {
          "pattern_type": {
            "type": "string",
            "enum": [
              "deprecated_api",
              "outdated_package",
              "legacy_pattern",
              "security_risk",
              "other"
            ],
            "description": "Type of legacy pattern found"
          },
          "description": {
            "type": "string",
            "description": "Description of the legacy pattern"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"],
            "description": "Severity of the legacy pattern"
          },
          "location": {
            "type": "string",
            "description": "File path or location where the pattern is found"
          },
          "package_name": {
            "type": "string",
            "description": "Related package name (if applicable)"
          },
          "recommendation": {
            "type": "string",
            "description": "Recommendation for addressing the legacy pattern"
          },
          "impact_areas": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Areas of the codebase that would be affected"
          }
        }
      }
    },
    "update_strategy": {
      "type": "object",
      "description": "Phased update plan with risk assessment",
      "properties": {
        "phases": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["phase_number", "phase_name", "packages", "risk_level"],
            "properties": {
              "phase_number": {
                "type": "integer",
                "minimum": 1,
                "description": "Phase number in the update strategy"
              },
              "phase_name": {
                "type": "string",
                "description": "Name of the phase (e.g., 'Safe Updates', 'Medium Risk Updates')"
              },
              "packages": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "List of package names to update in this phase"
              },
              "risk_level": {
                "type": "string",
                "enum": ["low", "medium", "high"],
                "description": "Risk level of this phase"
              },
              "estimated_time": {
                "type": "string",
                "description": "Estimated time to complete this phase"
              },
              "prerequisites": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Prerequisites before starting this phase"
              },
              "testing_requirements": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Testing requirements for this phase"
              }
            }
          }
        },
        "total_estimated_time": {
          "type": "string",
          "description": "Total estimated time for all phases"
        },
        "overall_risk_assessment": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Overall risk assessment for the update strategy"
        }
      }
    },
    "security_vulnerabilities": {
      "type": "array",
      "description": "Security vulnerabilities found in dependencies",
      "items": {
        "type": "object",
        "required": ["package_name", "severity", "cve_id"],
        "properties": {
          "package_name": {
            "type": "string",
            "description": "Name of the vulnerable package"
          },
          "current_version": {
            "type": "string",
            "description": "Currently installed vulnerable version"
          },
          "fixed_version": {
            "type": "string",
            "description": "Version that fixes the vulnerability"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"],
            "description": "Severity of the vulnerability"
          },
          "cve_id": {
            "type": "string",
            "description": "CVE identifier (e.g., CVE-2021-23337)"
          },
          "description": {
            "type": "string",
            "description": "Description of the vulnerability"
          },
          "advisory_url": {
            "type": "string",
            "format": "uri",
            "description": "URL to security advisory"
          },
          "recommendation": {
            "type": "string",
            "description": "Recommendation for fixing the vulnerability"
          }
        }
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Prioritized action items and recommendations",
      "items": {
        "type": "object",
        "required": ["action", "priority"],
        "properties": {
          "action": {
            "type": "string",
            "description": "Recommended action to take"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"],
            "description": "Priority level (P0 = critical, P3 = low)"
          },
          "category": {
            "type": "string",
            "enum": [
              "security",
              "breaking_changes",
              "legacy_code",
              "performance",
              "maintenance",
              "other"
            ],
            "description": "Category of the recommendation"
          },
          "estimated_effort": {
            "type": "string",
            "description": "Estimated effort to complete the action"
          },
          "packages_affected": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of packages affected by this recommendation"
          },
          "rationale": {
            "type": "string",
            "description": "Reasoning for this recommendation"
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "analysis_tool": {
          "type": "string",
          "description": "Tool used for dependency analysis (e.g., npm outdated, dependency-analyzer)"
        },
        "analysis_command": {
          "type": "string",
          "description": "Command executed for analysis (e.g., 'npm outdated --depth=0')"
        },
        "research_tools_used": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Research tools used (e.g., Exa, WebFetch, Ref)"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or context about the analysis"
        }
      }
    }
  }
}
