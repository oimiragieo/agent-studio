{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.dev/schemas/plan-rating.schema.json",
  "title": "Plan Rating Artifact Schema",
  "description": "Schema for plan rating artifacts generated by response-rater skill",
  "type": "object",
  "required": [
    "plan_id",
    "workflow_id",
    "run_id",
    "overall_score",
    "rubric_scores",
    "passed",
    "status",
    "rated_at",
    "rated_by"
  ],
  "properties": {
    "plan_id": {
      "type": "string",
      "description": "Unique identifier for the plan being rated",
      "pattern": "^plan-[a-zA-Z0-9-]+$",
      "examples": ["plan-greenfield-2025-01-05", "plan-feature-auth-001"]
    },
    "workflow_id": {
      "type": "string",
      "description": "Workflow identifier for the plan",
      "pattern": "^[a-zA-Z0-9-]+$",
      "examples": ["workflow-001", "greenfield-flow"]
    },
    "run_id": {
      "type": "string",
      "description": "Run identifier for the workflow execution",
      "pattern": "^run-[a-zA-Z0-9-]+$",
      "examples": ["run-001", "run-2025-01-05-abc123"]
    },
    "overall_score": {
      "type": "number",
      "description": "Overall plan quality score (0-10 scale)",
      "minimum": 0,
      "maximum": 10,
      "examples": [7.5, 8.2, 6.8]
    },
    "rubric_scores": {
      "type": "object",
      "description": "Individual dimension scores from the rating rubric",
      "required": [
        "completeness",
        "feasibility",
        "risk_mitigation",
        "agent_coverage",
        "integration"
      ],
      "properties": {
        "completeness": {
          "type": "number",
          "description": "Plan covers all required steps and deliverables",
          "minimum": 0,
          "maximum": 10
        },
        "feasibility": {
          "type": "number",
          "description": "Plan is technically achievable with available resources",
          "minimum": 0,
          "maximum": 10
        },
        "risk_mitigation": {
          "type": "number",
          "description": "Risks identified and mitigation strategies defined",
          "minimum": 0,
          "maximum": 10
        },
        "agent_coverage": {
          "type": "number",
          "description": "Appropriate agents assigned for each task",
          "minimum": 0,
          "maximum": 10
        },
        "integration": {
          "type": "number",
          "description": "Steps integrate well with existing codebase/workflows",
          "minimum": 0,
          "maximum": 10
        }
      },
      "additionalProperties": false
    },
    "feedback": {
      "description": "Detailed feedback on the plan quality",
      "oneOf": [
        {
          "type": "string",
          "minLength": 10,
          "maxLength": 2000
        },
        {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 5,
            "maxLength": 500
          },
          "minItems": 1,
          "maxItems": 20
        }
      ],
      "examples": [
        "Plan lacks detailed risk mitigation strategies for database migration",
        ["Completeness: Missing error handling steps", "Feasibility: Resource allocation unclear"]
      ]
    },
    "passed": {
      "type": "boolean",
      "description": "Whether the plan meets the minimum score threshold",
      "examples": [true, false]
    },
    "status": {
      "type": "string",
      "description": "Current status of the plan rating",
      "enum": ["pending", "passed", "failed", "retry"],
      "examples": ["passed", "failed", "retry"]
    },
    "attempt": {
      "type": "integer",
      "description": "Current rating attempt number (1-based)",
      "minimum": 1,
      "default": 1,
      "examples": [1, 2, 3]
    },
    "max_attempts": {
      "type": "integer",
      "description": "Maximum number of rating attempts allowed",
      "minimum": 1,
      "default": 3,
      "examples": [3, 5]
    },
    "rated_at": {
      "type": "string",
      "description": "ISO 8601 datetime when the plan was rated",
      "format": "date-time",
      "examples": ["2025-01-05T10:30:00Z", "2025-01-05T14:45:30.123Z"]
    },
    "rated_by": {
      "description": "Provider(s) that performed the rating",
      "oneOf": [
        {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-]+$",
          "examples": ["anthropic", "openai", "google"]
        },
        {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9-]+$"
          },
          "minItems": 1,
          "uniqueItems": true,
          "examples": [["anthropic", "openai"], ["google"]]
        }
      ]
    },
    "history": {
      "type": "array",
      "description": "History of previous rating attempts",
      "items": {
        "type": "object",
        "required": ["attempt", "overall_score", "rubric_scores", "rated_at", "feedback"],
        "properties": {
          "attempt": {
            "type": "integer",
            "minimum": 1
          },
          "overall_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 10
          },
          "rubric_scores": {
            "type": "object",
            "properties": {
              "completeness": { "type": "number", "minimum": 0, "maximum": 10 },
              "feasibility": { "type": "number", "minimum": 0, "maximum": 10 },
              "risk_mitigation": { "type": "number", "minimum": 0, "maximum": 10 },
              "agent_coverage": { "type": "number", "minimum": 0, "maximum": 10 },
              "integration": { "type": "number", "minimum": 0, "maximum": 10 }
            }
          },
          "rated_at": {
            "type": "string",
            "format": "date-time"
          },
          "feedback": {
            "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }]
          },
          "rated_by": {
            "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }]
          }
        }
      }
    },
    "rubric_version": {
      "type": "string",
      "description": "Version of the rubric used for rating",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0", "1.1.0"]
    },
    "rubric_name": {
      "type": "string",
      "description": "Name of the rubric used for rating",
      "examples": ["Standard Plan Rubric", "Emergency Plan Rubric", "Enterprise Plan Rubric"]
    },
    "task_type": {
      "type": "string",
      "description": "Task type used to determine minimum score threshold",
      "examples": ["IMPLEMENTATION", "SECURITY", "ARCHITECTURE", "BUG_FIX_SIMPLE"]
    },
    "minimum_score_threshold": {
      "type": "number",
      "description": "Minimum score required for this plan to pass",
      "minimum": 0,
      "maximum": 10,
      "default": 7,
      "examples": [7, 8, 9]
    },
    "improvements_suggested": {
      "type": "array",
      "description": "List of suggested improvements for failed plans",
      "items": {
        "type": "object",
        "required": ["dimension", "suggestion"],
        "properties": {
          "dimension": {
            "type": "string",
            "enum": [
              "completeness",
              "feasibility",
              "risk_mitigation",
              "agent_coverage",
              "integration"
            ]
          },
          "suggestion": {
            "type": "string",
            "minLength": 10,
            "maxLength": 500
          },
          "priority": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"],
            "default": "medium"
          }
        }
      }
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "plan_id": "plan-greenfield-2025-01-05",
      "workflow_id": "workflow-001",
      "run_id": "run-001",
      "overall_score": 8.2,
      "rubric_scores": {
        "completeness": 9,
        "feasibility": 8,
        "risk_mitigation": 7,
        "agent_coverage": 9,
        "integration": 8
      },
      "feedback": [
        "Completeness: Excellent coverage of all required steps",
        "Risk mitigation: Could expand on database rollback procedures"
      ],
      "passed": true,
      "status": "passed",
      "attempt": 1,
      "max_attempts": 3,
      "rated_at": "2025-01-05T10:30:00Z",
      "rated_by": "anthropic",
      "rubric_version": "1.0.0",
      "rubric_name": "Standard Plan Rubric",
      "task_type": "IMPLEMENTATION",
      "minimum_score_threshold": 7
    }
  ]
}
