{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Post-Mortem Report",
  "description": "Schema for post-mortem report artifacts generated after incident resolution",
  "required": ["postmortem_id", "postmortem_date", "incident_summary", "root_cause_analysis", "prevention_measures"],
  "properties": {
    "postmortem_id": {
      "type": "string",
      "description": "Unique identifier for the post-mortem report"
    },
    "postmortem_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when post-mortem was completed"
    },
    "author": {
      "type": "string",
      "description": "Agent or user who authored the post-mortem"
    },
    "participants": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Participants in the post-mortem review"
    },
    "incident_summary": {
      "type": "object",
      "required": ["title", "severity", "impact_summary"],
      "properties": {
        "title": {
          "type": "string"
        },
        "incident_id": {
          "type": "string"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "incident_date": {
          "type": "string",
          "format": "date-time"
        },
        "duration": {
          "type": "string",
          "description": "Total duration of the incident"
        },
        "impact_summary": {
          "type": "string"
        },
        "affected_services": {
          "type": "array",
          "items": { "type": "string" }
        },
        "affected_users_count": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "timeline": {
      "type": "array",
      "description": "Detailed timeline of the incident",
      "items": {
        "type": "object",
        "required": ["timestamp", "event"],
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "event": {
            "type": "string"
          },
          "actor": {
            "type": "string"
          },
          "category": {
            "type": "string",
            "enum": ["detection", "response", "diagnosis", "mitigation", "resolution", "communication"]
          }
        }
      }
    },
    "root_cause_analysis": {
      "type": "object",
      "required": ["root_cause", "contributing_factors"],
      "properties": {
        "root_cause": {
          "type": "string",
          "description": "Primary root cause of the incident"
        },
        "five_whys": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "why": { "type": "string" },
              "answer": { "type": "string" }
            }
          },
          "description": "Five whys analysis"
        },
        "contributing_factors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "factor": { "type": "string" },
              "category": {
                "type": "string",
                "enum": ["process", "technology", "people", "environment"]
              },
              "contribution_level": {
                "type": "string",
                "enum": ["primary", "secondary", "minor"]
              }
            }
          }
        },
        "trigger": {
          "type": "string",
          "description": "What triggered the incident"
        }
      }
    },
    "what_went_well": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "item": { "type": "string" },
          "details": { "type": "string" }
        }
      },
      "description": "Things that worked well during incident response"
    },
    "what_went_wrong": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "item": { "type": "string" },
          "details": { "type": "string" },
          "impact": { "type": "string" }
        }
      },
      "description": "Things that could have been better"
    },
    "where_we_got_lucky": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "item": { "type": "string" },
          "what_could_have_happened": { "type": "string" }
        }
      },
      "description": "Near misses or areas where luck played a role"
    },
    "prevention_measures": {
      "type": "array",
      "description": "Action items to prevent recurrence",
      "items": {
        "type": "object",
        "required": ["action", "priority", "owner"],
        "properties": {
          "action_id": {
            "type": "string"
          },
          "action": {
            "type": "string"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"]
          },
          "category": {
            "type": "string",
            "enum": ["prevention", "detection", "mitigation", "process", "documentation"]
          },
          "owner": {
            "type": "string"
          },
          "due_date": {
            "type": "string",
            "format": "date"
          },
          "status": {
            "type": "string",
            "enum": ["not_started", "in_progress", "completed", "blocked"]
          },
          "tracking_issue": {
            "type": "string",
            "description": "Link to tracking issue (e.g., Jira, GitHub)"
          }
        }
      }
    },
    "detection_improvements": {
      "type": "object",
      "properties": {
        "current_ttd": {
          "type": "string",
          "description": "Current time to detect"
        },
        "target_ttd": {
          "type": "string",
          "description": "Target time to detect"
        },
        "new_alerts": {
          "type": "array",
          "items": { "type": "string" }
        },
        "monitoring_gaps": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "process_improvements": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "area": {
            "type": "string",
            "enum": ["escalation", "communication", "runbooks", "training", "tooling", "on_call"]
          },
          "improvement": { "type": "string" },
          "rationale": { "type": "string" }
        }
      }
    },
    "lessons_learned": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Key lessons learned from this incident"
    },
    "metrics": {
      "type": "object",
      "properties": {
        "time_to_detect": { "type": "string" },
        "time_to_acknowledge": { "type": "string" },
        "time_to_mitigate": { "type": "string" },
        "time_to_resolve": { "type": "string" },
        "total_incident_duration": { "type": "string" },
        "mttr_impact": { "type": "string", "description": "Impact on MTTR metrics" }
      }
    },
    "follow_up": {
      "type": "object",
      "properties": {
        "review_scheduled": {
          "type": "boolean"
        },
        "review_date": {
          "type": "string",
          "format": "date"
        },
        "action_items_review": {
          "type": "string",
          "format": "date",
          "description": "Date to review action item completion"
        }
      }
    }
  }
}
