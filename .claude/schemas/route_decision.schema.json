{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Route Decision",
  "description": "Schema for workflow routing decisions by Router Agent or BMAD Orchestrator",
  "required": ["selected_workflow"],
  "properties": {
    "intent": {
      "type": "string",
      "enum": ["web_app", "script", "analysis", "infrastructure", "mobile", "ai_system"],
      "description": "Primary intent classification from router agent"
    },
    "complexity": {
      "type": "string",
      "enum": ["high", "medium", "low"],
      "description": "Complexity assessment of the request"
    },
    "cloud_provider": {
      "type": ["string", "null"],
      "enum": ["gcp", "aws", "azure", null],
      "description": "Cloud provider mentioned in request, or null if none"
    },
    "workflow_selection": {
      "type": "string",
      "description": "Path to selected workflow file (semantic routing)"
    },
    "workflow_type": {
      "type": "string",
      "enum": ["greenfield", "brownfield"],
      "description": "Type of project workflow (legacy field, for backward compatibility)"
    },
    "project_type": {
      "type": "string",
      "enum": ["ui", "service", "fullstack"],
      "description": "Type of project (legacy field, for backward compatibility)"
    },
    "selected_workflow": {
      "type": "string",
      "description": "Path to selected workflow file (primary field, used by both routing methods)"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence level in the routing decision (0.0-1.0)"
    },
    "reasoning": {
      "type": "string",
      "description": "Rationale for workflow selection"
    },
    "keywords_detected": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Keywords that triggered workflow selection (for keyword-based routing)"
    },
    "routing_method": {
      "type": "string",
      "enum": ["semantic", "keyword", "default"],
      "description": "Method used for routing (semantic routing, keyword matching, or default fallback)"
    },
    "missing_inputs": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of missing inputs required for workflow execution (e.g., 'auth_provider', 'database_type', 'deployment_target')"
    },
    "should_escalate": {
      "type": "boolean",
      "description": "Whether the router is requesting a forced handoff to a specific agent (used by router-first enforcement)"
    },
    "escalation_target": {
      "type": ["string", "null"],
      "description": "Agent name to hand off execution to when should_escalate is true (e.g., 'diagnostics-runner')"
    }
  }
}
