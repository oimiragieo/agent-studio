{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Artifact Registry",
  "description": "Canonical artifact registry - maps artifact names to artifact metadata",
  "required": ["run_id", "workflow_id", "artifacts"],
  "properties": {
    "run_id": {
      "type": "string",
      "description": "Run identifier",
      "pattern": "^run-[a-zA-Z0-9_-]+$"
    },
    "workflow_id": {
      "type": "string",
      "description": "Workflow identifier"
    },
    "artifacts": {
      "type": "object",
      "description": "Map of artifact names to artifact metadata (O(1) lookups, supports versioning)",
      "additionalProperties": {
        "$ref": "#/definitions/artifact"
      }
    },
    "artifacts_list": {
      "type": "array",
      "description": "Optional ordered list of artifact names for UI queries and iteration",
      "items": {
        "type": "string"
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when registry was created"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when registry was last updated"
    }
  },
  "definitions": {
    "artifact": {
      "type": "object",
      "required": ["name", "step", "agent", "path"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Artifact name (unique within run)"
        },
        "step": {
          "type": "integer",
          "description": "Step number that produced this artifact",
          "minimum": 0
        },
        "agent": {
          "type": "string",
          "description": "Agent that produced this artifact"
        },
        "path": {
          "type": "string",
          "description": "Absolute or relative path to artifact file"
        },
        "validationStatus": {
          "type": "string",
          "enum": ["pass", "fail", "pending"],
          "description": "Validation status of the artifact",
          "default": "pending"
        },
        "version": {
          "type": "integer",
          "description": "Version number (incremented on reruns if idempotency_policy is 'version')",
          "minimum": 1,
          "default": 1
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when artifact was created"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when artifact was last updated"
        },
        "schema": {
          "type": "string",
          "description": "Path to JSON schema used for validation"
        },
        "gate_path": {
          "type": "string",
          "description": "Path to gate file for this artifact"
        },
        "reasoning_path": {
          "type": "string",
          "description": "Path to reasoning file for this artifact (optional)"
        },
        "publishable": {
          "type": "boolean",
          "description": "Whether this artifact should be published",
          "default": false
        },
        "published": {
          "type": "boolean",
          "description": "Whether this artifact has been published",
          "default": false
        },
        "published_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "ISO 8601 timestamp when artifact was published"
        },
        "publish_targets": {
          "type": "array",
          "description": "Target destinations for publishing (e.g., project_feed, cursor)",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "publish_attempts": {
          "type": "array",
          "description": "History of publish attempts for retry tracking",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "status": {
                "type": "string",
                "enum": ["success", "failed"]
              },
              "error": {
                "type": ["string", "null"]
              },
              "target": {
                "type": "string"
              }
            }
          },
          "default": []
        },
        "publish_status": {
          "type": "string",
          "enum": ["pending", "success", "failed"],
          "description": "Current publishing status",
          "default": "pending"
        },
        "publish_error": {
          "type": ["string", "null"],
          "description": "Error message if publishing failed"
        },
        "dependencies": {
          "type": "array",
          "description": "List of artifact names this artifact depends on",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "metadata": {
          "type": "object",
          "description": "Additional metadata for backwards compatibility",
          "properties": {
            "size": {
              "type": "integer",
              "description": "File size in bytes"
            },
            "type": {
              "type": "string",
              "description": "Artifact type (e.g., json, markdown, yaml)"
            },
            "validation_status": {
              "type": "string",
              "enum": ["pass", "fail", "pending"]
            },
            "publishable": { "type": "boolean" },
            "published": { "type": "boolean" },
            "published_at": { "type": ["string", "null"] },
            "publish_targets": { "type": "array", "items": { "type": "string" } },
            "publish_attempts": { "type": "array" },
            "publish_status": { "type": "string" },
            "publish_error": { "type": ["string", "null"] }
          }
        }
      }
    }
  }
}

