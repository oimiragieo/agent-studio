{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Infrastructure Analysis",
  "description": "Schema for infrastructure analysis artifacts generated by devops agent during incident response",
  "required": [
    "analysis_id",
    "analysis_date",
    "infrastructure_status",
    "findings",
    "remediation_recommendations"
  ],
  "properties": {
    "analysis_id": {
      "type": "string",
      "description": "Unique identifier for the infrastructure analysis"
    },
    "analysis_date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when analysis was performed"
    },
    "analyst": {
      "type": "string",
      "description": "Agent or user who performed the analysis"
    },
    "infrastructure_status": {
      "type": "string",
      "enum": ["healthy", "degraded", "critical", "unknown"],
      "description": "Overall infrastructure health status"
    },
    "log_analysis": {
      "type": "object",
      "properties": {
        "logs_reviewed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of log entries reviewed"
        },
        "time_range": {
          "type": "object",
          "properties": {
            "start": {
              "type": "string",
              "format": "date-time"
            },
            "end": {
              "type": "string",
              "format": "date-time"
            }
          }
        },
        "error_patterns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "pattern": {
                "type": "string"
              },
              "count": {
                "type": "integer"
              },
              "first_seen": {
                "type": "string",
                "format": "date-time"
              },
              "severity": {
                "type": "string",
                "enum": ["critical", "error", "warning", "info"]
              }
            }
          }
        },
        "anomalies_detected": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "metric_correlation": {
      "type": "object",
      "properties": {
        "cpu_utilization": {
          "type": "object",
          "properties": {
            "average": { "type": "number" },
            "peak": { "type": "number" },
            "anomaly_detected": { "type": "boolean" }
          }
        },
        "memory_utilization": {
          "type": "object",
          "properties": {
            "average": { "type": "number" },
            "peak": { "type": "number" },
            "anomaly_detected": { "type": "boolean" }
          }
        },
        "disk_io": {
          "type": "object",
          "properties": {
            "read_throughput": { "type": "number" },
            "write_throughput": { "type": "number" },
            "latency_ms": { "type": "number" },
            "anomaly_detected": { "type": "boolean" }
          }
        },
        "network": {
          "type": "object",
          "properties": {
            "bandwidth_utilization": { "type": "number" },
            "packet_loss": { "type": "number" },
            "latency_ms": { "type": "number" },
            "anomaly_detected": { "type": "boolean" }
          }
        },
        "correlated_events": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": { "type": "string", "format": "date-time" },
              "metrics": { "type": "array", "items": { "type": "string" } },
              "correlation_strength": { "type": "string", "enum": ["strong", "moderate", "weak"] }
            }
          }
        }
      }
    },
    "deployment_history": {
      "type": "object",
      "properties": {
        "recent_deployments": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "deployment_id": { "type": "string" },
              "timestamp": { "type": "string", "format": "date-time" },
              "service": { "type": "string" },
              "version": { "type": "string" },
              "deployer": { "type": "string" },
              "potentially_related": { "type": "boolean" }
            }
          }
        },
        "config_changes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "change_id": { "type": "string" },
              "timestamp": { "type": "string", "format": "date-time" },
              "description": { "type": "string" },
              "potentially_related": { "type": "boolean" }
            }
          }
        }
      }
    },
    "configuration_drift": {
      "type": "object",
      "properties": {
        "drift_detected": {
          "type": "boolean"
        },
        "drifted_resources": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "resource": { "type": "string" },
              "expected": { "type": "string" },
              "actual": { "type": "string" },
              "severity": { "type": "string", "enum": ["critical", "high", "medium", "low"] }
            }
          }
        }
      }
    },
    "findings": {
      "type": "array",
      "description": "Key findings from infrastructure analysis",
      "items": {
        "type": "object",
        "required": ["finding", "severity", "category"],
        "properties": {
          "finding": {
            "type": "string"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          },
          "category": {
            "type": "string",
            "enum": [
              "performance",
              "availability",
              "configuration",
              "capacity",
              "security",
              "deployment"
            ]
          },
          "evidence": {
            "type": "array",
            "items": { "type": "string" }
          },
          "affected_components": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    },
    "rollback_assessment": {
      "type": "object",
      "properties": {
        "rollback_recommended": {
          "type": "boolean"
        },
        "rollback_target": {
          "type": "string",
          "description": "Version or state to rollback to"
        },
        "rollback_risk": {
          "type": "string",
          "enum": ["high", "medium", "low"]
        },
        "rollback_procedure": {
          "type": "array",
          "items": { "type": "string" }
        },
        "estimated_rollback_time": {
          "type": "string"
        }
      }
    },
    "remediation_recommendations": {
      "type": "array",
      "description": "Recommended remediation actions",
      "items": {
        "type": "object",
        "required": ["action", "priority"],
        "properties": {
          "action": {
            "type": "string"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"]
          },
          "category": {
            "type": "string",
            "enum": ["immediate", "short_term", "long_term"]
          },
          "estimated_impact": {
            "type": "string"
          },
          "dependencies": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    }
  }
}
