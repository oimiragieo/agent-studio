{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://llm-rules.com/schemas/security-code-review.schema.json",
  "title": "Security Code Review",
  "description": "Security-focused code review artifact identifying security vulnerabilities and risks",
  "type": "object",
  "required": [
    "review_id",
    "timestamp",
    "reviewer",
    "files_reviewed",
    "security_findings",
    "overall_assessment"
  ],
  "properties": {
    "review_id": {
      "type": "string",
      "description": "Unique identifier for the security code review"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of review",
      "format": "date-time"
    },
    "reviewer": {
      "type": "string",
      "description": "Agent or user who performed the review"
    },
    "files_reviewed": {
      "type": "array",
      "description": "Files reviewed for security issues",
      "items": {
        "type": "string"
      }
    },
    "security_findings": {
      "type": "array",
      "description": "Security issues found in code review",
      "items": {
        "type": "object",
        "required": [
          "finding_id",
          "severity",
          "category",
          "file",
          "line_numbers",
          "description",
          "recommendation"
        ],
        "properties": {
          "finding_id": {
            "type": "string",
            "description": "Unique finding identifier"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low", "info"]
          },
          "category": {
            "type": "string",
            "enum": [
              "injection",
              "authentication",
              "authorization",
              "data_exposure",
              "xss",
              "csrf",
              "insecure_crypto",
              "hardcoded_secrets",
              "insecure_deserialization",
              "path_traversal",
              "race_condition",
              "buffer_overflow",
              "memory_leak",
              "other"
            ]
          },
          "file": {
            "type": "string",
            "description": "File path where issue was found"
          },
          "line_numbers": {
            "type": "object",
            "description": "Line numbers of affected code",
            "properties": {
              "start": {
                "type": "integer",
                "minimum": 1
              },
              "end": {
                "type": "integer",
                "minimum": 1
              }
            }
          },
          "description": {
            "type": "string",
            "minLength": 20,
            "description": "Detailed description of the security issue"
          },
          "code_snippet": {
            "type": "string",
            "description": "Code snippet demonstrating the issue"
          },
          "attack_scenario": {
            "type": "string",
            "description": "How this vulnerability could be exploited"
          },
          "recommendation": {
            "type": "string",
            "minLength": 10,
            "description": "Recommended fix for the security issue"
          },
          "secure_code_example": {
            "type": "string",
            "description": "Example of secure code implementation"
          },
          "cwe_id": {
            "type": "string",
            "pattern": "^CWE-[0-9]+$"
          },
          "owasp_category": {
            "type": "string",
            "description": "OWASP Top 10 category if applicable"
          },
          "references": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "overall_assessment": {
      "type": "object",
      "required": ["security_posture", "risk_level"],
      "properties": {
        "security_posture": {
          "type": "string",
          "enum": ["excellent", "good", "adequate", "poor", "critical"]
        },
        "risk_level": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "summary": {
          "type": "string",
          "description": "Overall summary of security review"
        },
        "findings_summary": {
          "type": "object",
          "properties": {
            "critical": {
              "type": "integer",
              "minimum": 0
            },
            "high": {
              "type": "integer",
              "minimum": 0
            },
            "medium": {
              "type": "integer",
              "minimum": 0
            },
            "low": {
              "type": "integer",
              "minimum": 0
            },
            "info": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    },
    "code_patterns_reviewed": {
      "type": "array",
      "description": "Security-relevant code patterns reviewed",
      "items": {
        "type": "string",
        "enum": [
          "input_validation",
          "authentication_flow",
          "authorization_checks",
          "cryptographic_operations",
          "secret_handling",
          "database_queries",
          "file_operations",
          "network_operations",
          "session_management",
          "error_handling"
        ]
      }
    },
    "best_practices_adherence": {
      "type": "object",
      "description": "Assessment of security best practices",
      "properties": {
        "input_sanitization": {
          "type": "string",
          "enum": ["excellent", "good", "needs_improvement", "poor", "not_applicable"]
        },
        "output_encoding": {
          "type": "string",
          "enum": ["excellent", "good", "needs_improvement", "poor", "not_applicable"]
        },
        "parameterized_queries": {
          "type": "string",
          "enum": ["excellent", "good", "needs_improvement", "poor", "not_applicable"]
        },
        "secure_defaults": {
          "type": "string",
          "enum": ["excellent", "good", "needs_improvement", "poor", "not_applicable"]
        },
        "least_privilege": {
          "type": "string",
          "enum": ["excellent", "good", "needs_improvement", "poor", "not_applicable"]
        }
      }
    },
    "remediation_priority": {
      "type": "array",
      "description": "Prioritized list of remediation actions",
      "items": {
        "type": "object",
        "required": ["priority", "action", "finding_ids"],
        "properties": {
          "priority": {
            "type": "integer",
            "minimum": 1
          },
          "action": {
            "type": "string"
          },
          "finding_ids": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "estimated_effort": {
            "type": "string",
            "enum": ["low", "medium", "high"]
          }
        }
      }
    },
    "recommendations": {
      "type": "array",
      "description": "General security recommendations",
      "items": {
        "type": "string",
        "minLength": 10
      }
    },
    "review_notes": {
      "type": "string",
      "description": "Additional notes from the security code review"
    }
  }
}
