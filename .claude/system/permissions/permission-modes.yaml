# Permission Modes Configuration
# Controls global tool execution permissions across all agents

# ==============================================================================
# Permission Mode Levels
# ==============================================================================

modes:
  # Default Mode (Recommended for Development)
  default:
    description: "Standard permission checks - prompts for sensitive operations"
    enabled: true
    settings:
      require_approval_for:
        - Write   # File creation
        - Edit    # File modification
        - Bash    # Shell command execution (except git status/diff/log)
        - MCP tools # External tool invocation
      auto_approve:
        - Read    # File reading
        - Grep    # Code search
        - Glob    # File pattern matching

  # Accept Edits Mode (Rapid Iteration)
  acceptEdits:
    description: "Auto-approve file operations for rapid development iterations"
    enabled: true
    settings:
      require_approval_for:
        - Bash    # Shell commands still require approval
        - MCP tools
      auto_approve:
        - Read
        - Write   # Auto-approved
        - Edit    # Auto-approved
        - Grep
        - Glob
        - NotebookEdit  # Auto-approved
      restrictions:
        - "File operations limited to project directory only"
        - "System files and secrets remain blocked"
    use_cases:
      - "Rapid prototyping"
      - "Code refactoring sessions"
      - "Trusted development environments"

  # Bypass Permissions Mode (HIGH RISK - Use with Extreme Caution)
  bypassPermissions:
    description: "Skip all permission checks - for controlled automation only"
    enabled: false  # Disabled by default for security
    settings:
      require_approval_for: []  # Nothing requires approval
      auto_approve: "*"  # Everything auto-approved
    security_warnings:
      - "⚠️  CRITICAL: This mode disables ALL safety checks"
      - "⚠️  Use ONLY in isolated, sandboxed environments"
      - "⚠️  Risk: Destructive operations may execute without confirmation"
      - "⚠️  Recommended: Enable only for specific trusted workflows"
    use_cases:
      - "CI/CD pipeline automation (sandboxed)"
      - "Isolated test environments"
      - "Containerized workloads"
    enable_requirements:
      - "Must be explicitly enabled in settings.json"
      - "Audit logging must be active"
      - "Environment must be sandboxed"

  # Plan Mode (Analysis Only)
  plan:
    description: "Planning mode - no actual execution, only analysis"
    enabled: true
    settings:
      require_approval_for: "*"  # Everything requires approval
      auto_approve: []  # Nothing auto-approved
      block_execution: true  # Block actual execution
    use_cases:
      - "Pre-execution planning and analysis"
      - "Risk assessment before changes"
      - "Workflow design and validation"

# ==============================================================================
# Permission Processing Order
# ==============================================================================
# 1. PreToolUse Hook executes first
# 2. Explicit Deny Rules checked (highest priority)
# 3. Explicit Allow Rules checked
# 4. Ask Rules checked
# 5. Permission Mode defaults apply
# 6. canUseTool Callback executes
# 7. PostToolUse Hook executes last

processing_order:
  - name: "PreToolUse Hook"
    priority: 1
    description: "First line of defense - can override all other rules"

  - name: "Deny Rules"
    priority: 2
    description: "Explicit blocks - highest priority after hooks"

  - name: "Allow Rules"
    priority: 3
    description: "Explicit approvals for specific patterns"

  - name: "Ask Rules"
    priority: 4
    description: "Conditional approvals requiring runtime evaluation"

  - name: "Permission Mode"
    priority: 5
    description: "Mode-specific defaults from configuration above"

  - name: "canUseTool Callback"
    priority: 6
    description: "Custom runtime approval logic"

  - name: "PostToolUse Hook"
    priority: 7
    description: "Post-execution validation and logging"

# ==============================================================================
# Default Configuration
# ==============================================================================

default_mode: "default"  # Use default mode unless overridden

# Per-workflow mode overrides
workflow_overrides:
  quick-flow:
    mode: "acceptEdits"  # Fast iteration for bug fixes
    reason: "Quick fixes need rapid file editing"

  standard-flow:
    mode: "default"  # Standard permissions for feature development
    reason: "Balanced security and productivity"

  enterprise-track:
    mode: "default"  # Highest security for enterprise
    reason: "Enterprise compliance requires approval workflows"
    additional_validations:
      - "Security architect review required"
      - "QA validation required"
      - "Compliance checks enforced"

# ==============================================================================
# Audit & Compliance
# ==============================================================================

audit:
  enabled: true
  log_location: ".claude/context/audit/permissions.log"
  log_denied_attempts: true
  log_approved_operations: true
  retention_days: 90

compliance:
  enforce_least_privilege: true
  require_approval_documentation: true
  periodic_review_required: true
  review_frequency_days: 30

# ==============================================================================
# Emergency Override
# ==============================================================================

emergency_override:
  enabled: false
  requires_admin_approval: true
  temporary_duration_minutes: 60
  auto_revert: true
  notification_required: true
  use_cases:
    - "Production incidents requiring immediate action"
    - "Emergency security patches"
    - "Critical bug fixes in deployment"
