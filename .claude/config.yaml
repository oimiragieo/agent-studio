# LLM-RULES Agent Configuration
# Defines agent routing, model assignments, and workflow selection
# UPDATED: Integrated MCP Tools (shadcn, Git, Docker, Memory, Sequential Thinking)
#
# Model names are set to actual Claude API model identifiers.
# If your Claude API uses different model names, update these accordingly.
# Current model names: claude-3-opus-20240229, claude-3-5-sonnet-20241022, claude-3-5-haiku-20241022

# Global Tool Registry (Active MCPs)
mcp_registry:
  active_tools:
    - name: 'shadcn'
      description: 'Component library management and lookup'
    - name: 'SequentialThinking'
      description: 'Deep reasoning and step-by-step logic chains'
    - name: 'Git'
      description: 'Version control, diffs, commits, and history'
    - name: 'GitHub Official'
      description: 'PRs, Issues, and Repository management'
    - name: 'Memory'
      description: 'Long-term context retention across sessions'
    - name: 'Filesystem'
      description: 'File manipulation'
    - name: 'Docker'
      description: 'Container management'
    - name: 'SQLite'
      description: 'Database interaction'
    - name: 'Markitdown'
      description: 'Documentation generation and formatting'
    - name: 'Paper Search'
      description: 'Academic and technical paper research'
    - name: 'Curl'
      description: 'Network requests and API testing'

# Enhanced Agent Routing Configuration
agent_routing_config:
  matrix_file: .claude/tools/agent-routing-matrix.json
  triggers_file: .claude/tools/cross-cutting-triggers.json
  default_task_type: IMPLEMENTATION
  max_chain_length: 5
  enable_cross_cutting: true
  enable_escalation: true
  routing_strategy: task_based_with_triggers

# Agent Routing Configuration
agent_routing:
  router:
    trigger_words: [] # Always triggered first for workflow selection
    complexity: low
    model: claude-3-5-haiku-20241022
    temperature: 0.1
    priority: highest
    context_strategy: minimal
    description: 'Lightweight intent classification and workflow routing agent'
    # Note: For Haiku-based router sessions with cost tracking and model escalation, see router_session configuration below

  planner:
    trigger_words:
      - 'plan'
      - 'create a plan'
      - 'roadmap'
      - 'strategy'
      - 'workflow'
      - 'planning'
      - 'comprehensive plan'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.5
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  analyst:
    trigger_words:
      - 'market research'
      - 'competitive analysis'
      - 'project brief'
      - 'requirements gathering'
      - 'feasibility'
      - 'stakeholder analysis'
      - 'brainstorming'
      - 'discovery'
      - 'brownfield'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.7
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  pm:
    trigger_words:
      - 'prd'
      - 'product requirements'
      - 'user stories'
      - 'epic'
      - 'backlog'
      - 'roadmap'
      - 'prioritization'
      - 'feature specification'
      - 'sprint planning'
      - 'story refinement'
      - 'product owner'
      - 'scrum'
      - 'agile'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.7
    context_files:
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  architect:
    trigger_words:
      - 'architecture'
      - 'system design'
      - 'technology stack'
      - 'api design'
      - 'infrastructure'
      - 'scalability'
      - 'security architecture'
      - 'integration'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.5
    extended_thinking: true
    context_files:
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  database-architect:
    trigger_words:
      - 'database'
      - 'schema'
      - 'data modeling'
      - 'query optimization'
      - 'migration'
      - 'SQL'
      - 'NoSQL'
      - 'PostgreSQL'
      - 'MongoDB'
      - 'Redis'
      - 'indexing'
      - 'sharding'
      - 'replication'
      - 'high availability'
      - 'backup'
      - 'data architecture'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.5
    extended_thinking: true
    context_files:
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  developer:
    trigger_words:
      - 'implement'
      - 'code'
      - 'development'
      - 'debug'
      - 'refactor'
      - 'feature'
      - 'bug fix'
      - 'write tests'
      - 'shadcn'
      - 'component'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.3
    context_files:
      - .claude/rules-master/TECH_STACK_NEXTJS.md
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  qa:
    trigger_words:
      - 'test'
      - 'quality'
      - 'testing'
      - 'test plan'
      - 'qa'
      - 'quality gate'
      - 'test coverage'
      - 'regression'
      - 'smoke test'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.4
    extended_thinking: true
    context_files:
      - .claude/rules-master/TOOL_CYPRESS_MASTER.md
      - .claude/rules-master/TOOL_PLAYWRIGHT_MASTER.md
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  ux-expert:
    trigger_words:
      - 'ux'
      - 'ui'
      - 'design'
      - 'wireframe'
      - 'prototype'
      - 'user experience'
      - 'interface'
      - 'accessibility'
      - 'shadcn'
      - 'tailwind'
      - 'css'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.7
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  orchestrator:
    trigger_words:
      - 'orchestrate'
      - 'coordinate'
      - 'multi-agent'
      - 'complex workflow'
      - 'end-to-end'
      - 'workflow'
      - 'project planning'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.6
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  model-orchestrator:
    trigger_words:
      - 'call gemini'
      - 'call opus'
      - 'call cursor'
      - 'use gemini'
      - 'use cursor'
      - 'multi-model'
      - 'model routing'
      - 'research with gemini'
      - 'plan with opus'
      - 'implement with cursor'
      - 'get second opinion'
      - 'synthesize models'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.4
    tools:
      - Read
      - Bash
      - Grep
      - Glob
      - Sequential Thinking
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  security-architect:
    trigger_words:
      - 'security'
      - 'authentication'
      - 'authorization'
      - 'compliance'
      - 'threat'
      - 'vulnerability'
      - 'encryption'
      - 'zero-trust'
      - 'blockchain'
      - 'smart contract'
      - 'solidity'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.4
    extended_thinking: true
    context_files:
      - .claude/rules-master/LANG_SOLIDITY.md
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  devops:
    trigger_words:
      - 'infrastructure'
      - 'deployment'
      - 'ci/cd'
      - 'kubernetes'
      - 'docker'
      - 'terraform'
      - 'monitoring'
      - 'observability'
      - 'slo'
      - 'sli'
      - 'sla'
      - 'reliability'
      - 'incident'
      - 'release'
      - 'versioning'
      - 'rollout'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.4
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  technical-writer:
    trigger_words:
      - 'documentation'
      - 'api docs'
      - 'user manual'
      - 'onboarding'
      - 'guide'
      - 'tutorial'
      - 'changelog'
      - 'release notes'
      - 'technical writing'
      - 'markdown'
    complexity: low
    model: claude-3-5-haiku-20241022
    temperature: 0.7
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  # New High-Impact Agents (v2.0)

  llm-architect:
    trigger_words:
      - 'ai system'
      - 'llm'
      - 'prompt engineering'
      - 'rag'
      - 'embeddings'
      - 'vector database'
      - 'model selection'
      - 'fine-tuning'
      - 'ai architecture'
      - 'chatbot'
      - 'conversational ai'
      - 'prompt template'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.6
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  code-reviewer:
    trigger_words:
      - 'code review'
      - 'review this'
      - 'review the code'
      - 'pr review'
      - 'pull request review'
      - 'check this code'
      - 'audit code'
      - 'git diff'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.3
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  code-simplifier:
    trigger_words:
      - 'simplify'
      - 'simplification'
      - 'too complex'
      - 'over-engineered'
      - 'make it simple'
      - 'readability'
      - 'cognitive load'
      - 'complexity score'
      - 'hard to understand'
      - 'junior developer'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.3
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  performance-engineer:
    trigger_words:
      - 'performance'
      - 'optimize'
      - 'profiling'
      - 'benchmark'
      - 'load testing'
      - 'latency'
      - 'throughput'
      - 'core web vitals'
      - 'slow'
      - 'memory leak'
      - 'bottleneck'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.4
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  api-designer:
    trigger_words:
      - 'api design'
      - 'rest api'
      - 'graphql'
      - 'grpc'
      - 'openapi'
      - 'swagger'
      - 'api contract'
      - 'endpoint design'
      - 'api versioning'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.5
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  legacy-modernizer:
    trigger_words:
      - 'legacy'
      - 'modernize'
      - 'migration'
      - 'strangler fig'
      - 'technical debt'
      - 'old codebase'
      - 'upgrade'
      - 'rewrite'
      - 'obsolete'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.5
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  accessibility-expert:
    trigger_words:
      - 'accessibility'
      - 'wcag'
      - 'a11y'
      - 'screen reader'
      - 'aria'
      - 'inclusive design'
      - 'keyboard navigation'
      - 'color contrast'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.4
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  compliance-auditor:
    trigger_words:
      - 'gdpr'
      - 'hipaa'
      - 'soc2'
      - 'pci'
      - 'regulatory'
      - 'compliance audit'
      - 'data protection'
      - 'privacy'
      - 'ccpa'
      - 'audit'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.3
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  incident-responder:
    trigger_words:
      - 'incident'
      - 'outage'
      - 'down'
      - 'production issue'
      - 'emergency'
      - 'post-mortem'
      - 'postmortem'
      - 'root cause'
      - 'crisis'
      - 'runbook'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.2
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  refactoring-specialist:
    trigger_words:
      - 'refactor'
      - 'code smell'
      - 'clean code'
      - 'extract method'
      - 'technical debt'
      - 'complexity'
      - 'maintainability'
      - 'solid principles'
      - 'design patterns'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.4
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  mobile-developer:
    trigger_words:
      - 'mobile'
      - 'ios'
      - 'android'
      - 'react native'
      - 'flutter'
      - 'swift'
      - 'kotlin'
      - 'app store'
      - 'mobile app'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.5
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  master-orchestrator:
    trigger_words: [] # Master orchestrator is the entry point for all requests
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.6
    extended_thinking: true
    priority: highest
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  cloud-integrator:
    trigger_words:
      - 'cloud integration'
      - 'gcp'
      - 'aws'
      - 'azure'
      - 'cloud service'
      - 'service account'
      - 'adc'
      - 'application default credentials'
      - 'iam'
      - 'cloud storage'
      - 'pub/sub'
      - 'cloud sql'
      - 'cloud run'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.3
    context_files:
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  impact-analyzer:
    trigger_words:
      - 'impact analysis'
      - 'breaking change'
      - 'dependency analysis'
      - 'blast radius'
      - 'risk assessment'
      - 'change impact'
      - 'migration risk'
    complexity: high
    model: claude-3-opus-20240229
    temperature: 0.3
    extended_thinking: true
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

  react-component-developer:
    trigger_words:
      - 'react component'
      - 'component development'
      - 'ui component'
      - 'react hooks'
      - 'component library'
    complexity: medium
    model: claude-3-5-sonnet-20241022
    temperature: 0.3
    context_files:
      - .claude/rules-master/TECH_STACK_NEXTJS.md
      - .claude/rules-master/PROTOCOL_ENGINEERING.md
    context_strategy: 'lazy_load' # Load context files only when agent activates, cache loaded contexts, clear after completion

# Router Session Configuration (Haiku-based routing with cost tracking and model escalation)
router_session:
  # Session enablement - Toggle Haiku-based routing sessions
  enabled: true

  # Model configuration for router sessions
  model: claude-3-5-haiku-20241022 # Primary model for lightweight routing and classification
  temperature: 0.1 # Low temperature for deterministic routing decisions
  max_tokens: 2000 # Sufficient for classification and routing logic

  # Model escalation configuration
  # Automatically escalates to more capable models when complexity or confidence thresholds are exceeded
  escalation:
    complexity_threshold: 0.7 # Complexity score above this triggers escalation (0.0-1.0)
    confidence_threshold: 0.85 # Confidence score below this triggers escalation (0.0-1.0)
    orchestrator_model: claude-sonnet-4-20250514 # Model for standard orchestration tasks
    complex_model: claude-opus-4-20241113 # Model for high-complexity tasks requiring extended thinking

  # Cost tracking configuration
  # Monitors API usage and costs for router sessions to optimize spend
  cost_tracking:
    enabled: true # Enable cost tracking and logging
    log_file: .claude/context/logs/router-costs.log # Cost log location
    aggregation_interval_ms: 60000 # Aggregate costs every 60 seconds (1 minute)
    alert_threshold_usd: 10.0 # Alert when cumulative cost exceeds this threshold

  # Routing behavior configuration
  # Controls how the router makes decisions and handles edge cases
  routing:
    auto_route_to_orchestrator: true # Automatically route complex requests to orchestrator
    fallback_to_sonnet: true # Fallback to Sonnet if Haiku fails or times out
    cache_routing_decisions: true # Cache routing decisions to avoid duplicate classifications
    cache_ttl_ms: 300000 # Cache TTL: 5 minutes (300000ms)

  # Performance configuration
  # Tuning parameters for router session responsiveness and reliability
  performance:
    max_classification_time_ms: 100 # Maximum time for classification decision (100ms)
    timeout_ms: 30000 # Overall session timeout: 30 seconds
    retry_attempts: 2 # Number of retry attempts on failure

# Workflow Selection Configuration
workflow_selection:
  quick_flow:
    priority: 1
    keywords:
      - 'bug fix'
      - 'hotfix'
      - 'quick fix'
      - 'small feature'
      - 'documentation'
      - 'refactor'
      - 'minor change'
    complexity: low
    workflow_file: .claude/workflows/quick-flow.yaml
    agents_sequence:
      - planner
      - developer
      - qa

  fullstack:
    priority: 2
    keywords:
      - 'new project'
      - 'greenfield'
      - 'from scratch'
      - 'full stack'
      - 'fullstack'
      - 'enterprise'
      - 'production'
    complexity: medium
    workflow_file: .claude/workflows/greenfield-fullstack.yaml
    agents_sequence:
      - planner
      - analyst
      - pm
      - ux-expert
      - architect
      - qa
      - developer
      - qa

  code_quality:
    priority: 3
    keywords:
      - 'code quality'
      - 'code review'
      - 'refactor'
      - 'tech debt'
      - 'code smell'
      - 'clean up'
      - 'simplify'
      - 'simplification'
      - 'too complex'
      - 'over-engineered'
    complexity: medium
    workflow_file: .claude/workflows/code-quality-flow.yaml
    agents_sequence:
      - planner
      - developer
      - code-simplifier
      - qa

  browser_testing:
    priority: 5
    keywords:
      - 'browser test'
      - 'chrome devtools'
      - 'test all UI features'
      - 'browser automation'
      - 'test page'
      - 'find bugs browser'
      - 'test UI and optimize'
      - 'browser performance'
    complexity: high
    workflow_file: .claude/workflows/browser-testing-flow.yaml
    agents_sequence:
      - planner
      - developer
      - qa
      - performance-engineer
      - ux-expert

  performance:
    priority: 3
    keywords:
      - 'performance'
      - 'optimize'
      - 'profiling'
      - 'benchmark'
      - 'load test'
      - 'slow'
      - 'latency'
    complexity: medium
    workflow_file: .claude/workflows/performance-flow.yaml
    agents_sequence:
      - planner
      - performance-engineer
      - architect
      - developer
      - qa

  ai_system:
    priority: 3
    keywords:
      - 'ai system'
      - 'llm'
      - 'rag'
      - 'embeddings'
      - 'chatbot'
      - 'ai feature'
      - 'machine learning'
      - 'vector database'
    complexity: high
    workflow_file: .claude/workflows/ai-system-flow.yaml
    agents_sequence:
      - planner
      - model-orchestrator
      - llm-architect
      - api-designer
      - developer
      - qa

  mobile:
    priority: 3
    keywords:
      - 'mobile app'
      - 'ios'
      - 'android'
      - 'react native'
      - 'flutter'
      - 'native app'
      - 'app store'
    complexity: medium
    workflow_file: .claude/workflows/mobile-flow.yaml
    agents_sequence:
      - planner
      - mobile-developer
      - ux-expert
      - developer
      - qa

  ui_perfection:
    priority: 2
    keywords:
      - 'ui perfection'
      - 'visual perfection'
      - 'ui polish'
      - 'ux optimization'
      - 'glassmorphism'
      - 'ui audit'
      - 'visual quality'
      - 'ui refinement'
    complexity: high
    workflow_file: .claude/workflows/ui-perfection-loop.yaml
    agents_sequence:
      - planner
      - ux-expert
      - accessibility-expert
      - model-orchestrator
      - developer
      - mobile-developer
      - qa

  incident:
    priority: 0 # Highest priority for critical incidents
    keywords:
      - 'incident'
      - 'outage'
      - 'production issue'
      - 'post-mortem'
      - 'crisis'
      - 'downtime'
      - 'emergency'
    complexity: high
    workflow_file: .claude/workflows/incident-flow.yaml
    agents_sequence:
      - planner
      - incident-responder
      - devops
      - security-architect
      - qa

# Intelligent Routing Configuration
intelligent_routing:
  enabled: true
  orchestrator_agent: orchestrator
  auto_select_workflow: true
  default_workflow: fullstack

# Model Configuration by Complexity
model_config:
  high_complexity:
    model: claude-3-opus-20240229
    temperature: 0.4
    max_tokens: 8192
    use_extended_thinking: true

  medium_complexity:
    model: claude-3-5-sonnet-20241022
    temperature: 0.7
    max_tokens: 8192
    use_extended_thinking: false

  low_complexity:
    model: claude-3-5-haiku-20241022
    temperature: 0.5
    max_tokens: 4096
    use_extended_thinking: false

# Tool Restrictions by Agent
# UPDATED: Mapping new MCP tools to specific agents
tool_restrictions:
  planner:
    allowed_tools:
      - Sequential Thinking
      - Exa (web_search_exa, get_code_context_exa)
      - Ref (ref_search_documentation, ref_read_url)
      - Graph Orchestrator
      - Read
      - Search
      - Grep
      - Glob
      - Write
      - Task
    restricted_tools:
      - Edit (code)
      - Bash (dangerous commands)

  orchestrator:
    allowed_tools:
      - Task
      - Read
      - Search
      - Grep
    restricted_tools:
      - Edit (code)
      - Bash
      - All MCP tools (delegate to subagents)

  analyst:
    allowed_tools:
      - Read
      - Search
      - Paper Search
      - Fetch
      - Sequential Thinking
      - Grep
      - Glob
    restricted_tools:
      - Edit
      - Bash

  architect:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Glob
      - Edit
      - GitHub Official
      - Paper Search
    restricted_tools:
      - Bash
      - Docker

  developer:
    allowed_tools:
      - shadcn
      - Git
      - GitHub Official
      - Markitdown
      - Read
      - Edit
      - Bash
      - Grep
      - Glob
      - Filesystem
      - SQLite
      - Exa (web_search_exa, get_code_context_exa)
      - WebFetch
      - Ref (ref_search_documentation, ref_read_url)
    restricted_tools:
      - Bash (dangerous: rm -rf, sudo, etc.)

  code-reviewer:
    allowed_tools:
      - Git
      - GitHub Official
      - Sequential Thinking
      - Read
      - Grep
    restricted_tools:
      - Edit (Direct editing discouraged)

  code-simplifier:
    allowed_tools:
      - Read
      - Search
      - Grep
      - Glob
      - Edit
      - Git
    restricted_tools:
      - Bash (dangerous commands)

  qa:
    allowed_tools:
      - Curl
      - Docker
      - SQLite
      - Read
      - Search
      - Bash
      - Grep
      - Glob
    restricted_tools:
      - Edit (code)

  devops:
    allowed_tools:
      - Docker
      - Curl
      - Git
      - GitHub Official
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
    restricted_tools:
      - Bash (dangerous commands)

  ux-expert:
    allowed_tools:
      - shadcn
      - Markitdown
      - Read
      - Search
      - Edit (CSS/Tailwind only)
    restricted_tools:
      - Bash
      - Docker

  technical-writer:
    allowed_tools:
      - Markitdown
      - Git
      - GitHub Official
      - Read
      - Search
      - Edit
      - Grep
      - Glob
    restricted_tools:
      - Bash
      - Docker

  # Additional agents from plan
  pm:
    allowed_tools:
      - Read
      - Search
      - Grep
      - Glob
      - Write
      - Memory
    restricted_tools:
      - Edit (code)
      - Bash

  llm-architect:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Exa (get_code_context_exa)
      - Ref (ref_search_documentation)
      - Paper Search
    restricted_tools:
      - Edit (code)
      - Bash

  database-architect:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - SQLite
      - Edit (schema docs only)
    restricted_tools:
      - Edit (code)
      - Bash

  api-designer:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Edit (API docs only)
      - GitHub Official
    restricted_tools:
      - Edit (code)
      - Bash

  mobile-developer:
    allowed_tools:
      - Git
      - GitHub Official
      - Read
      - Edit
      - Bash
      - Grep
      - Glob
      - Filesystem
    restricted_tools:
      - Bash (dangerous commands)

  security-architect:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Paper Search
      - Exa (web_search_exa)
    restricted_tools:
      - Edit (code)
      - Bash

  compliance-auditor:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Paper Search
    restricted_tools:
      - Edit (code)
      - Bash

  performance-engineer:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Bash (profiling tools)
      - Curl
      - Docker
    restricted_tools:
      - Edit (code)

  accessibility-expert:
    allowed_tools:
      - Read
      - Search
      - Grep
      - Edit (accessibility fixes only)
      - Exa (web_search_exa for WCAG)
    restricted_tools:
      - Bash
      - Docker

  incident-responder:
    allowed_tools:
      - Docker
      - Curl
      - Git
      - Read
      - Search
      - Bash
      - Grep
      - SQLite
    restricted_tools:
      - Edit (code - emergency fixes only)

  refactoring-specialist:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Edit
      - Git
      - Ref (ref_search_documentation)
    restricted_tools:
      - Bash (dangerous commands)

  legacy-modernizer:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Edit
      - Git
      - Exa (get_code_context_exa)
    restricted_tools:
      - Bash (dangerous commands)

  model-orchestrator:
    allowed_tools:
      - Read
      - Bash
      - Grep
      - Glob
      - Sequential Thinking
    restricted_tools:
      - Edit (code)

  gcp-cloud-agent:
    allowed_tools:
      - gcloud MCP (run_gcloud_command, observability tools)
      - Cloud Run MCP (deploy, manage services)
      - Read
      - Search
      - Grep
      - Bash (gcloud CLI only)
      - Sequential Thinking
    restricted_tools:
      - Edit (code)
      - Bash (dangerous commands)

  ai-council:
    allowed_tools:
      - Headless AI CLI (llm-council integration)
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Memory
    restricted_tools:
      - Edit (code)
      - Bash (except headless-ai-cli)

  master-orchestrator:
    allowed_tools:
      - Task
      - Read
      - Search
      - Grep
    restricted_tools:
      - Edit (code)
      - Write (code)
      - Bash
      - All MCP tools (delegate to subagents)

  cloud-integrator:
    allowed_tools:
      - Read
      - Write
      - Edit
      - Bash (cloud CLI only)
      - gcloud MCP
      - Cloud Run MCP
      - Git
    restricted_tools:
      - Bash (dangerous commands)

  impact-analyzer:
    allowed_tools:
      - Sequential Thinking
      - Read
      - Search
      - Grep
      - Glob
      - Git
      - GitHub Official
    restricted_tools:
      - Edit (code)
      - Write (code)
      - Bash

  react-component-developer:
    allowed_tools:
      - shadcn
      - Read
      - Edit
      - Bash
      - Grep
      - Glob
      - Git
      - Filesystem
    restricted_tools:
      - Bash (dangerous commands)

# Session Management
session:
  context_file: .claude/context/session.json
  artifacts_dir: .claude/context/artifacts
  reasoning_dir: .claude/context/history/reasoning
  gates_dir: .claude/context/history/gates
  auto_save: true
  max_context_length: 200000

# Memory Tool Configuration (Dual Persistence with CLAUDE.md)
memory_tool:
  enabled: true
  tool_id: 'memory_20250818'
  storage_path: '.claude/orchestrators/{session-id}/memory'
  sync_with_claude_md: true
  # All agents use memory tool for redundancy
  agents_with_memory:
    - planner
    - orchestrator
    - master-orchestrator
    - analyst
    - pm
    - architect
    - database-architect
    - developer
    - qa
    - ux-expert
    - security-architect
    - devops
    - technical-writer
    - code-reviewer
    - code-simplifier
    - refactoring-specialist
    - performance-engineer
    - llm-architect
    - api-designer
    - legacy-modernizer
    - mobile-developer
    - accessibility-expert
    - compliance-auditor
    - incident-responder
    - model-orchestrator
    - cloud-integrator
    - impact-analyzer
    - react-component-developer
  security:
    validate_paths: true
    allowed_extensions: ['.md', '.json', '.yaml']
    max_file_size: 100000 # 100KB max per memory file

# Context Editing Configuration (Automatic Context Compaction)
context_editing:
  enabled: true
  clear_tool_uses:
    enabled: true
    tool_id: 'clear_tool_uses_20250919'
    trigger_tokens: 40000
    retention_policy: 'keep_recent'
    keep_recent_count: 10 # Keep last 10 tool results
  clear_thinking:
    enabled: true
    tool_id: 'clear_thinking_20251015'
    trigger_tokens: 50000
    retention_policy: 'keep_recent'
    keep_recent_count: 5 # Keep last 5 thinking blocks
  # Applied to all agents for long-running sessions
  apply_to_all_agents: true

# Memory Management Configuration
memory:
  max_heap_size_mb: 4096
  cache_limits:
    git_cache_max_entries: 100
    artifact_cache_max_entries: 500
    skill_cache_max_entries: 200
    artifact_cache_max_memory_mb: 50
  cleanup:
    enabled: true
    interval_seconds: 600 # 10 minutes
    cleanup_after_step: true
  monitoring:
    enabled: true
    warn_threshold_mb: 3500
    check_interval_seconds: 60
  file_handling:
    streaming_threshold_mb: 1
    max_artifact_size_mb: 10
    max_json_file_size_mb: 100
  gc:
    expose_gc: true # Requires --expose-gc flag
    gc_on_warning: true

# Token Monitoring (Orchestrator Handoff)
token_monitoring:
  enabled: true
  monitor_script: '.claude/tools/token-monitor.mjs'
  threshold: 0.90 # 90% of 200k tokens = 180k tokens
  context_limit: 200000 # 200k tokens for Claude 4.5 models
  check_interval: 10000 # Check every 10k tokens
  # Only applies to orchestrator for handoff
  apply_to_agents:
    - orchestrator

# Workflow Thresholds Configuration
workflow_thresholds:
  feature_distillation_file_size: 15000 # bytes - threshold for triggering feature distillation
  phase_size_max_lines: 3000 # maximum lines per phase before splitting
  phase_size_optimal_lines: 2000 # optimal lines per phase
  checkpoint_interval_seconds: 300 # checkpoint creation interval (5 minutes)
  conflict_resolution_timeout_seconds: 30 # timeout for conflict resolution
  validation_consensus_threshold_analyst: 0.8 # analyst validation consensus threshold
  validation_consensus_threshold_architect: 0.7 # architect validation consensus threshold
  max_retries: 3 # maximum retry attempts for failed steps

# Quality Gates Configuration
quality_gates:
  enabled: true
  validation_schemas_dir: .claude/schemas
  gate_script: node .claude/tools/gates/gate.mjs

# Template Configuration
templates:
  base_dir: .claude/templates
  project_brief: project-brief.md
  prd: prd.md
  architecture: architecture.md
  implementation_plan: implementation-plan.md
  test_plan: test-plan.md
  ui_spec: ui-spec.md

# MCP Server Configuration
mcp_servers:
  gcloud-mcp:
    command: npx
    args:
      - '@google-cloud/gcloud-mcp'
    env:
      GOOGLE_APPLICATION_CREDENTIALS: ${GCP_CREDENTIALS_PATH}

  cloud-run-mcp:
    command: npx
    args:
      - '@google-cloud/cloud-run-mcp'
    env:
      GOOGLE_APPLICATION_CREDENTIALS: ${GCP_CREDENTIALS_PATH}
      GCP_PROJECT_ID: ${GCP_PROJECT_ID}

  headless-ai-cli:
    command: node
    args:
      - ${HEADLESS_AI_CLI_PATH}/bin/cli.js
    env:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}

# Codex Skills Configuration (Cursor Recommendations #1-4, #10-14)
# Provider priority for multi-AI code review and response-rater skills
codex_skills:
  # Provider Priority Configuration (Cursor Recommendation #4)
  # Used by multi-ai-code-review and response-rater skills for fallback logic
  provider_priority:
    primary: claude # Primary provider (tried first)
    secondary:
      - gemini # Fallback providers (tried if primary fails)
      - codex
    fallback_threshold: 1 # Minimum providers required for success
  # CLI Validation Configuration (Cursor Recommendation #1)
  cli_validation:
    enabled: true # Re-validate CLI availability before execution
    timeout_ms: 5000 # Timeout for CLI version check
    cache_duration_ms: 60000 # Cache CLI availability for 60 seconds
  # Parallel Execution Configuration (Cursor Recommendation #2)
  parallel_execution:
    enabled: true # Execute providers in parallel by default
    max_concurrent: 5 # Maximum concurrent provider calls
  # Schema Validation Configuration (Cursor Recommendation #3)
  validation:
    default_mode: warning # Default validation mode (warning | blocking)
    ci_mode: blocking # Validation mode in CI (always blocking)
  retry_on_fallback: true
  # Partial Failure Configuration (Cursor Recommendation #11)
  # Allow multi-provider operations to succeed with partial results
  partial_failure:
    enabled: true # Enable partial failure recovery
    min_success_count: 2 # Minimum providers that must succeed
    min_success_rate: 0.67 # 67% of providers must succeed (2 of 3)
  # Circuit Breaker Configuration (Cursor Recommendation #14)
  # Prevents repeated calls to failing providers
  circuit_breaker:
    enabled: true # Enable circuit breaker pattern
    failure_threshold: 3 # Number of failures before opening circuit
    reset_timeout_ms: 60000 # Time before attempting to close circuit (1 minute)
    half_open_max_attempts: 2 # Max attempts in half-open state
    persistent: true # Persist circuit breaker state to disk

# Workflow Timeout Configuration (Cursor Recommendation #13)
# Configurable timeouts for long-running workflow steps
workflow:
  timeouts:
    default: 300000 # 5 minutes default
    by_agent:
      analyst: 600000 # 10 minutes for analysis
      architect: 900000 # 15 minutes for architecture
      developer: 1200000 # 20 minutes for development
      qa: 600000 # 10 minutes for testing
      llm-architect: 900000 # 15 minutes for LLM architecture
      security-architect: 600000 # 10 minutes for security review
      code-reviewer: 480000 # 8 minutes for code review
      planner: 600000 # 10 minutes for planning
  # Retry Configuration (Cursor Recommendation #12)
  # Validation error recovery with feedback
  validation_retry:
    enabled: true # Enable validation retry with feedback
    max_retries: 2 # Maximum retry attempts
    include_feedback: true # Include validation errors in retry context
    backoff_base_ms: 1000 # Base delay for exponential backoff
    backoff_max_ms: 5000 # Maximum delay for backoff

# Multi-AI Rating Configuration (Plan Rating Fallback)
multi_ai_rating:
  enabled: true
  fallback_to_single_model: true
  required_providers:
    - claude # primary
  optional_providers:
    - gemini
    - copilot
  # Workflows requiring multi-AI rating (minimum 2 providers)
  workflows_requiring_multi_ai:
    - security-review.yaml
    - legacy-modernization.yaml
    - ai-system-flow.yaml
    - compliance-flow.yaml
    - auth-flow.yaml
    - data-protection-flow.yaml
  # Fallback behavior when multi-AI unavailable
  fallback_behavior:
    use_single_model: true
    log_warning: true
    required_minimum_providers: 1 # Allow fallback to single model
    preferred_providers: ['claude', 'gemini']
  # Integration with plan-review-matrix.json
  rating_mode_selection:
    critical: 'multi' # task_types.critical requires multi-AI
    enterprise: 'multi' # task_types.enterprise requires multi-AI
    standard: 'single' # task_types.standard uses single model
  # CI/CD integration
  ci_mode:
    strict_json_only: true
    fail_on_provider_unavailable: false # Allow fallback in CI
    timeout_ms: 240000
