{
  "$schema": "../../schemas/a2a-test-scenario.schema.json",
  "scenario_id": "a2a-template-004",
  "name": "Allow valid complete template",
  "description": "Verify that valid complete template is allowed",
  "category": "template-enforcement",
  "priority": "P1",
  "tags": ["hook", "allow", "template", "valid"],

  "preconditions": {
    "fixtures": ["sample-task-inputs/valid-task-template.json"],
    "state": {},
    "environment": {}
  },

  "steps": [
    {
      "step_id": "invoke-with-valid-template",
      "action": "invoke_pretooluse_hook",
      "input": {
        "hook": "agent-task-template-enforcer.mjs",
        "tool_name": "Task",
        "tool_input": {
          "task_id": "test-valid-001",
          "objective": "Create a utility function for string formatting",
          "reasoning_style": "step-by-step",
          "mode": "execute",
          "uncertainty_permission": true,
          "thinking_budget": 1000,
          "context": {
            "problem": "Need string formatting utility",
            "why_now": "Required for feature development",
            "related_files": []
          },
          "deliverables": [
            {
              "type": "file",
              "path": ".claude/context/tmp/test-valid/formatter.mjs",
              "description": "String formatting utility",
              "format": "javascript",
              "validation": "Valid JavaScript with exports"
            }
          ],
          "constraints": {
            "max_time_minutes": 10,
            "max_file_reads": 5,
            "must_validate": true
          },
          "success_criteria": ["Function implemented", "No syntax errors", "Tests pass"],
          "examples": [
            {
              "input": "formatString('hello {name}', {name: 'world'})",
              "output": "'hello world'",
              "explanation": "Demonstrates template string substitution"
            }
          ],
          "output_format": {
            "structure": "xml-tagged",
            "sections": [
              {
                "tag": "thinking",
                "description": "Reasoning process",
                "required": false
              },
              {
                "tag": "answer",
                "description": "Final implementation",
                "required": true
              }
            ]
          },
          "verification": {
            "verification_type": "static",
            "required_tests": [
              {
                "test_name": "syntax-check",
                "command_or_action": "node --check formatter.mjs",
                "expected_outcome": "No errors"
              }
            ],
            "passing_criteria": {
              "errors_allowed": 0,
              "tests_passed_minimum": "100%"
            },
            "evidence_required": true
          },
          "assigned_agent": "developer"
        }
      },
      "expected": {
        "decision": "approve",
        "has_optimizations": true
      },
      "timeout_ms": 5000
    }
  ],

  "assertions": [
    {
      "type": "hook_decision",
      "target": "steps.invoke-with-valid-template.result.decision",
      "operator": "equals",
      "expected": "approve"
    },
    {
      "type": "no_missing_fields",
      "target": "steps.invoke-with-valid-template.result.missing_fields",
      "operator": "equals",
      "expected": []
    },
    {
      "type": "optimizations_detected",
      "target": "steps.invoke-with-valid-template.result.has_optimizations",
      "operator": "equals",
      "expected": true
    }
  ],

  "cleanup": {
    "remove_files": [],
    "restore_state": true
  },

  "metadata": {
    "created_at": "2026-01-16T00:00:00Z",
    "author": "developer",
    "related_hooks": ["agent-task-template-enforcer.mjs"]
  }
}
