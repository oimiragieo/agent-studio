# CUJ-054: Cross-Platform Publishing Sync Test

## User Goal

Validate that publishing metadata syncs correctly across Claude, Cursor, and other platforms using context-bridge skill.

## Trigger

- "Test cross-platform publishing sync"
- "Validate publishing metadata sync"
- "Check platform publishing consistency"

## Workflow

**Execution Mode**: `workflow`

### Step 0: Planning Phase

- Planner creates cross-platform sync test plan
- Identifies test scenarios for publishing metadata sync
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Publish on Claude Platform

- Create artifact on Claude platform
- Publish artifact using `artifact-publisher` skill
- Verify publishing metadata in Claude registry:
  - `published: true`
  - `published_at` timestamp
  - `publish_status: 'success'`
  - `publish_targets: ['project_feed']`

### Step 2: Sync to Cursor Platform

- Use `context-bridge` skill to sync publishing metadata
- Validate metadata against `.claude/schemas/artifact-metadata.schema.json`
- Sync to Cursor platform: `.cursor/plans/artifacts/`
- Verify metadata structure consistent

### Step 3: Verify Sync Completeness

- Check all publishing fields synced:
  - `published`, `published_at`, `publish_status`
  - `publish_targets`, `publish_attempts`
  - `publish_error` (if applicable)
- Verify `last_synced` timestamp updated
- Check platform field set correctly

### Step 4: Test Conflict Resolution

- Create conflicting publishing status (different `published_at` timestamps)
- Use `context-bridge` to resolve conflict
- Verify most recent `published_at` timestamp preferred
- Check conflict resolution logged in reasoning file

### Step 5: Test Bidirectional Sync

- Publish artifact on Cursor platform
- Sync back to Claude platform
- Verify metadata synced correctly in both directions
- Check `last_synced` updated on both platforms

### Step 6: Test Metadata Validation

- Attempt to sync invalid metadata
- Verify schema validation catches errors
- Check sync fails gracefully with error message
- Verify invalid metadata not written to target platform

## Agents Used

- Planner (sync test planning)
- QA (sync validation)

## Skills Used

- `artifact-publisher` - Publishing artifacts
- `context-bridge` - Cross-platform metadata sync
- `plan-generator` - Creating sync test plan
- `response-rater` - Plan quality validation

## Capabilities/Tools Used

- Metadata schema validation: `.claude/schemas/artifact-metadata.schema.json`
- Cross-platform artifact sync
- Conflict resolution logic

## Expected Outputs

- Sync test plan: `plan-{{workflow_id}}.json`
- Claude registry: `.claude/context/runs/<run_id>/artifact-registry.json`
- Cursor artifacts: `.cursor/plans/artifacts/*.json`
- Sync validation report: `cross-platform-sync-report.json`
- Conflict resolution logs

## Success Criteria

| Criterion                        | Measurement                     | Target                                                                               |
| -------------------------------- | ------------------------------- | ------------------------------------------------------------------------------------ |
| Plan rating                      | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`)    |
| Rating recorded                  | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`          |
| Metadata synced to Cursor        | Cursor artifact validation      | Synced to `.cursor/plans/artifacts/<artifact-id>.json`                               |
| Metadata structure consistent    | Schema validation               | Validated by `.claude/schemas/artifact-metadata.schema.json`                         |
| Last synced timestamp updated    | Timestamp comparison            | Updated on sync operation                                                            |
| Conflict resolution works        | Resolution log validation       | Most recent `published_at` preferred                                                 |
| Bidirectional sync works         | Sync report validation          | Claude → Cursor and Cursor → Claude                                                  |
| Schema validation catches errors | Error log validation            | Invalid metadata rejected                                                            |
| All publishing fields synced     | Field comparison                | `published`, `published_at`, `publish_status`, `publish_targets`, `publish_attempts` |

## Example Prompts

```
"Test cross-platform publishing sync"
"Validate publishing metadata sync between Claude and Cursor"
"Check if publishing status syncs correctly"
```

## Related Documentation

- [Context Bridge Skill](../../skills/context-bridge/SKILL.md)
- [Artifact Publisher Skill](../../skills/artifact-publisher/SKILL.md)
- [Artifact Metadata Schema](../../schemas/artifact-metadata.schema.json)
