# CUJ-024: Incident Response

## User Goal

Respond to production incidents effectively.

## Trigger

- `/incident`
- "Production incident"
- "System outage"

## Workflow

**Execution Mode**: `incident-flow.yaml`

### Step 0: Planning Phase

- Planner creates incident response plan
- Analyzes incident scope and urgency
- Coordinates with Incident Responder for response strategy
- Defines response priorities and escalation path
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`
- Note: For urgent incidents, this step may be abbreviated or skipped

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Incident Analysis

- Incident Responder analyzes crisis
- Identifies root cause
- Assesses impact

### Step 2: Resolution

- DevOps implements fixes
- Applies hotfixes
- Restores service

### Step 3: Security Review

- Security Architect reviews
- Checks security implications
- Validates fixes

### Step 4: Validation

- QA validates resolution
- Confirms service restored
- Documents incident

## Agents Used

- Incident Responder → DevOps → Security Architect → QA

## Skills Used

- `recovery` - Incident recovery protocol
- `response-rater` - Plan quality validation

## Capabilities/Tools Used

- Incident management tools (platform-specific incident tracking systems)

## Expected Outputs

- Incident report
- Root cause analysis
- Post-mortem document
- Remediation plan

## Success Criteria

| Criterion                   | Measurement                     | Target                                                                            |
| --------------------------- | ------------------------------- | --------------------------------------------------------------------------------- |
| Incident resolved           | Service restoration confirmed   | Incident resolution validated                                                     |
| Plan rating                 | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded             | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`       |
| Root cause identified       | Root cause analysis complete    | Root cause documented in incident report                                          |
| Post-mortem created         | Post-mortem document exists     | Post-mortem analysis completed                                                    |
| Prevention measures planned | Remediation plan exists         | Prevention measures documented                                                    |

## Example Prompts

```
/incident
"Production database outage"
"Security incident response"
```

## Error Recovery

### Retry Strategy

- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits

### Rollback Procedures

1. **Partial Completion**: Save checkpoint to `.claude/context/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context (critical for incident response)

### Fallback Options

- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - Incident-Responder → DevOps (resolution fallback)
  - DevOps → Developer (implementation fallback)
  - Security-Architect → Incident-Responder (analysis fallback)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Apply partial fixes to restore service (priority: service restoration over root cause)

### Recovery Artifacts

- Error log: `.claude/context/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runs/{{run_id}}/checkpoint.json`
- Incident timeline: `.claude/context/runs/{{run_id}}/incident-timeline.json`
