# CUJ-014: Rule Compliance Audit

## User Goal
Validate code against project rules and standards.

## Trigger
- `/audit src/components/`
- `/audit --format json`
- "Audit this code"

## Workflow

**Execution Mode**: `skill-only`

### Step 0: Planning Phase
- Planner creates audit plan
- Analyzes audit scope and requirements
- Determines rule sets to apply
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 1: Rule Loading
- rule-auditor loads active rules
- Queries rule index
- Identifies applicable rules

### Step 2: Code Analysis
- Analyzes target files
- Checks against rules
- Identifies violations

### Step 3: Report Generation
- Generates audit report
- Lists violations with locations
- Provides fix instructions

### Step 4: Auto-Fix (Optional)
- Suggests auto-fixes
- Applies fixes where safe
- Reports manual fixes needed

## Agents Used
- None (skill-based)

## Skills Used
- `rule-auditor` - Code validation

## Expected Outputs
- Audit report
- Violation list
- Fix suggestions
- Compliance score

## Success Criteria
- [ ] Audit plan created (artifact: `plan-{{workflow_id}}.json`, validated by gate file)
- [ ] Rules loaded from index (artifact: `audit-report-{{workflow_id}}.json`, rules_applied array populated)
- [ ] Files scanned (artifact: `audit-report-{{workflow_id}}.json`, files_scanned array populated)
- [ ] Violations identified with locations (artifact: `audit-report-{{workflow_id}}.json`, violations array with file, line, column)
- [ ] Severity assigned to violations (artifact: `audit-report-{{workflow_id}}.json`, each violation has severity: error|warning|info)
- [ ] Fix instructions provided (artifact: `audit-report-{{workflow_id}}.json`, each violation has fix_instruction)
- [ ] Compliance score calculated (artifact: `audit-report-{{workflow_id}}.json`, compliance_score: 0-100)
- [ ] Report validated (schema: `.claude/schemas/audit-report.schema.json`)

## Example Prompts
```
/audit src/components/
"Audit the authentication module"
"Check code compliance"
```

## Related Documentation
- [rule-auditor Skill](../../skills/rule-auditor/SKILL.md)
- [Rule Index System](../../CLAUDE.md#rule-index-system)
