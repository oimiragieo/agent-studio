# CUJ-015: Test Generation

## User Goal

Generate comprehensive test suite for code.

## Trigger

- "Generate tests for UserProfile"
- "Create tests for [component]"
- "Add test coverage"

## Workflow

**Execution Mode**: workflow
**Workflow File**: `.claude/workflows/code-quality.yaml`

### Step 0: Planning Phase

- Planner creates test generation plan
- Analyzes code scope and test requirements
- Determines test types needed (unit, integration, E2E)
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Code Analysis

- QA analyzes target code
- Identifies test cases
- Understands dependencies

### Step 2: Test Generation

- test-generator creates tests
- Follows project patterns
- Includes edge cases

### Step 3: Test Review

- QA reviews generated tests
- Validates coverage
- Ensures quality

## Agents Used

- QA

## Skills Used

- `test-generator` - Test generation with coverage analysis
- `test-generator` - Test creation
- `response-rater` - Plan quality validation

## Expected Outputs

- Unit tests
- Integration tests
- E2E tests (if applicable)
- Test coverage report

## Success Criteria

| Criterion             | Measurement                     | Target                                                                            |
| --------------------- | ------------------------------- | --------------------------------------------------------------------------------- |
| Tests generated       | Artifact exists                 | Test files listed in `test-files.json`                                            |
| Plan rating           | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded       | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`       |
| Coverage adequate     | Coverage report validated       | `coverage-report.json` validated by gate file                                     |
| Tests follow patterns | rule-auditor validation         | Tests validated by rule-auditor                                                   |
| Edge cases covered    | Test scenarios documented       | Edge cases in `test-scenarios.json`                                               |

## Example Prompts

```
"Generate tests for UserProfile component"
"Create API tests for /api/users"
"Add E2E tests for login flow"
```
