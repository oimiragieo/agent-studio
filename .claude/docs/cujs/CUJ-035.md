# CUJ-035: Planner-First Workflow Validation

## User Goal

Validate the complete planner-first workflow process end-to-end, ensuring plans are created, artifacts flow correctly, and execution follows the plan.

## Trigger

- "Test planner-first workflow"
- "Validate plan execution"
- "Verify artifact flow"

## Workflow

**Execution Mode**: workflow
**Workflow File**: `.claude/workflows/performance.yaml`

### Step 0: Planning Phase

- Planner agent activated
- Analyzes user requirements comprehensively
- Coordinates with relevant specialists (Analyst, PM, Architect)
- Creates structured plan with steps, dependencies, risks
- Validates plan completeness and feasibility
- Generates plan artifacts:
  - `plan-{{workflow_id}}.md` - Plan markdown document
  - `plan-{{workflow_id}}.json` - Structured plan data

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Plan Execution Tracking

- Orchestrator reads plan document
- Verifies plan structure and completeness
- Tracks plan execution progress
- Monitors artifact creation

### Step 2: Artifact Flow Validation

- Verifies artifacts are created as specified in plan
- Validates artifact dependencies are satisfied
- Checks artifact structure matches plan expectations
- Confirms artifacts are passed correctly between steps

### Step 3: Execution Validation

- Verifies each step executes according to plan
- Validates agent assignments match plan
- Confirms dependencies are respected
- Checks success criteria are met

### Step 4: Plan Update Validation

- Planner updates plan status based on execution
- Verifies plan reflects actual progress
- Confirms plan updates are accurate
- Validates stateless behavior (plan read from file, not chat history)

## Agents Used

- Planner (plan creation and tracking)
- Orchestrator (execution coordination)
- [Other agents as specified in plan]

## Skills Used

- `plan-generator` - Creates structured plans
- Plan tracking and validation
- `response-rater` - Plan quality validation

## Expected Outputs

- `plan-{{workflow_id}}.md` - Plan markdown document
- `plan-{{workflow_id}}.json` - Structured plan data
- Artifacts as specified in plan
- Plan execution tracking report
- Artifact flow validation report

## Success Criteria

| Criterion                           | Measurement                     | Target                                                                            |
| ----------------------------------- | ------------------------------- | --------------------------------------------------------------------------------- |
| Plan created with required sections | Plan completeness check         | All required sections present in plan                                             |
| Plan rating                         | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded                     | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`       |
| Plan structure valid                | JSON schema validation          | Validated against plan schema                                                     |
| Artifacts flow correctly            | Artifact dependency validation  | Artifacts passed correctly between steps                                          |
| Execution follows plan              | Execution tracking              | Steps execute according to plan                                                   |
| Dependencies respected              | Dependency validation           | Dependencies satisfied before execution                                           |
| Plan updates reflect progress       | Plan status tracking            | Plan updated with actual progress                                                 |
| Stateless behavior verified         | File read validation            | Plan read from file, not chat history                                             |
| All success criteria met            | Success criteria validation     | All criteria from plan satisfied                                                  |

## Example Prompts

```
"Test the planner-first workflow with a simple feature"
"Validate that plan execution works correctly"
"Verify artifact flow in planner-first workflow"
```

## Related Documentation

- [Planner Agent](../../agents/planner.md)
- [Orchestrator Agent](../../agents/orchestrator.md)
- [greenfield-fullstack Workflow](../../workflows/greenfield-fullstack.yaml)
- [WORKFLOW-GUIDE.md](../../workflows/WORKFLOW-GUIDE.md)
