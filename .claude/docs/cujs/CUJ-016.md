# CUJ-016: API Documentation

## User Goal
Generate comprehensive API documentation.

## Trigger
- "Document the /api/users endpoint"
- "Generate API docs"
- "Create API documentation"

## Workflow

**Execution Mode**: `skill-only`

### Step 0: Planning Phase
- Planner creates documentation plan
- Analyzes API scope and documentation requirements
- Determines documentation format and structure
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`


### Step 0.1: Plan Rating Gate
- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: API Analysis
- Technical Writer analyzes API
- Extracts endpoint information
- Identifies examples

### Step 2: Documentation Generation
- doc-generator creates API docs
- Generates OpenAPI/Swagger spec
- Adds examples and tutorials

### Step 3: Validation
- Validates documentation
- Tests examples
- Ensures completeness

## Agents Used
- Technical Writer

## Skills Used
- `doc-generator` - Documentation creation
- `response-rater` - Plan quality validation

## Expected Outputs
- API documentation
- OpenAPI/Swagger specification
- Code examples
- Interactive docs

## Success Criteria
- [ ] Documentation plan created (artifact: `plan-{{workflow_id}}.json`, validated by gate file)
- [ ] Plan rating >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`)
- [ ] Rating recorded in run state (validation: rating file exists)
- [ ] API endpoints documented (artifact: `api-docs-{{workflow_id}}.json`, endpoints array populated)
- [ ] Request/response schemas defined (artifact: `api-docs-{{workflow_id}}.json`, each endpoint has request_schema and response_schema)
- [ ] OpenAPI spec generated (artifact: `openapi-{{workflow_id}}.json`, validated by OpenAPI 3.0 spec)
- [ ] Examples provided (artifact: `api-docs-{{workflow_id}}.json`, each endpoint has examples array)
- [ ] Examples are valid (validation: examples match request/response schemas)
- [ ] Authentication documented (artifact: `api-docs-{{workflow_id}}.json`, auth_methods array populated)
- [ ] Error responses documented (artifact: `api-docs-{{workflow_id}}.json`, each endpoint has error_responses array)
- [ ] Report validated (schema: `.claude/schemas/api-docs.schema.json`)

## Example Prompts
```
"Document the /api/users endpoint"
"Generate OpenAPI spec for the API"
"Create API documentation with examples"
```

## Related Documentation
- [Technical Writer Agent](../../agents/technical-writer.md)
- [doc-generator Skill](../../skills/doc-generator/SKILL.md)
