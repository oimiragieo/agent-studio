# CUJ-016: API Documentation

## User Goal

Generate comprehensive API documentation.

## Trigger

- "Document the /api/users endpoint"
- "Generate API docs"
- "Create API documentation"

## Workflow

**Execution Mode**: `workflow`

### Step 0: Planning Phase

- Planner creates documentation plan
- Analyzes API scope and documentation requirements
- Determines documentation format and structure
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: API Analysis

- Technical Writer analyzes API
- Extracts endpoint information
- Identifies examples

### Step 2: Documentation Generation

- doc-generator creates API docs
- Generates OpenAPI/Swagger spec
- Adds examples and tutorials

### Step 3: Validation

- Validates documentation
- Tests examples
- Ensures completeness

## Agents Used

- Technical Writer

## Skills Used

- `doc-generator` - Documentation creation
- `response-rater` - Plan quality validation

## Expected Outputs

- API documentation
- OpenAPI/Swagger specification
- Code examples
- Interactive docs

## Success Criteria

| Criterion                        | Measurement                     | Target                                                                                  |
| -------------------------------- | ------------------------------- | --------------------------------------------------------------------------------------- |
| Documentation plan created       | Artifact validated by gate      | `plan-{{workflow_id}}.json` validated by gate file                                      |
| Plan rating                      | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`)       |
| Rating recorded                  | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`             |
| API endpoints documented         | Artifact endpoints field        | Endpoints array populated in `api-docs-{{workflow_id}}.json`                            |
| Request/response schemas defined | Artifact schema fields          | Each endpoint has request_schema and response_schema in `api-docs-{{workflow_id}}.json` |
| OpenAPI spec generated           | Artifact validated against spec | `openapi-{{workflow_id}}.json` validated by OpenAPI 3.0 spec                            |
| Examples provided                | Artifact examples field         | Each endpoint has examples array in `api-docs-{{workflow_id}}.json`                     |
| Examples are valid               | Schema validation               | Examples match request/response schemas                                                 |
| Authentication documented        | Artifact auth_methods field     | Auth methods array populated in `api-docs-{{workflow_id}}.json`                         |
| Error responses documented       | Artifact error_responses field  | Each endpoint has error_responses array in `api-docs-{{workflow_id}}.json`              |
| Report validated                 | Schema validation               | Validated against `.claude/schemas/api-docs.schema.json`                                |

## Example Prompts

```
"Document the /api/users endpoint"
"Generate OpenAPI spec for the API"
"Create API documentation with examples"
```

## Related Documentation

- [Technical Writer Agent](../../agents/technical-writer.md)
- [doc-generator Skill](../../skills/doc-generator/SKILL.md)
