# CUJ-004: New Feature Planning

## User Goal
Create a comprehensive plan for implementing a new feature.

## Trigger
- "I want to build a user dashboard"
- "Plan feature X"
- "Create plan for [feature]"

## Workflow

**Execution Mode**: `workflow`

**Note**: Specialist coordination runs in parallel for faster planning. Planner coordinates with Analyst, PM, and Architect simultaneously, then aggregates results.

### Step 0.1: Plan Rating Gate
- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Planning Initiation
- Planner agent activated
- Analyzes user requirements
- Determines planning scope

### Step 2: Specialist Coordination
- Planner coordinates with Analyst
- Analyst provides business context
- Planner coordinates with PM
- PM provides product requirements
- Planner coordinates with Architect
- Architect provides technical design

### Step 3: Plan Generation
- Planner synthesizes inputs
- Creates structured plan
- Defines steps, dependencies, risks
- Assigns agents to steps

### Step 4: Plan Validation
- Planner validates plan completeness
- Checks dependencies
- Verifies feasibility
- Generates plan artifacts

## Agents Used
- Planner (orchestrates planning)
- Analyst (business requirements)
- PM (product requirements)
- Architect (technical design)

## Skills Used
- `plan-generator` - Creates structured plans
- `response-rater` - Plan quality validation

## Expected Outputs
- Plan markdown: `.claude/context/artifacts/plan-<id>.md`
- Plan JSON: `.claude/context/artifacts/plan-<id>.json`
- Plan summary

## Success Criteria
- [ ] Plan rating >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`)
- [ ] Rating recorded in run state (validation: rating file exists)
- [ ] All requirements addressed (artifact: plan-{id}.json, validated by gate file)
- [ ] Dependencies mapped (artifact: plan-{id}.json)
- [ ] Risks identified (artifact: plan-{id}.json)
- [ ] Plan is feasible (schema: plan.schema.json)
- [ ] Success criteria defined (artifact: plan-{id}.json)

## Example Prompts
```
"I want to build a user dashboard with analytics"
"Plan the implementation of user authentication"
"Create a plan for adding payment processing"
```

## Related Documentation
- [Planner Agent](../../agents/planner.md)
- [plan-generator Skill](../../skills/plan-generator/SKILL.md)
- [Plan Template](../../templates/plan-template.md)

