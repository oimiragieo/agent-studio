# CUJ-012: Feature Implementation

## User Goal

Implement a complete feature following best practices.

## Trigger

- "Implement user authentication"
- "Build [feature]"
- "Add [feature]"

## Workflow

**Execution Mode**: `greenfield-fullstack.yaml`

### Step 0: Planning Phase

- Planner creates implementation plan
- Analyzes feature requirements
- Coordinates with relevant specialists
- Breaks down into steps
- Assigns agents
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runtime/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Implementation

- Developer implements feature
- Follows plan steps
- Creates code artifacts

### Step 2: Testing

- Developer writes tests
- QA validates quality
- Ensures coverage

### Step 3: Documentation

- Technical Writer documents feature
- Creates usage examples
- Updates guides

### Step 3.5: Publish Artifacts

- **Agent**: orchestrator
- **Skill**: artifact-publisher
- **Condition**: `validation_status == 'pass'`
- **Policy**: auto-on-pass
- **Inputs**: All validated artifacts from workflow (feature implementation, test suite, documentation, usage examples)
- **Outputs**: Published artifacts in project feed
- **Description**: Publish all validated feature implementation artifacts to project feed for cross-platform visibility. Includes code implementation, test suites, documentation, and usage examples for the completed feature.

## Agents Used

- Planner -> Developer -> QA -> Technical Writer

## Skills Used

- `plan-generator` - Implementation plan
- `scaffolder` - Code generation
- `test-generator` - Test creation
- `doc-generator` - Documentation
- `response-rater` - Plan quality validation

## Expected Outputs

- Feature implementation
- Test suite
- Documentation
- Usage examples

## Success Criteria

| Criterion               | Measurement                     | Target                                                                                    |
| ----------------------- | ------------------------------- | ----------------------------------------------------------------------------------------- |
| Plan created            | Artifact validated by gate      | `plan-{{workflow_id}}.json` validated by `gates/00-planner.json`                          |
| Plan rating             | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runtime/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded         | Rating file exists in run state | File present at `.claude/context/runtime/runs/<run_id>/plans/<plan_id>-rating.json`       |
| Feature implemented     | Artifact files field            | Files array populated in `dev-manifest-{{workflow_id}}.json`                              |
| Code passes linting     | Linting tool exit code          | 0 (pass)                                                                                  |
| Tests written           | Artifact test files             | Test files listed in `test-files-{{workflow_id}}.json`                                    |
| Tests passing           | Test runner result              | All tests status: passed in `test-results-{{workflow_id}}.json`                           |
| Test coverage adequate  | Coverage percentage             | >= 80% in `test-results-{{workflow_id}}.json`                                             |
| QA validation passed    | Gate file status                | Status: passed in `gates/qa.json`                                                         |
| Documentation complete  | Documentation artifact          | `feature-docs-{{workflow_id}}.md` rendered from JSON                                      |
| Usage examples included | Examples section                | Examples populated in `feature-docs-{{workflow_id}}.md`                                   |

## Example Prompts

```
"Implement user authentication with JWT"
"Build a task management feature"
"Add payment processing"
```

## Error Recovery

### Retry Strategy

- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits

### Rollback Procedures

1. **Partial Completion**: Save checkpoint to `.claude/context/runtime/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context

### Fallback Options

- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - Developer → Code-Reviewer (implementation fallback)
  - QA → Developer (testing fallback)
  - Technical-Writer → Developer (documentation fallback)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Deploy feature with reduced test coverage (with approval)

### Recovery Artifacts

- Error log: `.claude/context/runtime/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runtime/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runtime/runs/{{run_id}}/checkpoint.json`

## Platform Compatibility

| Platform     | Status          | Notes                                                                                 |
| ------------ | --------------- | ------------------------------------------------------------------------------------- |
| **Claude**   | ✅ Full Support | Primary platform with native workflow engine and full agent orchestration             |
| **Cursor**   | ✅ Full Support | Requires Cursor MCP integration; workflow engine support available                    |
| **Factory**  | ⚠️ Partial      | Requires manual adaptation; complex multi-agent workflows may need custom integration |
| **OpenCode** | ❌ Not Tested   | May work with adaptation of workflow engine and agent system                          |

**Notes**: This is a workflow-based CUJ using `greenfield-fullstack.yaml` for complete feature implementation. Skills (`plan-generator`, `scaffolder`, `test-generator`, `doc-generator`, `response-rater`) must be available on target platform. Requires multi-agent coordination (Planner → Developer → QA → Technical Writer).

## Related Documentation

- [Developer Agent](../../agents/developer.md)
- [greenfield-fullstack Workflow](../../workflows/greenfield-fullstack.yaml)
