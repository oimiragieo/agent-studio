# CUJ-061: Artifact Publishing Workflow

## User Goal

Publish workflow artifacts to the project feed for cross-platform visibility and collaboration.

## Trigger

- "Publish artifacts to project feed"
- "Share artifacts with team"
- "Make artifacts visible in project"
- "Publish workflow results"

## Workflow

**Execution Mode**: workflow
**Workflow File**: `.claude/workflows/artifact-publishing-flow.yaml`

### Step 0: Planning Phase

- **Agent**: Planner
- **Input**: Publishing requirements and scope
- **Output**: Publishing plan (`plan-{id}.json`)

### Step 0.1: Plan Rating Gate

- **Agent**: Orchestrator
- **Skill**: response-rater
- **Minimum Score**: 7/10

### Step 1: Artifact Collection

- **Agent**: Developer
- **Actions**:
  - Scan `.claude/context/artifacts/` directory
  - Identify publishable artifacts
  - Validate artifact schemas
  - Filter out temporary artifacts
- **Output**: Artifact inventory (`artifact-inventory-{id}.json`)

### Step 2: Artifact Validation

- **Agent**: QA
- **Actions**:
  - Validate artifact schemas against `.claude/schemas/`
  - Check artifact completeness
  - Verify artifact references
  - Validate metadata fields
- **Output**: Validation report (`artifact-validation-{id}.json`)

### Step 3: Metadata Enrichment

- **Agent**: Technical-Writer
- **Actions**:
  - Add human-readable descriptions
  - Tag artifacts with keywords
  - Link related artifacts
  - Add version information
- **Output**: Enriched artifact metadata

### Step 4: Publishing to Project Feed

- **Agent**: Developer
- **Skill**: artifact-publisher
- **Actions**:
  - Publish artifacts to project feed
  - Create artifact index
  - Generate sharing links
  - Update artifact registry
- **Output**: Published artifacts, sharing links

### Step 5: Cross-Platform Sync

- **Agent**: Developer
- **Skill**: context-bridge
- **Actions**:
  - Sync artifacts to Cursor workspace
  - Sync artifacts to Factory Droid
  - Update cross-platform references
  - Verify sync completion
- **Output**: Sync status report (`cross-platform-sync-{id}.json`)

### Step 6: Notification and Documentation

- **Agent**: Technical-Writer
- **Actions**:
  - Create artifact summary document
  - Generate artifact changelog
  - Notify team members
  - Update project documentation
- **Output**: Artifact summary, changelog

### Step 7: Access Validation

- **Agent**: QA
- **Actions**:
  - Verify artifact accessibility from project feed
  - Test artifact download/access
  - Validate cross-platform visibility
  - Confirm sharing link functionality
- **Output**: Access validation report

## Agents Used

- Planner (publishing strategy)
- Developer (artifact collection, publishing)
- QA (validation, access testing)
- Technical-Writer (metadata enrichment, documentation)

## Skills Used

- `artifact-publisher` - Publish artifacts to project feed
- `context-bridge` - Cross-platform synchronization
- `plan-generator` - Publishing plan creation
- `response-rater` - Plan validation

## Expected Outputs

- Artifact inventory: `.claude/context/artifacts/artifact-inventory-{id}.json`
- Validation report: `.claude/context/artifacts/artifact-validation-{id}.json`
- Sync status: `.claude/context/artifacts/cross-platform-sync-{id}.json`
- Artifact summary: `.claude/context/artifacts/artifact-summary-{id}.md`
- Artifact changelog: `.claude/context/artifacts/artifact-changelog-{id}.md`
- Published artifacts: Available in project feed with sharing links

## Success Criteria

| Criterion                    | Measurement              | Target                                 |
| ---------------------------- | ------------------------ | -------------------------------------- |
| Artifacts identified         | Artifact inventory       | All valid artifacts collected          |
| Artifacts validated          | Schema validation        | Validated against `.claude/schemas/`   |
| Metadata enriched            | Metadata validation      | Descriptions and tags added            |
| Artifacts published          | Publishing validation    | Successfully published to project feed |
| Cross-platform sync complete | Sync status validation   | Synced to Cursor and Factory Droid     |
| Sharing links functional     | Link testing             | Links generated and tested             |
| Registry updated             | Registry validation      | Artifact registry updated              |
| Team notified                | Notification validation  | Team members notified                  |
| Documentation updated        | Documentation validation | Documentation complete                 |

## Artifact Types Supported

### 1. Planning Artifacts

- `plan-{id}.json` - Workflow plans
- `plan-{id}.md` - Human-readable plans
- `plan-{id}-rating.json` - Plan ratings

### 2. Implementation Artifacts

- `dev-manifest-{id}.json` - Development manifests
- `code-artifacts/` - Source code files
- `test-results-{id}.json` - Test results

### 3. Analysis Artifacts

- `impact-analysis-{id}.json` - Impact assessments
- `dependency-graph-{id}.json` - Dependency analyses
- `security-audit-{id}.json` - Security audits

### 4. Review Artifacts

- `code-review-{id}.json` - Code review results
- `quality-report-{id}.json` - Quality assessments
- `performance-report-{id}.json` - Performance analyses

### 5. Documentation Artifacts

- `api-docs-{id}.md` - API documentation
- `technical-spec-{id}.md` - Technical specifications
- `user-guide-{id}.md` - User guides

## Metadata Enrichment

**Required Metadata Fields**:

```json
{
  "artifact_id": "plan-workflow-123",
  "artifact_type": "plan",
  "created_at": "2026-01-05T10:00:00Z",
  "created_by": "planner",
  "workflow_id": "workflow-123",
  "run_id": "run-456",
  "title": "Greenfield Full-Stack Development Plan",
  "description": "Comprehensive plan for building a full-stack application",
  "tags": ["planning", "full-stack", "greenfield"],
  "related_artifacts": ["dev-manifest-123", "test-results-123"],
  "version": "1.0.0",
  "status": "published",
  "visibility": "team"
}
```

**Optional Metadata**:

- `dependencies`: List of dependent artifacts
- `supersedes`: Previous version artifact ID
- `expires_at`: Artifact expiration timestamp
- `access_control`: Team/project access rules

## Publishing Configuration

### Project Feed Settings

```json
{
  "feed_url": "https://project.feed/artifacts",
  "auto_publish": false,
  "publish_on_workflow_completion": true,
  "retention_days": 90,
  "max_artifact_size_mb": 50,
  "allowed_types": ["plan", "dev-manifest", "test-results", "code-review", "documentation"]
}
```

### Cross-Platform Sync Settings

```json
{
  "sync_to_cursor": true,
  "sync_to_factory": true,
  "sync_frequency": "on_publish",
  "sync_path_cursor": ".cursor/artifacts/",
  "sync_path_factory": ".factory/artifacts/"
}
```

## Test Scenarios

### Scenario 1: Publish Workflow Completion Artifacts

```
1. Complete greenfield-fullstack workflow
2. Collect all artifacts from workflow
3. Validate artifacts against schemas
4. Enrich metadata
5. Publish to project feed
6. Verify artifacts appear in feed
Expected: All artifacts published with metadata
```

### Scenario 2: Cross-Platform Artifact Sync

```
1. Publish artifacts to Claude Code project feed
2. Use context-bridge to sync to Cursor
3. Verify artifacts available in Cursor workspace
4. Use context-bridge to sync to Factory Droid
5. Verify artifacts available in Factory workspace
Expected: Artifacts accessible from all platforms
```

### Scenario 3: Artifact Versioning and Updates

```
1. Publish plan-v1.json
2. Make updates to plan
3. Publish plan-v2.json (supersedes v1)
4. Verify version history tracked
5. Verify old version still accessible
Expected: Version history maintained, both versions accessible
```

### Scenario 4: Selective Artifact Publishing

```
1. Generate 10 artifacts during workflow
2. Select 5 artifacts for publishing (exclude temporary)
3. Validate and publish selected artifacts
4. Verify temporary artifacts NOT published
Expected: Only selected artifacts published
```

## Example Prompts

```
"Publish all artifacts from the latest workflow to project feed"
"Share test results with the team via artifact publishing"
"Publish plan-123.json and sync to Cursor"
"Make all code review artifacts visible in project feed"
```

## Related Documentation

- [artifact-publisher Skill](../../skills/artifact-publisher/SKILL.md)
- [context-bridge Skill](../../skills/context-bridge/SKILL.md)
- [Run Manager Tool](../../tools/run-manager.mjs) - Artifact registry management
- [Artifact Schemas](../../schemas/)

## Related CUJs

- [CUJ-052: Artifact Publishing Validation](./CUJ-052.md) - Publishing validation tests
- [CUJ-053: Publishing Metadata Persistence Test](./CUJ-053.md) - Metadata persistence tests
- [CUJ-054: Cross-Platform Publishing Sync Test](./CUJ-054.md) - Cross-platform sync tests
- [CUJ-055: Publishing Retry Logic Test](./CUJ-055.md) - Retry logic tests
- [CUJ-060: Cross-Platform CUJ Testing](./CUJ-060.md) - Cross-platform validation

## Artifact Publishing Checklist

### Pre-Publishing

- [ ] Artifacts collected from `.claude/context/artifacts/`
- [ ] Temporary artifacts filtered out
- [ ] Artifacts validated against schemas
- [ ] Metadata enriched with descriptions and tags
- [ ] Related artifacts linked
- [ ] Version information added

### Publishing

- [ ] Artifacts published to project feed
- [ ] Sharing links generated
- [ ] Artifact registry updated
- [ ] Team members notified
- [ ] Changelog generated

### Post-Publishing

- [ ] Cross-platform sync completed
- [ ] Accessibility verified from project feed
- [ ] Sharing links tested
- [ ] Documentation updated
- [ ] Access validation completed

## Security and Access Control

**Artifact Visibility Levels**:

- `private`: Only creator can access
- `team`: All team members can access
- `project`: All project collaborators can access
- `public`: Publicly accessible (use with caution)

**Sensitive Artifact Handling**:

- Never publish secrets, credentials, or API keys
- Redact PII before publishing
- Apply access controls to security audits
- Encrypt sensitive artifacts before publishing

**Publishing Guardrails**:

- Artifacts > 50MB require approval
- Security audits published as `team` visibility only
- Credentials automatically filtered out
- PII detection and redaction before publishing

## Error Recovery

### Retry Strategy

- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits

### Rollback Procedures

1. **Partial Completion**: Save checkpoint to `.claude/context/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context

### Fallback Options

- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - Developer → QA (artifact collection fallback)
  - Technical-Writer → Developer (metadata enrichment fallback)
  - QA → Developer (validation fallback)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Publish partial artifact set (skip problematic artifacts)

### Recovery Artifacts

- Error log: `.claude/context/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runs/{{run_id}}/checkpoint.json`
- Publishing state: `.claude/context/runs/{{run_id}}/publishing-state.json`
