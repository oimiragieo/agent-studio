# CUJ-022: AI System Development

## User Goal

Develop AI/LLM features and systems.

## Trigger

- `/ai-system`
- "AI feature development"
- "LLM integration"

## Workflow

**Execution Mode**: `ai-system-flow.yaml`

### Step 0: Planning Phase

- Planner creates AI system development plan
- Analyzes AI requirements and model selection
- Coordinates with Model Orchestrator for multi-model strategy
- Defines AI architecture and integration approach
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Model Orchestration

- Model Orchestrator plans routing
- Selects appropriate models
- Designs multi-model strategy

### Step 2: LLM Architecture

- LLM Architect designs RAG pipeline
- Plans prompt engineering
- Designs AI system

### Step 3: API Design

- API Designer creates AI API
- Designs endpoints
- Plans integration

### Step 4: Implementation

- Developer implements AI features
- Integrates models
- Tests functionality

### Step 5: Quality Validation

- QA validates AI quality
- Tests safety measures
- Ensures reliability

### Step 5.5: Publish Artifacts

- **Agent**: orchestrator
- **Skill**: artifact-publisher
- **Condition**: `validation_status == 'pass'`
- **Policy**: auto-on-pass
- **Inputs**: All validated artifacts from workflow (AI system design, RAG pipeline, prompt templates, AI API implementation)
- **Outputs**: Published artifacts in project feed
- **Description**: Publish all validated AI system development artifacts to project feed for cross-platform visibility. Includes AI architecture designs, RAG pipeline implementations, prompt templates, API integrations, and AI quality validation results.

## Agents Used

- Model Orchestrator → LLM Architect → API Designer → Developer → QA

## Capabilities/Tools Used

- AI/LLM tools (platform-specific AI/LLM integration tools)

## Expected Outputs

- AI system design
- RAG pipeline
- Prompt templates
- AI API implementation

## Success Criteria

| Criterion          | Measurement                     | Target                                                                            |
| ------------------ | ------------------------------- | --------------------------------------------------------------------------------- |
| AI system designed | Design documentation exists     | AI system architecture and design complete                                        |
| Plan rating        | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded    | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`       |
| Models integrated  | Integration testing results     | AI models integrated and functional                                               |
| Safety validated   | Safety testing complete         | AI safety measures validated                                                      |
| Quality ensured    | QA validation complete          | AI quality standards met                                                          |

## Example Prompts

```
/ai-system
"Build RAG system for document search"
"Integrate LLM for chat feature"
```

## Error Recovery

### Retry Strategy

- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits

### Rollback Procedures

1. **Partial Completion**: Save checkpoint to `.claude/context/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context

### Fallback Options

- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - LLM-Architect → Model-Orchestrator (design fallback)
  - API-Designer → Developer (API implementation fallback)
  - QA → Developer (testing fallback)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Deploy with reduced AI capabilities (e.g., single model instead of multi-model)

### Recovery Artifacts

- Error log: `.claude/context/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runs/{{run_id}}/checkpoint.json`
