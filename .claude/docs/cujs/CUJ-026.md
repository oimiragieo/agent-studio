# CUJ-026: Multi-Phase Project Planning

## User Goal
Plan a large project that requires multiple phases to manage context and complexity.

## Trigger
- "Plan a large-scale project with multiple phases"
- Project requires >3000 lines of code
- Complex dependencies requiring phase separation

## Workflow

**Execution Mode**: `greenfield-fullstack.yaml`

### Step 0: Planning Phase (Hierarchical)
- Planner creates master plan (plan-{id}.md) - <5KB overview
- Planner creates phase plans (plan-{id}-phase-{n}.json) - <20KB each
- Each phase contains 1-3k lines of code
- Phases organized by dependencies
- Phase boundary detection: detects when project exceeds 3000 lines, determines optimal boundaries


### Step 0.1: Plan Rating Gate
- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1-N: Phase Execution
- Orchestrator loads only active phase plan
- Agents work on current phase only
- Phase completion tracked in master plan
- Next phase starts after previous completes

## Agents Used
- Planner → Orchestrator → [Phase-specific agents]

## Skills Used
- `plan-generator` - Hierarchical planning
- `dependency-analyzer` - Dependency management for phase organization
- `response-rater` - Plan quality validation

## Capabilities/Tools Used
- Phase organization (planner capability for phase boundary detection)

## Expected Outputs
- plan-{id}.md (master plan)
- plan-{id}-phase-1.json (phase 1)
- plan-{id}-phase-2.json (phase 2)
- [Additional phase plans as needed]

## Success Criteria
- ✅ Master plan provides clear overview
- [ ] Plan rating >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`)
- [ ] Rating recorded in run state (validation: rating file exists)
- ✅ Phase plans are <20KB each
- ✅ Dependencies properly sequenced
- ✅ Context managed per phase
- ✅ Progress tracked across phases
- ✅ Phase boundaries are logical and aligned with feature boundaries

## Example Prompts
```
"Plan a multi-phase e-commerce platform"
"Create a phased plan for migrating legacy system"
```

## Related Documentation
- [Planner Agent](../../agents/planner.md) - Hierarchical Plan Document Creation
- [PLANNER_CENTRIC_ARCHITECTURE.md](../../docs/PLANNER_CENTRIC_ARCHITECTURE.md)

