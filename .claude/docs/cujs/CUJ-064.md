# CUJ-064: Search Functionality

## User Goal

Search codebase and documentation using Algolia-powered semantic search to quickly find relevant code patterns, documentation, and implementation examples.

## Trigger

User needs to find specific code patterns, documentation, or implementation examples across large codebases or documentation sets.

## Workflow

**Execution Mode**: `skill-workflow`

**Workflow File**: `.claude/workflows/search-setup-flow.yaml`

### Step 1: Initialize Search Service

- Verify Algolia search skill availability
- Configure search indexes
- Set up API credentials (if required)
- Initialize search client

### Step 2: Execute Search Query

- Process user's search query
- Apply semantic search algorithms
- Retrieve relevant results from indexes
- Rank results by relevance

### Step 3: Present Results

- Format search results for display
- Include code snippets with context
- Provide links to full documentation
- Highlight matched keywords

### Step 4: Refine Search (Optional)

- Allow user to refine search query
- Apply filters (file type, date, category)
- Re-execute search with refined parameters

## Agents Used

- **analyst**: Query analysis and result ranking
- **orchestrator**: Workflow coordination and skill invocation

## Skills Used

- **algolia-search**: Core search functionality
- **repo-rag**: Complementary codebase search (for comparison)

## Expected Outputs

- **search-results.json**: Structured search results
  - Matched documents
  - Relevance scores
  - Code snippets with context
  - File paths and line numbers
- **search-metadata.json**: Search execution metadata
  - Query parameters
  - Execution time
  - Index statistics
  - Result count

## Success Criteria

| Criterion                                | Measurement                | Target                                          |
| ---------------------------------------- | -------------------------- | ----------------------------------------------- |
| Search query executes successfully       | Query execution status     | Query completes without errors, returns results |
| Results returned within 2 seconds        | Query latency measurement  | 95th percentile latency < 2 seconds             |
| Relevance score > 0.7 for top 10 results | Relevance score analysis   | Average score of top 10 results > 0.7           |
| Results include code context (±5 lines)  | Context snippet validation | Each result includes 5 lines before/after match |
| No API rate limiting errors              | API error log analysis     | Zero rate limit errors during query execution   |
| Search indexes are up-to-date            | Index freshness check      | Last index update within 24 hours               |

## Example Prompts

```
# Search for authentication patterns
"Find all authentication middleware implementations"

# Search for error handling
"Show me error handling patterns in API routes"

# Search for specific functions
"Where is the user validation function defined?"

# Documentation search
"Find documentation about the artifact publishing system"

# Cross-file pattern search
"Show all usages of the response-rater skill"
```

## Platform Compatibility

| Platform      | Status       | Notes                              |
| ------------- | ------------ | ---------------------------------- |
| Claude Code   | ✅ Supported | Full skill integration             |
| Cursor        | ✅ Supported | Via workflow execution             |
| Factory Droid | ⚠️ Partial   | Requires Algolia API configuration |

## Use Case Differentiation

**algolia-search vs repo-rag**:

- **algolia-search**:
  - Structured documentation and indexed content
  - Fast semantic search across large document sets
  - Pre-indexed data with relevance scoring
  - Best for: Documentation search, pattern discovery, knowledge base queries

- **repo-rag**:
  - Real-time codebase analysis
  - AST-based code understanding
  - Context-aware code navigation
  - Best for: Specific code patterns, implementation details, live code analysis

**When to Use CUJ-064**:

- Searching documentation across multiple projects
- Finding historical implementation patterns
- Discovering usage examples
- Knowledge base queries

**When to Use CUJ-010 (repo-rag)**:

- Analyzing current codebase structure
- Finding specific code implementations
- Understanding code dependencies
- Real-time code navigation

## Error Scenarios

| Error | Cause | Recovery |
| **API_KEY_MISSING** | Algolia API key not configured | Set ALGOLIA_API_KEY in environment |
| **INDEX_NOT_FOUND** | Search index doesn't exist | Create index via search-setup-flow |
| **RATE_LIMIT_EXCEEDED** | Too many API requests | Implement exponential backoff, cache results |
| **QUERY_TOO_BROAD** | Query matches too many results | Refine query with filters or constraints |
| **NO_RESULTS_FOUND** | No matches for query | Suggest alternative queries, broaden search |

## Performance Metrics

- **Search Latency**: < 2 seconds for 95th percentile
- **Result Relevance**: > 0.7 average score for top 10
- **Index Freshness**: Updated within 24 hours
- **API Availability**: 99.9% uptime
- **Cache Hit Rate**: > 60% for repeated queries

## Related CUJs

- **CUJ-010**: Repository Semantic Search (repo-rag skill)
- **CUJ-013**: Codebase Analysis
- **CUJ-049**: Documentation Generation
- **CUJ-055**: Knowledge Base Integration

## Related Documentation

- [algolia-search Skill Documentation](../../skills/algolia-search/SKILL.md)
- [search-setup-flow Workflow](../../workflows/search-setup-flow.yaml)
- [Skill Integration Matrix](../../context/skill-integration-matrix.json)
- [repo-rag Skill](../../skills/repo-rag/SKILL.md)
- [Plan Generator Skill](../../skills/plan-generator/SKILL.md)
- [Response Rater Skill](../../skills/response-rater/SKILL.md)

## Notes

1. **Environment Variables**: Requires `ALGOLIA_API_KEY` and `ALGOLIA_APP_ID` for production use
2. **Local Development**: Can use mock search responses for testing without Algolia credentials
3. **Index Maintenance**: Search indexes should be updated regularly via CI/CD pipeline
4. **Rate Limiting**: Implement client-side rate limiting to avoid API quota exhaustion
5. **Caching**: Cache frequent queries to reduce API calls and improve response time
