# CUJ-038: Optional Artifact Handling

## User Goal
Test workflows with optional inputs to ensure graceful degradation when optional artifacts are missing and defaults are used appropriately.

## Trigger
- "Test optional artifact handling"
- "Validate graceful degradation"
- "Test missing optional inputs"

## Workflow

**Execution Mode**: `skill-only`

### Step 0: Planning Phase
- Planner creates plan with optional artifact scenarios
- **Mandatory**: Uses `optional-artifact-handler` skill for optional input detection
- Identifies which artifacts are optional
- Defines default values for missing optional artifacts

### Step 1: Optional Artifact Present (via `optional-artifact-handler` skill)
- Previous step creates optional artifact
- Current step checks for optional artifact
- Artifact exists, agent uses it
- Workflow continues normally

### Step 2: Optional Artifact Missing (via `optional-artifact-handler` skill)
- Previous step does not create optional artifact (or step skipped)
- Current step checks for optional artifact
- Artifact does not exist
- **Mandatory**: Uses `optional-artifact-handler` skill to apply defaults
- Agent proceeds without it using defaults
- Workflow continues successfully
- Agent documents in reasoning that optional input was unavailable

### Step 3: Multiple Optional Artifacts (via `optional-artifact-handler` skill)
- Multiple optional artifacts in workflow
- Some present, some missing
- **Mandatory**: Uses `optional-artifact-handler` skill to handle each
- Agent handles each appropriately:
  - Uses present optional artifacts
  - Uses defaults for missing optional artifacts
- Workflow continues successfully

### Step 4: Optional Artifact Validation
- Verify workflow does not fail due to missing optional artifacts
- Confirm defaults are used appropriately
- Check reasoning files document optional input handling
- Validate workflow completes successfully

## Agents Used
- Planner (planning with optional scenarios)
- [Agents that handle optional inputs]
- QA (validation)

## Skills Used
- `optional-artifact-handler` - Optional artifact handling for workflows with optional inputs

## Capabilities/Tools Used
- Default value management (orchestrator capability)
- Graceful degradation (orchestrator capability)

## Expected Outputs
- Plan with optional artifact scenarios
- Artifacts (some optional, some required)
- Reasoning files documenting optional input handling
- Validation report confirming graceful degradation

## Success Criteria
- [ ] Workflow continues without optional artifacts (validated by gate file)
- [ ] Defaults used appropriately when optional artifacts missing (artifact: reasoning files)
- [ ] Reasoning files document optional input unavailability (artifact: reasoning-{step}.json)
- [ ] Workflow does not fail due to missing optional inputs (validated by gate file)
- [ ] Agents check for optional artifacts before using them (artifact: reasoning files)
- [ ] Multiple optional artifacts handled correctly (artifact: workflow-completion.json)
- [ ] Workflow completes successfully in all scenarios (validated by gate file)

## Example Prompts
```
"Test optional artifact handling in workflow"
"Validate graceful degradation with missing optional inputs"
"Test workflow with multiple optional artifacts"
```

## Related Documentation
- [WORKFLOW-GUIDE.md](../../workflows/WORKFLOW-GUIDE.md) - Optional Artifact References
- [Planner Agent](../../agents/planner.md) - Input Handling section
- [Orchestrator Agent](../../agents/orchestrator.md) - Artifact Management

## Optional Input Handling Pattern

### Agent Implementation Pattern
```javascript
// Agent should check for optional artifacts
const optionalArtifact = await loadArtifact('optional-artifact.json').catch(() => null);
if (optionalArtifact) {
  // Use optional artifact data
  processWithOptionalData(optionalArtifact);
} else {
  // Proceed without optional data
  processWithDefaults();
  // Document in reasoning
  documentReasoning({
    optional_inputs_unavailable: ['optional-artifact.json'],
    defaults_used: true
  });
}
```

### Workflow YAML Pattern
```yaml
inputs:
  - required-artifact.json (from step 1)
  - optional-artifact.json (from step 2, optional)
  - another-optional.json (from step 3, optional)
```

### Test Scenarios

#### Scenario 1: Optional Artifact Present
- Step 2 creates optional artifact
- Step 3 receives optional artifact
- Agent uses optional artifact
- Workflow succeeds

#### Scenario 2: Optional Artifact Missing
- Step 2 does not create optional artifact
- Step 3 checks for optional artifact
- Artifact missing, agent uses defaults
- Workflow succeeds
- Reasoning documents missing optional input

#### Scenario 3: Conditional Step Creates Optional Artifact
- Conditional step may or may not execute
- If executed, creates optional artifact
- Next step handles both cases gracefully
- Workflow succeeds in both scenarios

