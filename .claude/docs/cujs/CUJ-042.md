# CUJ-042: Cursor Subagent Coordination

## User Goal
Test Cursor-specific subagent workflows to ensure seamless coordination between Cursor subagents, proper use of Cursor Plan Mode, and correct artifact sharing via `.cursor/plans/`.

## Trigger
- "Test Cursor subagent coordination"
- "Validate Cursor Plan Mode integration"
- "Test Cursor subagent workflows"

## Workflow

**Execution Mode**: `manual-setup`

### Step 0: Planning Phase
- Planner (Cursor subagent) creates plan
- Uses Cursor Plan Mode for implementation-level planning
- Creates plan artifacts in `.cursor/plans/`
- Coordinates with other Cursor subagents

### Step 1: Cursor Subagent Activation
- Orchestrator activates Cursor subagents
- Uses Cursor's native subagent tools for delegation
- Passes context via shared artifacts in `.cursor/plans/`
- Verifies subagent coordination patterns

### Step 2: Analyst Subagent (Cursor)
- Analyst subagent receives task via Cursor subagent tools
- Reads shared context from `.cursor/plans/current-context.json`
- Creates `project-brief.json`
- Saves to `.cursor/plans/artifacts/project-brief.json`
- Updates shared context

### Step 3: PM Subagent (Cursor)
- PM subagent receives task via Cursor subagent tools
- Reads shared context and project-brief.json
- Creates `prd.json`
- Saves to `.cursor/plans/artifacts/prd.json`
- Updates shared context

### Step 4: Architect Subagent (Cursor)
- Architect subagent receives task via Cursor subagent tools
- Reads shared context and prd.json
- Creates `system-architecture.json`
- Saves to `.cursor/plans/artifacts/system-architecture.json`
- Updates shared context

### Step 5: Developer Subagent (Cursor)
- Developer subagent receives task via Cursor subagent tools
- Uses Cursor Plan Mode for implementation planning
- Reads shared context and architecture
- Implements code using Cursor IDE integration
- Creates `dev-manifest.json`
- Updates shared context

### Step 6: Cursor Plan Mode Integration
- Verify Cursor Plan Mode used for implementation planning
- Verify Plan Mode artifacts linked to Planner Agent plans
- Verify seamless transition between Planner Agent and Plan Mode
- Validate Plan Mode outputs integrated with workflow

### Step 7: Coordination Validation
- Verify all subagents used Cursor's native tools
- Verify artifacts shared via `.cursor/plans/`
- Verify context passed correctly between subagents
- Verify no coordination failures

## Agents Used
- Planner (Cursor subagent) - Strategic planning
- Orchestrator (Cursor subagent) - Coordination
- Analyst (Cursor subagent) - Project brief
- PM (Cursor subagent) - PRD
- Architect (Cursor subagent) - Architecture
- Developer (Cursor subagent) - Implementation

## Capabilities/Tools Used
- Cursor subagent coordination (orchestrator capability)
- Cursor Plan Mode integration (Cursor IDE feature, not a skill)
- Artifact sharing via `.cursor/plans/`
- Native Cursor subagent tools

## Expected Outputs
- Plan artifacts in `.cursor/plans/`
- Shared context: `.cursor/plans/current-context.json`
- Artifacts: `.cursor/plans/artifacts/*.json`
- Cursor Plan Mode artifacts
- Coordination validation report

## Success Criteria
- [ ] All Cursor subagents activated successfully (artifact: coordination-log.json)
- [ ] Native Cursor subagent tools used for delegation (artifact: coordination-log.json)
- [ ] Artifacts shared via `.cursor/plans/` directory (artifact: .cursor/plans/artifacts/*.json)
- [ ] Context passed correctly between subagents (artifact: .cursor/plans/current-context.json)
- [ ] Cursor Plan Mode integrated for implementation (artifact: .cursor/plans/plan-{id}.json)
- [ ] Plan Mode artifacts linked to Planner Agent plans (artifact: plan-{id}.json with links)
- [ ] No coordination failures (validated by gate file)
- [ ] Seamless subagent handoffs (artifact: handoff-log.json)

## Example Prompts
```
"Test Cursor subagent coordination workflow"
"Validate Cursor Plan Mode integration with Planner Agent"
"Test Cursor subagent artifact sharing"
```

## Related Documentation
- [Cursor Setup Guide](../../docs/setup-guides/CURSOR_SETUP_GUIDE.md)
- [Planner Agent](../../agents/planner.md) - Cursor Plan Mode Integration
- [Orchestrator Agent](../../agents/orchestrator.md) - Native Subagent Orchestration

## Cursor Subagent Coordination Patterns

### Native Subagent Tools
- Use Cursor's built-in subagent delegation
- Pass context via subagent tool parameters
- Receive results from subagent tools
- No manual context passing required

### Artifact Sharing
- Shared context: `.cursor/plans/current-context.json`
- Artifacts: `.cursor/plans/artifacts/*.json`
- All subagents read/write to shared locations
- Context automatically synchronized

### Cursor Plan Mode Integration
- Planner Agent creates strategic plans
- Cursor Plan Mode used for implementation planning
- Plan Mode artifacts linked to Planner Agent plans
- Seamless transition between planning levels

## Cursor Plan Mode Workflow

### Strategic Planning (Planner Agent)
1. Planner Agent creates comprehensive plan
2. Plan saved to `.claude/context/artifacts/plan-{{id}}.json`
3. Plan includes high-level steps and agent assignments

### Implementation Planning (Cursor Plan Mode)
1. Developer activates Cursor Plan Mode (`Shift+Tab`)
2. Plan Mode auto-researches repo
3. Creates implementation-level plan
4. Links to strategic plan from Planner Agent
5. Executes implementation with IDE integration

### Integration Points
- Planner Agent plans reference Plan Mode artifacts
- Plan Mode plans reference Planner Agent plans
- Both use same workflow ID for traceability
- Artifacts stored in appropriate locations

## Test Scenarios

### Scenario 1: Sequential Subagent Coordination
- Orchestrator delegates to Analyst
- Analyst completes, updates shared context
- Orchestrator delegates to PM
- PM reads Analyst's output from shared context
- Seamless handoff between subagents

### Scenario 2: Parallel Subagent Coordination
- Orchestrator delegates to UX Expert and Architect in parallel
- Both read from shared context
- Both update shared context
- No conflicts or race conditions
- Coordination successful

### Scenario 3: Cursor Plan Mode Integration
- Planner Agent creates strategic plan
- Developer uses Cursor Plan Mode for implementation
- Plan Mode references strategic plan
- Implementation follows both plans
- Integration seamless

### Scenario 4: Context Sharing Validation
- Multiple subagents read/write shared context
- No context loss or corruption
- All subagents see latest context
- Coordination successful

