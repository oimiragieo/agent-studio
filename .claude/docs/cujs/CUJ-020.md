# CUJ-020: Security Audit

## User Goal
Audit system security and identify vulnerabilities.

## Trigger
- "Audit authentication security"
- "Security review"
- "Security audit"

## Workflow

**Execution Mode**: `workflow`

### Step 0: Planning Phase
- Planner creates security audit plan
- Analyzes security scope and audit requirements
- Coordinates with Security Architect for audit strategy
- Defines security standards and compliance requirements
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`


### Step 0.1: Plan Rating Gate
- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Security Analysis
- Security Architect analyzes system
- Reviews authentication/authorization
- Checks for vulnerabilities

### Step 2: Threat Modeling
- Identifies threats
- Assesses risks
- Maps attack vectors

### Step 3: Audit Report
- Generates security audit report
- Lists vulnerabilities
- Provides remediation

### Step 4: Compliance Check
- Checks compliance requirements
- Validates standards
- Documents findings

### Step 4.5: Publish Artifacts
- **Agent**: orchestrator
- **Skill**: artifact-publisher
- **Condition**: `validation_status == 'pass'`
- **Policy**: auto-on-pass
- **Inputs**: All validated artifacts from workflow (security audit report, vulnerability list, remediation plan, compliance checklist)
- **Outputs**: Published artifacts in project feed
- **Description**: Publish all validated security audit artifacts to project feed for cross-platform visibility. Includes vulnerability assessments, threat models, remediation recommendations, and compliance validation results.

## Agents Used
- Security Architect

## Skills Used
- `rule-auditor` - Security rule compliance checking
- `response-rater` - Plan quality validation

## Capabilities/Tools Used
- Security scanning tools (platform-specific security scanners)

## Expected Outputs
- Security audit report
- Vulnerability list
- Remediation plan
- Compliance checklist

## Success Criteria

| Criterion | Measurement | Target |
|-----------|-------------|--------|
| Vulnerabilities identified | Security scan results | Vulnerabilities documented in security audit report |
| Plan rating | response-rater skill score | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json` |
| Risks assessed | Risk assessment complete | Risks evaluated with severity ratings |
| Remediation provided | Remediation plan exists | Remediation recommendations documented |
| Compliance validated | Compliance checklist complete | Compliance requirements validated |

## Example Prompts
```
"Audit authentication security"
"Security review of the API"
"Check for security vulnerabilities"
```

