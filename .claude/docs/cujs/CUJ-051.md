# CUJ-051: Artifact Publishing Validation

## User Goal

Validate that artifact-publisher skill correctly publishes artifacts and integrates with artifact registry.

## Trigger

- "Test artifact publishing"
- "Validate artifact-publisher integration"
- "Check published artifacts"

## Workflow

**Execution Mode**: `workflow`

**Note**: Orchestrator must spawn Developer/QA agent to execute this skill.

### Step 0: Planning Phase

- Planner creates validation plan
- Identifies test scenarios for artifact publishing
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Test Artifact Creation

- Create test artifact (e.g., `test-plan.json`)
- Register artifact in registry with `publishable: true`
- Verify artifact exists in registry

### Step 2: Test Publishing

- Invoke `artifact-publisher` skill
- Verify artifact is published to project feed
- Check registry metadata updated with publishing status

### Step 3: Test Cross-Platform Publishing

- Test publishing on Claude platform
- Test publishing on Cursor platform (if available)
- Verify consistent metadata structure

### Step 4: Test Registry Integration

- Verify registry tracks publishing status
- Check `publish_attempts` array populated
- Verify `publish_status` and `publish_error` fields

### Step 5: Test Error Handling

- Simulate publishing failure (network error, permission denied)
- Verify retry logic works (3 retries with exponential backoff)
- Check error logged in registry metadata
- Verify `publish_status: 'failed'` set correctly

### Step 6: Test Metadata Enrichment

- Use `enrichArtifactMetadata()` function
- Verify enriched metadata includes:
  - `workflow_id`, `step_number`, `agent`
  - `validation_status` from gate file
  - `dependencies` from registry
  - Publishing status and attempts

## Agents Used

- Planner (planning validation)
- QA (validation testing)

## Skills Used

- `artifact-publisher` - Publishing artifacts
- `plan-generator` - Creating validation plan
- `response-rater` - Plan quality validation

## Capabilities/Tools Used

- Artifact registry functions: `registerArtifact()`, `enrichArtifactMetadata()`
- Gate file validation
- Cross-platform artifact sync

## Expected Outputs

- Validation plan: `plan-{{workflow_id}}.json`
- Test artifacts: `test-plan.json`, `test-architecture.json`
- Publishing validation report: `publishing-validation-report.json`
- Registry metadata with publishing status
- Error handling test results

## Success Criteria

| Criterion                       | Measurement                     | Target                                                                            |
| ------------------------------- | ------------------------------- | --------------------------------------------------------------------------------- |
| Plan rating                     | response-rater skill score      | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded                 | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`       |
| Artifact created and registered | Registry validation             | Artifact registered in artifact registry                                          |
| Artifact published              | Publishing validation           | Successfully published to project feed                                            |
| Registry metadata updated       | Metadata validation             | `published: true` and `published_at` timestamp present                            |
| Cross-platform publishing       | Platform compatibility          | Works on Claude and Cursor platforms                                              |
| Metadata structure consistent   | Schema validation               | Consistent structure across platforms                                             |
| Error handling retries          | Retry validation                | 3 attempts with exponential backoff                                               |
| Publishing failures logged      | Error logging                   | `publish_status: 'failed'` in registry                                            |
| Enriched metadata complete      | Metadata validation             | `enrichArtifactMetadata()` returns complete metadata                              |
| Publishing status in gate file  | Gate validation                 | Publishing status included in validation results                                  |
| All test scenarios pass         | Test validation                 | All scenarios pass successfully                                                   |

## Example Prompts

```
"Test artifact publishing integration"
"Validate that artifact-publisher works with registry"
"Check if published artifacts are tracked correctly"
```

## Related Documentation

- [Artifact Publisher Skill](../../skills/artifact-publisher/SKILL.md)
- [Artifact Registry Tool](../../tools/artifact-registry.mjs)
- [Workflow Guide](../../workflows/WORKFLOW-GUIDE.md)
