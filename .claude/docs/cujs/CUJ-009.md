# CUJ-009: Component Scaffolding

## User Goal
Generate rule-compliant component boilerplate.

## Trigger
- "Scaffold a UserProfile component"
- `/scaffold component UserProfile`
- "Generate component"

## Workflow

**Execution Mode**: `workflow`

### Step 0: Planning Phase (Optional for Simple Components)
- Planner creates implementation plan (required for all components)
- Analyzes component requirements
- Determines framework and structure
- Outputs: `plan-{{workflow_id}}.md`, `plan-{{workflow_id}}.json`
- Note: For very simple components, this step may be skipped for speed


### Step 0.1: Plan Rating Gate
- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Component Analysis
- Developer identifies component type
- Determines framework (React, Vue, etc.)

### Step 2: Scaffolding
- scaffolder skill queries rule index
- Generates boilerplate following rules
- Creates supporting files (types, tests, etc.)

### Step 3: Customization
- Developer reviews generated code
- Customizes as needed
- Adds business logic

### Step 4: Validation
- rule-auditor validates compliance
- Fixes any violations
- Ensures quality

## Agents Used
- Developer

## Skills Used
- `scaffolder` - Code generation
- `rule-auditor` - Compliance validation
- `response-rater` - Plan quality validation

## Expected Outputs
- Component files
- Type definitions
- Test files
- Supporting files

## Success Criteria

| Criterion | Measurement | Target |
|-----------|-------------|--------|
| Component generated | Artifact exists | `component-files.json` populated with component files |
| Plan rating | response-rater skill score | >= 7/10 (recorded in `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json`) |
| Rating recorded | Rating file exists in run state | File present at `.claude/context/runs/<run_id>/plans/<plan_id>-rating.json` |
| Rules compliant | rule-auditor validation | Validated by rule-auditor and gate file |
| Tests included | Artifact exists | `test-files.json` populated with test files |
| Ready for customization | Gate validation | Validated by gate file with customization readiness |

## Example Prompts
```
"Scaffold a UserProfile component"
"/scaffold component SearchBar"
"Generate a React component for login"
```

## Error Recovery

### Retry Strategy
- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits

### Rollback Procedures
1. **Partial Completion**: Save checkpoint to `.claude/context/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context

### Fallback Options
- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - Developer â†’ Architect (escalation for complex component design decisions)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Code analysis only (defer implementation until design issues resolved; provide component structure recommendations without code generation)

### Recovery Artifacts
- Error log: `.claude/context/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runs/{{run_id}}/checkpoint.json`

## Related Documentation
- [Developer Agent](../../agents/developer.md)
- [scaffolder Skill](../../skills/scaffolder/SKILL.md)
- [rule-auditor Skill](../../skills/rule-auditor/SKILL.md)

