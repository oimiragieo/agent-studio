# CUJ-029: Cloud Integration Workflow

## User Goal
Separate cloud integration from business logic implementation.

## Trigger
- "Implement cloud storage integration"
- "Add GCP Pub/Sub to application"
- Business logic needs cloud services

## Workflow

**Execution Mode**: `greenfield-fullstack.yaml`

### Step 7: Business Logic Implementation
- Developer implements core features
- Creates interfaces/stubs for cloud services
- Uses cloud services via interfaces
- Focuses on application logic
- Uses infrastructure-config.json for resource names

### Step 7.5: Cloud Integration (NEW)
- Cloud-Integrator implements actual cloud clients
- Configures authentication (ADC, service accounts)
- Creates cloud service modules
- Implements error handling and retry logic
- Supports both emulators and production
- Validates emulator connectivity and functionality

### Step 8+: Validation and Testing
- Multi-AI validation
- QA testing with emulators
- Production deployment

## Agents Used
- Developer → Cloud-Integrator → Model-Orchestrator → QA

## Capabilities/Tools Used
- Cloud SDK integration (platform-specific cloud SDKs)
- Authentication configuration (cloud provider authentication setup)
- Emulator setup (local cloud emulator configuration)

## Expected Outputs
- Business logic code (Step 7)
- Cloud integration code (Step 7.5)
- cloud-integration.json (Step 7.5)
- Emulator configuration

## Success Criteria
- ✅ Business logic separated from cloud code
- ✅ Cloud integration works with emulators
- ✅ Production-ready cloud clients
- ✅ Proper error handling
- ✅ Authentication configured correctly
- ✅ Emulator validation passed

## Example Prompts
```
"Add GCP storage to file upload feature"
"Implement Pub/Sub messaging for notifications"
```

## Error Recovery

### Retry Strategy
- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits, cloud service unavailability

### Rollback Procedures
1. **Partial Completion**: Save checkpoint to `.claude/context/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context

### Fallback Options
- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - Cloud-Integrator → Developer (cloud implementation fallback)
  - Developer → Architect (interface design fallback)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Continue with emulator-only support (defer production cloud integration)

### Recovery Artifacts
- Error log: `.claude/context/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runs/{{run_id}}/checkpoint.json`
- Cloud integration state: `.claude/context/runs/{{run_id}}/cloud-integration.json`

## Related Documentation
- [greenfield-fullstack Workflow](../../workflows/greenfield-fullstack.yaml) - Step 7.5
- [WORKFLOW-GUIDE.md](../../workflows/WORKFLOW-GUIDE.md) - Cloud Integrator Agent
- [Cloud-Integrator Agent](../../agents/cloud-integrator.md)
- [Developer Agent](../../agents/developer.md) - Interface Creation for Cloud Services

