# CUJ-005: Greenfield Project Planning

## User Goal

Plan and execute a complete new project from scratch.

## Trigger

- "Build a new e-commerce platform"
- "Create new project"
- "Greenfield project"

## Workflow

**Execution Mode**: workflow
**Workflow File**: `.claude/workflows/greenfield-fullstack.yaml`

### Step 0: Planning Phase

- Planner creates comprehensive project plan
- Coordinates with all specialists
- Validates plan completeness

### Step 0.1: Plan Rating Gate

- Agent: orchestrator
- Type: validation
- Skill: response-rater
- Validates plan quality (minimum score: 7/10)
- Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
- If score < 7: Return to Planner with feedback
- If score >= 7: Proceed to execution
- Records rating in `.claude/context/runtime/runs/<run_id>/plans/<plan_id>-rating.json`

### Step 1: Project Discovery

- Analyst creates project brief
- Market research and competitive analysis
- Feasibility study

### Step 2: Product Requirements

- PM creates PRD
- User stories and acceptance criteria
- Feature prioritization

### Step 3: UX Design

- UX Expert designs interface
- User flows and wireframes
- Accessibility considerations

### Step 4: System Architecture

- Architect designs system
- Technology selection
- Integration patterns

### Step 5: Database Architecture

- Database Architect designs schema
- Data modeling
- Migration strategy

### Step 6: Test Planning

- QA creates test plan
- Test strategy
- Quality gates

### Step 7: Implementation

- Developer implements features
- Follows plan steps
- Creates code artifacts

### Step 8: Documentation

- Technical Writer documents system
- API documentation
- User guides

### Step 9: Quality Validation

- QA validates quality gates
- Final testing
- Acceptance validation

### Step 9.5: Publish Artifacts

- **Agent**: orchestrator
- **Skill**: artifact-publisher
- **Condition**: validation_status == 'pass'
- **Policy**: auto-on-pass
- **Description**: Publish all validated artifacts to project feed for cross-platform visibility
- **Output**: Published artifacts with sharing links

## Agents Used

- Planner -> Analyst -> PM -> UX Expert -> Architect -> Database Architect -> QA -> Developer -> Technical Writer -> QA

## Skills Used

- `plan-generator` - Project planning
- `scaffolder` - Code generation
- `rule-auditor` - Code validation
- `doc-generator` - Documentation
- `response-rater` - Plan quality validation

## Expected Outputs

- Project brief
- PRD
- UX specifications
- Architecture documents
- Database schema
- Test plan
- Implementation code
- Documentation

## Success Criteria

| Criterion                  | Measurement                       | Target                                                                                             |
| -------------------------- | --------------------------------- | -------------------------------------------------------------------------------------------------- |
| Plan created               | Artifact exists and validated     | `plan-{{workflow_id}}.json` validated by `gates/00-planner.json`                                   |
| Plan rating                | response-rater skill score        | >= 7/10 (recorded in `.claude/context/runtime/runs/<run_id>/plans/<plan_id>-rating.json`)          |
| Rating recorded            | Rating file exists in run state   | File present at `.claude/context/runtime/runs/<run_id>/plans/<plan_id>-rating.json`                |
| Project brief complete     | Artifact validated against schema | `project-brief-{{workflow_id}}.json` validated by `.claude/schemas/project_brief.schema.json`      |
| PRD complete               | Artifact validated by gate        | `prd-{{workflow_id}}.json` validated by `gates/02-pm.json`                                         |
| UX specifications complete | Artifact validated by gate        | `ui-spec-{{workflow_id}}.json` validated by gate file                                              |
| Architecture documented    | Artifact validated against schema | `architecture-{{workflow_id}}.json` validated by `.claude/schemas/system_architecture.schema.json` |
| Database schema designed   | Artifact validated by gate        | `db-schema-{{workflow_id}}.json` validated by gate file                                            |
| Test plan created          | Artifact validated against schema | `test-plan-{{workflow_id}}.json` validated by `.claude/schemas/test_plan.schema.json`              |
| Implementation complete    | Artifact validated by QA gate     | `dev-manifest-{{workflow_id}}.json` validated by QA gate                                           |
| Documentation complete     | Artifact rendered from JSON       | `docs-{{workflow_id}}.md` rendered and complete                                                    |
| All quality gates passed   | Gate file status check            | All gate files in `gates/` show `status: "passed"`                                                 |

## Example Prompts

```
"Build a new task management application"
"Create a new e-commerce platform from scratch"
"Greenfield project: social media app"
```

## Error Recovery

### Retry Strategy

- **Max Retries**: 3 attempts per step
- **Backoff**: Exponential (1s, 2s, 4s)
- **Retry Triggers**: Transient failures, timeouts, rate limits

### Rollback Procedures

1. **Partial Completion**: Save checkpoint to `.claude/context/runtime/runs/{{run_id}}/checkpoint.json`
2. **Failed Validation**: Return to previous passing gate
3. **Critical Failure**: Escalate to human with full context

### Fallback Options

- **Alternative Agent**: If primary agent fails 3x, route to backup agent
  - Developer → Code-Reviewer (implementation fallback)
  - Architect → Developer (design fallback)
  - QA → Developer (testing fallback)
- **Manual Override**: User can force-proceed with documented risks
- **Graceful Degradation**: Skip non-critical steps with warnings

### Recovery Artifacts

- Error log: `.claude/context/runtime/runs/{{run_id}}/errors.log`
- Recovery state: `.claude/context/runtime/runs/{{run_id}}/recovery-state.json`
- Checkpoint: `.claude/context/runtime/runs/{{run_id}}/checkpoint.json`

## Platform Compatibility

| Platform     | Status          | Notes                                                                                 |
| ------------ | --------------- | ------------------------------------------------------------------------------------- |
| **Claude**   | ✅ Full Support | Primary platform with native workflow engine and full agent orchestration             |
| **Cursor**   | ✅ Full Support | Requires Cursor MCP integration; workflow engine support available                    |
| **Factory**  | ⚠️ Partial      | Requires manual adaptation; complex multi-agent workflows may need custom integration |
| **OpenCode** | ❌ Not Tested   | May work with adaptation of workflow engine and agent system                          |

**Notes**: This is a complex workflow-based CUJ that requires full workflow engine support and multi-agent orchestration. Skills (`plan-generator`, `scaffolder`, `rule-auditor`, `doc-generator`, `response-rater`) must be available on target platform.

## Related Documentation

- [greenfield-fullstack Workflow](../../workflows/greenfield-fullstack.yaml)
- [Planner Agent](../../agents/planner.md)
