name: Ship Readiness Audit (Headless)
description: >
  UI-safe ship-readiness audit. Runs baseline suites + validation and writes an auditable report/results
  by invoking the headless runner from a single step (minimizes Claude Code UI memory pressure).
type: testing
project_type: validation
publish_policy: manual

recovery:
  enabled: true
  checkpoint_dir: '.claude/context/runtime/runs/{{run_id}}/checkpoints'

trigger_patterns:
  - 'ship readiness'
  - 'ship-readiness'
  - 'readiness audit'
  - 'release readiness'
  - 'user-like-integration-v1'

steps:
  - step: 0
    name: 'Run Ship Readiness (Headless)'
    agent: qa
    inputs:
      - workflow_id
    outputs:
      - .claude/context/reports/testing/{{workflow_id}}-run-report.md
      - .claude/context/artifacts/testing/{{workflow_id}}-run-results.json
    validation:
      schema: .claude/schemas/generic-json.schema.json
    blocking: true
    description: |
      Run the headless ship-readiness harness using the workflow id provided by the workflow engine.

      Primary (recommended):
      - `node .claude/tools/run-ship-readiness-headless.mjs --workflow-id {{workflow_id}} --json --denial-test`

      Alternative (pnpm script wrapper; pass-through args after `--`):
      - `pnpm ship-readiness:headless:json -- --workflow-id {{workflow_id}}`
