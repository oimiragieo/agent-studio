name: Mobile Application Development Workflow
description: Mobile app development for iOS, Android, and cross-platform frameworks
type: mobile
project_type: mobile

# Error Recovery Configuration
recovery:
  enabled: true
  checkpoint_dir: ".claude/context/runs/{{run_id}}/checkpoints"

retry_config:
  max_attempts: 3
  backoff_strategy: exponential
  initial_delay_ms: 1000
  retryable_errors: [timeout, network_error, rate_limit]

fallback_agents:
  developer: [code-reviewer, qa]
  architect: [developer, security-architect]
  qa: [developer, code-reviewer]
  planner: [architect, pm]
  mobile-developer: [developer, ux-expert]
  pm: [analyst, ux-expert]
  ux-expert: [pm, accessibility-expert]
  accessibility-expert: [ux-expert, qa]
  security-architect: [compliance-auditor, code-reviewer]
  code-reviewer: [developer, security-architect]
  technical-writer: [developer, pm]

# NOTE: trigger_keywords here are for documentation only.
# The actual workflow selection uses keywords from .claude/config.yaml workflow_selection section.
# See .claude/config.yaml for the authoritative keyword list used by the routing system.
trigger_keywords:
  - "mobile app"
  - "ios"
  - "android"
  - "react native"
  - "flutter"
  - "native app"
  - "app store"

steps:
  - step: 0
    name: "Planning Phase"
    agent: planner
    inputs:
      - app_requirements
      - target_platforms
      - design_specs
    outputs:
      - plan-{{workflow_id}}.md
      - plan-{{workflow_id}}.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/00-planner.json
    validation:
      schema: .claude/schemas/plan.schema.json
      gate: .claude/context/history/gates/{{workflow_id}}/00-planner.json
    description: |
      Plan mobile application development:
      - Analyze app requirements and platforms
      - Coordinate mobile development strategy
      - Create structured development plan

  - step: 0.1
    name: "Plan Rating Gate"
    agent: orchestrator
    type: validation
    skill: response-rater
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
    outputs:
      - .claude/context/runs/<run_id>/plans/<plan_id>-rating.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/00.1-orchestrator.json
    validation:
      minimum_score: 7
      rubric_file: .claude/context/artifacts/standard-plan-rubric.json
      gate: .claude/context/history/gates/{{workflow_id}}/00.1-orchestrator.json
    retry:
      max_attempts: 3
      on_failure: escalate_to_human
    description: |
      Rate plan quality using response-rater skill.
      - Rubric: completeness, feasibility, risk mitigation, agent coverage, integration
      - Minimum passing score: 7/10
      - If score < 7: Return to Planner with feedback, request improvements, re-rate until passing
      - If score >= 7: Proceed with workflow execution
      - Log rating in reasoning file and artifact metadata
      - Never execute an unrated plan - this is a hard requirement

  - step: 1
    name: "Mobile Development"
    agent: mobile-developer
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - app_requirements
      - target_platforms
      - design_specs
    outputs:
      - mobile-architecture.json
      - platform-strategy.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/01-mobile-developer.json
    validation:
      schema: .claude/schemas/system_architecture.schema.json
      gate: .claude/context/history/gates/{{workflow_id}}/01-mobile-developer.json
    description: |
      Mobile development planning:
      - Platform selection (native vs cross-platform)
      - Architecture patterns (MVVM, Clean, etc.)
      - State management strategy
      - Navigation structure
      - Offline-first capabilities
      - Push notification design

  - step: 2
    name: "Mobile UX Design"
    agent: ux-expert
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - mobile-architecture.json (from step 1)
      - app_requirements
    outputs:
      - mobile-ux-spec.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/02-ux-expert.json
    validation:
      schema: .claude/schemas/ux_spec.schema.json
      gate: .claude/context/history/gates/{{workflow_id}}/02-ux-expert.json
    description: |
      Mobile-specific UX design:
      - Touch-first interface design
      - Gesture patterns
      - Platform-specific guidelines (HIG, Material)
      - Responsive layouts
      - Accessibility considerations
      - Animation and micro-interactions

  - step: 2.5
    name: "Security & Permissions Review"
    agent: security-architect
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - mobile-architecture.json (from step 1)
      - mobile-ux-spec.json (from step 2)
    outputs:
      - mobile-security-review.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/02.5-security-architect.json
    validation:
      gate: .claude/context/history/gates/{{workflow_id}}/02.5-security-architect.json
    description: |
      Mobile security and permissions review:
      - Authentication and authorization patterns
      - Secure storage (Keychain, KeyStore)
      - API security and certificate pinning
      - Permissions model (iOS/Android)
      - Data encryption (at rest and in transit)
      - Secure communication protocols
      - Biometric authentication implementation
      - PII handling and privacy compliance

  - step: 2.6
    name: "Mobile Accessibility Audit"
    agent: accessibility-expert
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - mobile-architecture.json (from step 1)
      - mobile-ux-spec.json (from step 2)
    outputs:
      - mobile-accessibility-audit.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/02.6-accessibility-expert.json
    validation:
      gate: .claude/context/history/gates/{{workflow_id}}/02.6-accessibility-expert.json
    description: |
      Mobile accessibility compliance:
      - Screen reader support (VoiceOver, TalkBack)
      - Touch target sizing (44x44pt minimum)
      - Color contrast and high contrast modes
      - Dynamic type support
      - Haptic feedback patterns
      - Accessibility labels and hints
      - Focus management
      - WCAG mobile guidelines compliance

  - step: 3
    name: "Implementation"
    agent: developer
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - mobile-architecture.json (from step 1)
      - mobile-ux-spec.json (from step 2)
    outputs:
      - dev-manifest.json
      - code-artifacts
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/03-developer.json
    validation:
      schema: .claude/schemas/artifact_manifest.schema.json
      gate: .claude/context/history/gates/{{workflow_id}}/03-developer.json
    description: |
      Mobile implementation:
      - Core app structure
      - UI components
      - Navigation implementation
      - API integration
      - Local storage
      - Platform-specific features

  - step: 4
    name: "Code Review"
    agent: code-reviewer
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - dev-manifest.json (from step 3)
      - mobile-architecture.json (from step 1)
      - mobile-ux-spec.json (from step 2)
    outputs:
      - code-review-{{workflow_id}}.json
      - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-code-reviewer.json
    validation:
      schema: .claude/schemas/code-review.schema.json
      gate: .claude/context/history/gates/{{workflow_id}}/04-code-reviewer.json
    on_failure: "Return to implementation step with feedback"
    description: |
      Review mobile implementation for quality, security, and codebase impact:
      - Verify platform-specific best practices (iOS/Android/React Native)
      - Check memory management and leak prevention
      - Review state management implementation
      - Validate offline-first capabilities
      - Ensure proper navigation patterns

  - step: 5
    name: "Mobile Quality Assurance"
    agent: qa
    inputs:
      - plan-{{workflow_id}}.json (from step 0)
      - dev-manifest.json (from step 3)
      - code-review-{{workflow_id}}.json (from step 4)
      - mobile-ux-spec.json (from step 2)
    outputs:
      - mobile-test-results.json
      - quality-report.json
    validation:
      gate: .claude/context/history/gates/{{workflow_id}}/05-qa.json
    description: |
      Mobile-specific testing:
      - Device compatibility testing
      - Performance profiling
      - Battery usage analysis
      - Network condition testing
      - App store compliance check
      - Accessibility audit

  - step: 5.5
    name: "Publish Artifacts"
    agent: orchestrator
    skill: artifact-publisher
    condition: "validation_status == 'pass'"
    inputs:
      - artifact-registry.json
    policy: auto-on-pass
    retry:
      max_attempts: 3
      on_failure: log_and_continue

completion_criteria:
  - App builds successfully for target platforms
  - Core features functional
  - Performance metrics acceptable
  - Platform guidelines followed
  - App store requirements met
