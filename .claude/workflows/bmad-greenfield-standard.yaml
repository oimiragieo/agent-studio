name: BMad Method - Standard Greenfield
description: Complete BMad Method workflow with all phases, decisions, and loops
type: bmad-greenfield
method: standard

# Error Recovery Configuration
recovery:
  enabled: true
  checkpoint_dir: '.claude/context/runtime/runs/{{run_id}}/checkpoints'

retry_config:
  max_attempts: 3
  backoff_strategy: exponential
  initial_delay_ms: 1000
  retryable_errors: [timeout, network_error, rate_limit]

fallback_agents:
  developer: [code-reviewer, qa]
  architect: [developer, security-architect]
  qa: [developer, code-reviewer]
  planner: [architect, pm]
  business-analyst: [pm, architect]
  pm: [business-analyst, ux-expert]
  ux-expert: [pm, accessibility-expert]
  database-architect: [architect, developer]
  security-architect: [compliance-auditor, code-reviewer]
  code-reviewer: [developer, security-architect]
  technical-writer: [developer, pm]
  devops: [architect, developer]

# NOTE: This workflow is selected via keywords defined in .claude/config.yaml workflow_selection section.
# The routing system matches user prompts against keywords in config.yaml, not this file.
# See .claude/config.yaml for the authoritative keyword list used by the routing system.

# Note: BMad workflows use a phase-based structure instead of step-based.
# Phase 0 provides initial planning before the BMad phases begin.

phases:
  - phase: 0
    name: Planning
    required: true
    steps:
      - step: 0.1
        agent: planner
        task: Initial Planning
        inputs:
          - user_requirements
          - business_objectives
        outputs:
          - plan-{{workflow_id}}.md
          - plan-{{workflow_id}}.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/00-planner.json
        validation:
          schema: .claude/schemas/plan.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/00-planner.json
        description: |
          Initial planning phase for BMad workflow:
          - Analyze requirements and objectives
          - Coordinate planning strategy
          - Create structured plan for BMad phases

  - phase: 1
    name: Discovery
    optional: true
    decision:
      id: include_discovery
      type: include_discovery
      if_yes:
        - step: 1.1
          agent: business-analyst
          task: Brainstorm
          inputs: []
          outputs:
            - brainstorm.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/01-business-analyst-brainstorm.json
          validation:
            gate: .claude/context/history/gates/{{workflow_id}}/01-business-analyst-brainstorm.json
        - step: 1.2
          agent: business-analyst
          task: Research
          inputs:
            - brainstorm.json (from step 1.1)
          outputs:
            - research.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/01-business-analyst-research.json
          validation:
            gate: .claude/context/history/gates/{{workflow_id}}/01-business-analyst-research.json
        - step: 1.3
          agent: business-analyst
          task: Product Brief
          inputs:
            - brainstorm.json (from step 1.1)
            - research.json (from step 1.2)
          outputs:
            - product-brief.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/01-business-analyst-brief.json
          validation:
            schema: .claude/schemas/project_brief.schema.json
            gate: .claude/context/history/gates/{{workflow_id}}/01-business-analyst-brief.json
      if_no:
        - skip_to: phase_2

  - phase: 2
    name: Planning
    required: true
    steps:
      - step: 2.1
        agent: pm
        task: PRD
        inputs:
          - plan-{{workflow_id}}.json (from step 0.1)
          - product-brief.json (from step 1.3, optional)
        outputs:
          - prd.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/02-pm.json
        validation:
          schema: .claude/schemas/product_requirements.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/02-pm.json
    decision:
      id: has_ui
      type: has_ui
      if_yes:
        - step: 2.2
          agent: ux-expert
          task: Create UX
          inputs:
            - prd.json (from step 2.1)
          outputs:
            - ux-spec.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/02-ux-expert.json
          validation:
            schema: .claude/schemas/ux_spec.schema.json
            gate: .claude/context/history/gates/{{workflow_id}}/02-ux-expert.json
      if_no:
        - skip: ux_step

  - phase: 3
    name: Solutioning
    required: true
    steps:
      - step: 3.1
        agent: architect
        task: Architecture
        inputs:
          - prd.json (from step 2.1)
          - ux-spec.json (from step 2.2, optional)
        outputs:
          - system-architecture.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/03-architect.json
        validation:
          schema: .claude/schemas/system_architecture.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/03-architect.json
      - step: 3.2
        agent: architect
        task: Validate Architecture
        optional: true
        inputs:
          - system-architecture.json (from step 3.1)
        outputs:
          - architecture-validation.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/03-architect-validation.json
        validation:
          schema: .claude/schemas/architecture-validation.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/03-architect-validation.json
      - step: 3.3
        agent: pm
        task: Epics/Stories
        inputs:
          - prd.json (from step 2.1)
          - system-architecture.json (from step 3.1)
        outputs:
          - epics-stories.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/03-pm-epics.json
        validation:
          schema: .claude/schemas/epics-stories.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/03-pm-epics.json
      - step: 3.4
        agent: qa
        task: Test Design
        optional: true
        inputs:
          - system-architecture.json (from step 3.1)
          - epics-stories.json (from step 3.3)
        outputs:
          - test-design.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/03-qa-test-design.json
        validation:
          schema: .claude/schemas/test_plan.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/03-qa-test-design.json
      - step: 3.5
        agent: architect
        task: Implementation Readiness
        inputs:
          - system-architecture.json (from step 3.1)
          - epics-stories.json (from step 3.3)
          - test-design.json (from step 3.4, optional)
        outputs:
          - implementation-readiness.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/03-architect-readiness.json
        validation:
          schema: .claude/schemas/implementation-readiness.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/03-architect-readiness.json

  - phase: 4
    name: Implementation
    required: true
    steps:
      - step: 4.1
        agent: orchestrator
        task: Sprint Plan
        inputs:
          - epics-stories.json (from step 3.3)
          - implementation-readiness.json (from step 3.5)
        outputs:
          - sprint-plan.json
          - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-orchestrator-sprint.json
        validation:
          schema: .claude/schemas/sprint-plan.schema.json
          gate: .claude/context/history/gates/{{workflow_id}}/04-orchestrator-sprint.json
    epic_loop:
      story_loop:
        - step: 4.2
          agent: orchestrator
          task: Create Story
          inputs:
            - sprint-plan.json (from step 4.1)
            - current_epic_context
            - current_story_context
          outputs:
            - story-{{story_id}}.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-orchestrator-story-{{story_id}}.json
          validation:
            schema: .claude/schemas/story.schema.json
            gate: .claude/context/history/gates/{{workflow_id}}/04-orchestrator-story-{{story_id}}.json
        - step: 4.3
          agent: orchestrator
          task: Validate Story
          optional: true
          inputs:
            - story-{{story_id}}.json (from step 4.2)
          outputs:
            - story-validation-{{story_id}}.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-orchestrator-validation-{{story_id}}.json
          validation:
            gate: .claude/context/history/gates/{{workflow_id}}/04-orchestrator-validation-{{story_id}}.json
        - step: 4.4
          agent: developer
          task: Develop Story
          inputs:
            - story-{{story_id}}.json (from step 4.2)
            - system-architecture.json (from step 3.1)
          outputs:
            - story-implementation-{{story_id}}.json
            - code-artifacts
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-developer-{{story_id}}.json
          validation:
            schema: .claude/schemas/artifact_manifest.schema.json
            gate: .claude/context/history/gates/{{workflow_id}}/04-developer-{{story_id}}.json
        - step: 4.5
          agent: code-reviewer
          task: Code Review
          model: different_llm
          inputs:
            - story-implementation-{{story_id}}.json (from step 4.4)
            - code-artifacts (from step 4.4)
          outputs:
            - code-review-{{story_id}}.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-code-reviewer-{{story_id}}.json
          validation:
            gate: .claude/context/history/gates/{{workflow_id}}/04-code-reviewer-{{story_id}}.json
        - decision:
            id: code_review_pass
            type: code_review_pass
            if_fail:
              loop_back: 4.4
            if_pass:
              continue: true
        - decision:
            id: more_stories
            type: more_stories
            if_yes:
              loop_back: 4.2
            if_no:
              continue: true
      after_stories:
        - step: 4.6
          agent: orchestrator
          task: Retrospective
          inputs:
            - all_story_artifacts
          outputs:
            - retrospective-{{epic_id}}.json
            - reasoning: .claude/context/history/reasoning/{{workflow_id}}/04-orchestrator-retro-{{epic_id}}.json
          validation:
            schema: .claude/schemas/retrospective.schema.json
            gate: .claude/context/history/gates/{{workflow_id}}/04-orchestrator-retro-{{epic_id}}.json
        - decision:
            id: more_epics
            type: more_epics
            if_yes:
              loop_back: 4.1
            if_no:
              end: true
        - step: 4.7
          agent: orchestrator
          task: Publish Artifacts
          optional: false
          skill: artifact-publisher
          condition: "validation_status == 'pass'"
          inputs:
            - artifact-registry.json
          policy: auto-on-pass
          retry:
            max_attempts: 3
            on_failure: log_and_continue

completion_criteria:
  - All epics completed
  - All stories implemented and reviewed
  - Code review passed for all stories
  - Retrospectives completed for all epics
