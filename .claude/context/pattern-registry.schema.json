{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pattern Registry Schema",
  "description": "Schema for the agent routing pattern learning registry",
  "type": "object",
  "required": ["version", "patterns", "metadata"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Registry schema version",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "patterns": {
      "type": "object",
      "description": "Patterns organized by task type",
      "additionalProperties": {
        "$ref": "#/definitions/taskTypePattern"
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Global routing recommendations",
      "items": {
        "$ref": "#/definitions/recommendation"
      }
    },
    "metadata": {
      "type": "object",
      "required": ["created", "lastUpdated", "totalExecutions"],
      "properties": {
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Registry creation timestamp"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp"
        },
        "totalExecutions": {
          "type": "number",
          "minimum": 0,
          "description": "Total number of executions recorded"
        }
      }
    }
  },
  "definitions": {
    "taskTypePattern": {
      "type": "object",
      "required": ["executions", "insights", "successRate", "avgDuration", "lastUpdated", "agentCombinations"],
      "properties": {
        "executions": {
          "type": "array",
          "description": "Execution history (max 100)",
          "maxItems": 100,
          "items": {
            "$ref": "#/definitions/execution"
          }
        },
        "insights": {
          "type": "array",
          "description": "Generated insights from patterns",
          "items": {
            "type": "string"
          }
        },
        "successRate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Success rate percentage"
        },
        "avgDuration": {
          "type": "number",
          "minimum": 0,
          "description": "Average duration in minutes"
        },
        "lastUpdated": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Last update timestamp for this pattern"
        },
        "agentCombinations": {
          "type": "object",
          "description": "Statistics for different agent chain combinations",
          "additionalProperties": {
            "$ref": "#/definitions/agentCombination"
          }
        }
      }
    },
    "execution": {
      "type": "object",
      "required": ["timestamp", "agents", "outcome"],
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Execution timestamp"
        },
        "task": {
          "type": "string",
          "description": "Task description"
        },
        "agents": {
          "type": "array",
          "description": "Agents used in execution chain",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "outcome": {
          "type": "string",
          "enum": ["success", "failure", "partial"],
          "description": "Execution outcome"
        },
        "duration": {
          "type": "number",
          "minimum": 0,
          "description": "Duration in minutes"
        },
        "complexity": {
          "type": "string",
          "enum": ["trivial", "simple", "moderate", "complex", "critical", "unknown"],
          "description": "Task complexity level"
        },
        "feedback": {
          "type": "object",
          "description": "User feedback or metrics",
          "additionalProperties": true
        }
      }
    },
    "agentCombination": {
      "type": "object",
      "required": ["count", "successes", "failures", "avgDuration"],
      "properties": {
        "count": {
          "type": "number",
          "minimum": 0,
          "description": "Number of times this combination was used"
        },
        "successes": {
          "type": "number",
          "minimum": 0,
          "description": "Number of successful executions"
        },
        "failures": {
          "type": "number",
          "minimum": 0,
          "description": "Number of failed executions"
        },
        "avgDuration": {
          "type": "number",
          "minimum": 0,
          "description": "Average duration in minutes"
        }
      }
    },
    "recommendation": {
      "type": "object",
      "required": ["type", "message"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Recommendation type"
        },
        "message": {
          "type": "string",
          "description": "Recommendation message"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Recommendation priority"
        },
        "suggestedAgents": {
          "type": "array",
          "description": "Suggested agent chain",
          "items": {
            "type": "string"
          }
        },
        "confidence": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Confidence level in recommendation"
        }
      }
    }
  }
}
