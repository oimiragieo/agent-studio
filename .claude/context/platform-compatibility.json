{
  "$schema": "../schemas/platform-compatibility.schema.json",
  "version": "1.0.0",
  "last_updated": "2025-01-10",
  "description": "Platform capability matrix for CUJ validation. Defines what features each platform supports.",

  "capability_definitions": {
    "skills": "Ability to execute .claude/skills/ SKILL.md files",
    "workflows": "Ability to execute .claude/workflows/*.yaml workflow definitions",
    "mcp": "Model Context Protocol server integration",
    "hooks": "Pre/post tool execution hooks (.claude/hooks/)",
    "agents": "Specialized agent activation from .claude/agents/",
    "schemas": "JSON schema validation for artifacts",
    "rules": "Rule pack loading from .claude/rules-*/"
  },

  "capability_levels": {
    "true": "Fully supported - feature works as documented",
    "false": "Not supported - feature unavailable on this platform",
    "limited": "Partially supported - some restrictions apply (see notes)",
    "platform-specific": "Supported but requires platform-specific implementation",
    "codex-only": "Only codex-specific skills work (codex-skills/ directory)",
    "untested": "Support unknown - needs validation"
  },

  "platforms": {
    "claude-code": {
      "display_name": "Claude Code",
      "description": "Anthropic's CLI for Claude with full agentic capabilities",
      "version_tested": "1.0.0+",
      "capabilities": {
        "skills": true,
        "workflows": true,
        "mcp": true,
        "hooks": true,
        "agents": true,
        "schemas": true,
        "rules": true
      },
      "skill_count": 108,
      "agent_count": 34,
      "workflow_execution": "native",
      "notes": "Reference implementation - all features fully supported"
    },

    "cursor": {
      "display_name": "Cursor IDE",
      "description": "AI-powered code editor with Claude integration",
      "version_tested": "0.40+",
      "capabilities": {
        "skills": true,
        "workflows": true,
        "mcp": "limited",
        "hooks": false,
        "agents": false,
        "schemas": true,
        "rules": true
      },
      "skill_count": 104,
      "agent_count": 34,
      "workflow_execution": "via-extension",
      "excluded_skills": [
        "recovery",
        "optional-artifact-handler",
        "conflict-resolution",
        "api-contract-generator"
      ],
      "notes": "No hook system. Agent routing handled by .cursorrules. MCP limited to configured servers."
    },

    "factory": {
      "display_name": "Factory Droid",
      "description": "Autonomous AI coding agent",
      "version_tested": "2024.12+",
      "capabilities": {
        "skills": "limited",
        "workflows": false,
        "mcp": false,
        "hooks": false,
        "agents": "limited",
        "schemas": true,
        "rules": true
      },
      "skill_count": 8,
      "agent_count": 22,
      "workflow_execution": "task-tool-pattern",
      "supported_skills": [
        "rule-auditor",
        "rule-selector",
        "scaffolder",
        "repo-rag",
        "artifact-publisher",
        "context-bridge",
        "context-router",
        "incident-response"
      ],
      "supported_agents": [
        "orchestrator",
        "analyst",
        "pm",
        "architect",
        "database-architect",
        "developer",
        "qa",
        "ux-expert",
        "security-architect",
        "devops",
        "technical-writer",
        "code-reviewer",
        "code-simplifier",
        "refactoring-specialist",
        "performance-engineer",
        "llm-architect",
        "api-designer",
        "accessibility-expert",
        "compliance-auditor",
        "incident-responder",
        "planner",
        "impact-analyzer"
      ],
      "notes": "No direct workflow execution. Uses 'Task tool with subagent' pattern instead. Limited skill set focused on rule compliance."
    },

    "codex-cli": {
      "display_name": "OpenAI Codex CLI",
      "description": "OpenAI's command-line coding assistant",
      "version_tested": "2024.12+",
      "capabilities": {
        "skills": "codex-only",
        "workflows": false,
        "mcp": false,
        "hooks": false,
        "agents": false,
        "schemas": false,
        "rules": false
      },
      "skill_count": 2,
      "agent_count": 0,
      "workflow_execution": "none",
      "supported_skills": ["multi-ai-code-review", "response-rater"],
      "skill_location": "codex-skills/",
      "notes": "Only codex-skills/ directory skills work. Used for multi-AI validation workflows."
    },

    "gemini-cli": {
      "display_name": "Google Gemini CLI",
      "description": "Google's command-line AI assistant",
      "version_tested": "untested",
      "capabilities": {
        "skills": "untested",
        "workflows": "untested",
        "mcp": "untested",
        "hooks": "untested",
        "agents": "untested",
        "schemas": "untested",
        "rules": "untested"
      },
      "skill_count": 0,
      "agent_count": 0,
      "workflow_execution": "untested",
      "notes": "Platform not yet validated. Capabilities unknown."
    },

    "aider": {
      "display_name": "Aider",
      "description": "AI pair programming in your terminal",
      "version_tested": "untested",
      "capabilities": {
        "skills": "untested",
        "workflows": "untested",
        "mcp": "untested",
        "hooks": "untested",
        "agents": "untested",
        "schemas": "untested",
        "rules": "untested"
      },
      "skill_count": 0,
      "agent_count": 0,
      "workflow_execution": "untested",
      "notes": "Platform not yet validated. Capabilities unknown."
    }
  },

  "execution_mode_requirements": {
    "workflow": {
      "required_capabilities": ["workflows", "agents"],
      "fallback_pattern": "task-tool-pattern",
      "notes": "Workflow CUJs require native workflow execution or task-tool pattern adaptation"
    },
    "skill-only": {
      "required_capabilities": ["skills"],
      "fallback_pattern": null,
      "notes": "Skill-only CUJs require the specific skill to be available on the platform"
    },
    "manual-setup": {
      "required_capabilities": [],
      "fallback_pattern": null,
      "notes": "Manual CUJs work on all platforms as they are user-driven"
    },
    "manual": {
      "required_capabilities": [],
      "fallback_pattern": null,
      "notes": "Manual CUJs work on all platforms as they are user-driven"
    }
  },

  "compatibility_rules": {
    "skill_availability": {
      "description": "Check if a specific skill is available on the platform",
      "algorithm": "Check platform.supported_skills array if defined, otherwise check platform.capabilities.skills"
    },
    "workflow_compatibility": {
      "description": "Check if workflow execution is supported",
      "algorithm": "Check platform.capabilities.workflows is true or platform.workflow_execution !== 'none'"
    },
    "agent_availability": {
      "description": "Check if agents can be activated",
      "algorithm": "Check platform.capabilities.agents is true or platform.supported_agents includes required agent"
    }
  },

  "validation_functions": {
    "isPlatformCompatible": "function(cujEntry, platformId) -> { compatible: boolean, limitations: string[], warnings: string[] }",
    "getCompatiblePlatforms": "function(cujEntry) -> string[]",
    "getPlatformLimitations": "function(platformId, cujEntry) -> string[]"
  }
}
